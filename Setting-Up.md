
# Введение

---

Перед началом любого пентест-задания крайне важно настроить надежную и эффективную рабочую среду. Это включает организацию инструментов, настройку систем и обеспечение готовности всех необходимых ресурсов к использованию. Создавая хорошо структурированную тестовую инфраструктуру с самого начала, мы можем сократить время простоя, минимизировать ошибки и оптимизировать процесс оценки. В этом модуле мы рассмотрим фундаментальные технологии и конфигурации, которые поддерживают эту цель, фокусируясь на виртуализации и настройке правильной среды для нашей тестовой деятельности.

Предположим, что наша компания получила заказ от нового клиента (Inlanefreight) на проведение внешнего и внутреннего пентеста. Как уже упоминалось, перед проведением любого пентеста требуется правильная подготовка операционной системы. Наш клиент предоставляет нам внутренние системы, которые мы должны подготовить перед началом работы, чтобы тестирование на проникновение началось без задержек. Для этого нам необходимо соответствующим образом и эффективно подготовить необходимые операционные системы.

---

## Этапы и ситуации пентеста

Каждый пентест отличается по объему, ожидаемым результатам и среде в зависимости от сервисной линии и инфраструктуры клиента. Помимо различных этапов пентеста, через которые мы обычно проходим, наша деятельность может варьироваться в зависимости от типа пентеста, что может либо расширить, либо ограничить нашу рабочую среду и возможности.

Например, если мы проводим внутренний пентест, в большинстве случаев нам предоставляется внутренний хост, с которого мы можем работать. Предположим, этот хост имеет доступ в интернет (что обычно бывает). В таком случае нам нужен соответствующий виртуальный частный сервер (VPS) с нашими инструментами для быстрого доступа и загрузки соответствующих ресурсов для пентеста.

Тестирование может проводиться удаленно или на месте, в зависимости от предпочтений клиента. Если удаленно, мы обычно отправляем им устройство с предустановленным дистрибутивом пентеста по нашему выбору или предоставляем им настроенную виртуальную машину, которая будет связываться с нашей инфраструктурой через OpenVPN. Клиент выберет либо размещение образа (в который мы должны войти и немного настроить в первый день) и предоставит нам SSH-доступ (через белый список IP-адресов), либо предоставит нам прямой VPN-доступ в их сеть. Некоторые клиенты предпочитают не размещать никаких образов и предоставляют VPN-доступ, и в этом случае мы свободны тестировать с наших собственных локальных виртуальных машин Linux и Windows.

При выезде к клиенту на месте важно иметь как настроенную и полностью обновленную виртуальную машину Linux, так и Windows. Определенные инструменты работают лучше (или только) на Linux, а наличие виртуальной машины Windows делает определенные задачи (например, перечисление Active Directory) намного проще и эффективнее. Независимо от выбранной установки, мы должны направлять наших клиентов по плюсам и минусам и помогать им выбрать лучшее возможное решение, основанное на их сети и требованиях.

Это еще одна область пентеста, в которой мы должны быть универсальными и адаптивными как предметные эксперты. Мы должны убедиться, что мы полностью готовы с первого дня с правильными инструментами, чтобы предоставить клиенту наилучшую возможную ценность и углубленную оценку. Каждая среда отличается, и мы никогда не знаем, с чем столкнемся, когда начнем перечислять сеть и выявлять проблемы. Нам придется компилировать/устанавливать инструменты или загружать определенные скрипты на нашу атакующую виртуальную машину практически при каждой оценке, которую мы проводим. Настройка наших инструментов наилучшим образом гарантирует, что мы не потратим время впустую в начальные дни оценки. В идеале, нам следует вносить изменения в наши виртуальные машины оценки только для конкретных сценариев, с которыми мы сталкиваемся в ходе оценки.

---

## Настройка и эффективность

Со временем мы все собираем различный опыт и коллекции инструментов, с которыми мы наиболее знакомы. Структурированность имеет первостепенное значение, поскольку она повышает нашу эффективность в пентесте.
Необходимость поиска отдельных ресурсов и их зависимостей до начала работы может быть полностью устранена, если иметь доступ к заранее подготовленной, организованной и структурированной среде. Это требует подготовки и знания различных операционных систем, которые будут развиваться со временем.

Эффективность — это то, чего хотят и ожидают многие люди. Однако многие сегодня полагаются на огромное количество инструментов, до такой степени, что система становится медленной и больше не работает должным образом. Это неудивительно, учитывая большое количество приложений и решений, предлагаемых сегодня. Особенно новички ошеломлены, когда каждый источник информации имеет 50 разных мнений. Все они актуальны и зависят от конкретного случая, что не является плохим.

Но начинающие или даже опытные люди часто ищут другие решения, когда их рабочий спектр или обязанности в рабочей среде меняются. Затем возникает еще один сложный аспект: миграция со старого на новое.

Это часто требует значительных усилий и времени и все же не гарантирует, что эти инвестиции отразят ценность. Поэтому с этим модулем мы хотим создать основную настройку, в которой мы создаем рабочую среду для себя, которую мы знаем изнутри, можем настраивать сами и адаптировать независимо.


# Организация

---

Как мы уже видели в модуле `Learning Process`, организация играет важную роль в наших тестах на проникновение. Неважно, какой это тест на проникновение. Наличие рабочей среды, в которой мы можем ориентироваться практически вслепую, экономит огромное количество времени на поиск ресурсов, с которыми мы уже знакомы и на изучение которых мы потратили время. Эти ресурсы можно найти за несколько минут, но если у нас есть обширный список ресурсов, необходимых для каждой оценки, включая установку, это занимает несколько часов подготовки.

Корпоративные среды обычно состоят из разнородных сетей (хостов/серверов с разными операционными системами). Поэтому имеет смысл организовать хосты и серверы в соответствии с их операционными системами. Если мы организуем нашу структуру в соответствии со стадиями тестирования на проникновение и операционными системами целей, то пример структуры папок может выглядеть следующим образом.

#### Организация

```shell
Cry0l1t3@htb[/htb]$ tree ..

└── Penetration-Testing
	│
	├── Pre-Engagement
	│       └── ...
    ├── Linux
    │   ├── Information-Gathering
    │   │   └── ...
    │   ├── Vulnerability-Assessment
    │   │   └── ...
    │   ├── Exploitation
    │   │   └── ...
    │   ├── Post-Exploitation
    │   │   └── ...
    │   └── Lateral-Movement
    │       └── ...
    ├── Windows
    │   ├── Information-Gathering
    │   │   └── ...
    │   ├── Vulnerability-Assessment
    │   │   └── ...
    │   ├── Exploitation
    │   │   └── ...
    │   ├── Post-Exploitation
    │   │   └── ...
    │   └── Lateral-Movement
    │       └── ...
    ├── Reporting
    │   └── ...
	└── Results
	    └── ...
```

Если мы специализируемся в определённых областях тестирования на проникновение, мы, конечно, можем реорганизовать структуру в соответствии с этими областями. Мы все вольны разрабатывать систему, с которой знакомы, и на самом деле это рекомендуется делать. Все работают по-разному, у всех есть свои сильные и слабые стороны. Если мы работаем в команде, мы должны разработать структуру, с которой знаком каждый член команды. Возьмите этот пример за основу при создании своей системы.

```shell
Cry0l1t3@htb[/htb]$ tree ..

└── Penetration-Testing
	│
	├── Pre-Engagement
	│       └── ...
    ├── Network-Pentesting
	│       ├── Linux
	│       │   ├── Information-Gathering
	│       │   │   └── ...
	│       │   ├── Vulnerability-Assessment
    │       │   │	└── ...
    │       │	└── ...
    │       │    	└── ...
    │		├── Windows
    │ 		│   ├── Information-Gathering
    │		│   │   └── ...
    │		│   └── ...
    │       └── ...
    ├── WebApp-Pentesting
	│       └── ...
    ├── Social-Engineering
	│       └── ...
    ├── .......
	│       └── ...
    ├── Reporting
    │   └── ...
	└── Results
	    └── ...
```

Правильная организация помогает нам как отслеживать всё происходящее, так и находить ошибки в наших процессах. Во время нашего обучения здесь мы столкнемся со многими различными областями, которые мы можем использовать для расширения и улучшения нашего понимания в области кибербезопасности. Мы можем не только сохранять шпаргалки или скрипты, предоставленные в модулях Академии, но также вести заметки относительно всех этапов тестирования на проникновение, с которыми мы столкнемся в HTB Academy, чтобы гарантировать, что никакие критические шаги не будут пропущены в будущих проектах. Мы рекомендуем начинать с небольших структур, особенно при входе в область тестирования на проникновение. Организация на основе операционной системы, таким образом, более подходит для новичков.

При организации работы для себя или для целой команды, мы должны убедиться, что все работают в соответствии с определенной процедурой. Каждый должен знать свое место и место каждого члена команды на протяжении всего процесса тестирования на проникновение. Также должно быть общее понимание относительно деятельности каждого члена. В противном случае, материалы могут оказаться в неправильном подкаталоге, или доказательства, необходимые для отчетности, могут быть потеряны или повреждены.

---

## Закладки

Существует множество браузерных дополнений, которые могут значительно улучшить наши действия по тестированию на проникновение и эффективность. Необходимость переустанавливать их снова и снова отнимает время и ненужно замедляет нас. К счастью, Firefox предлагает синхронизацию дополнений и закладок после создания и использования учетной записи Firefox. Все дополнения, установленные с использованием этой учетной записи, автоматически устанавливаются и синхронизируются при повторном входе в систему. То же самое относится и к сохраненным закладкам. Таким образом, входа в учетную запись Firefox будет достаточно для переноса всего из готовой среды в новую.

Мы должны быть осторожны, чтобы не хранить ресурсы, содержащие потенциально конфиденциальную информацию или частные ресурсы. Мы всегда должны помнить, что третьи стороны могут просматривать эти сохраненные ресурсы. Поэтому закладки, относящиеся к клиентам, никогда не должны сохраняться. Список закладок всегда должен создаваться с единственным принципом:

* **`Этот список рано или поздно увидят третьи лица.`**

По этой причине нам следует создать учетную запись только для целей тестирования на проникновение. Если наш список закладок необходимо редактировать и расширять, то самый безопасный путь — хранить список локально и импортировать его в учетную запись для тестирования на проникновение. После того, как мы это сделали, мы должны изменить нашу личную учетную запись (не для тестирования на проникновение).

---

## Менеджер паролей

Еще одним важным компонентом для нас являются менеджеры паролей. Менеджеры паролей могут оказаться полезными не только для личных целей, но и для тестов на проникновение. Одной из наиболее распространенных уязвимостей или методов атаки в сети является "повторное использование пароля". Мы часто пытаемся использовать найденные или расшифрованные пароли и имена пользователей для входа в несколько систем и сервисов в корпоративной сети посредством этой атаки. До сих пор довольно часто встречаются учетные данные, которые можно использовать для доступа к нескольким службам или серверам, что облегчает нашу работу и предоставляет больше возможностей для атаки. Существуют три основные проблемы с паролями:

1. `Сложность`
2. `Повторное использование`
3. `Запоминание`

#### 1. Сложность

Первая проблема с паролями — это сложность и их запоминание. Для обычных пользователей уже является проблемой создание сложного пароля, так как они часто связаны с контентом, который пользователи знают и могут запомнить. NordPass создал список наиболее часто используемых паролей, которые мы можем посмотреть [здесь](https://nordpass.com/most-common-passwords-list/). Мы можем видеть, что эти пароли могут быть угаданы в течение нескольких секунд без каких-либо специальных приготовлений, таких как мутация паролей.

#### 2. Повторное использование

После того, как пользователь создал и запомнил сложный пароль, остаются только две проблемы. Запоминание сложного и трудно угадываемого пароля все еще находится в пределах возможностей обычного пользователя. Вторая проблема заключается в том, что этот пароль затем используется для всех сервисов, что позволяет нам работать с несколькими компонентами инфраструктуры компании. Чтобы предотвратить это, пользователю пришлось бы создавать и запоминать сложные пароли `для всех` используемых сервисов.

#### 3. Запоминание

Это приводит нас к третьей проблеме с паролями. Если обычный пользователь использует несколько десятков сервисов, человеческая природа заставляет их лениться. Очень немногие приложат усилия, чтобы действительно `запомнить` все пароли. Если пользователь создает несколько паролей, риск забыть их или перепутать с другими компонентами пароля высок, если не используется безопасное решение для хранения паролей.

`Менеджеры паролей` решают все вышеперечисленные проблемы не только для обычных пользователей, но и для тестировщиков на проникновение. Мы работаем с десятками, если не сотнями, различных сервисов и серверов, для которых нам нужен новый, надежный и сложный пароль каждый раз. Некоторые провайдеры включают следующие, но не ограничиваются ими:

| [**1Password**](https://1password.com/) | [**LastPass**](https://www.lastpass.com/) | [**Keeper**](https://www.keepersecurity.com/) | [**Bitwarden**](https://bitwarden.com/) | [Proton Pass](https://proton.me/pass) |
|---|---|---|---|---|

Еще одно преимущество в том, что нам нужно запомнить только один пароль для доступа ко всем нашим остальным паролям. Одним из наиболее рекомендуемых является `Proton Pass`, который предлагает бесплатный план и план Plus с интегрированной 2FA, безопасным хранилищем, мониторингом даркнета.

---

## Обновления и автоматизация

Мы должны постоянно обновлять компоненты, которые мы организовали перед началом нового теста на проникновение. Это относится к используемой нами операционной системе и всем коллекциям Github, которые мы будем собирать и использовать со временем. Настоятельно рекомендуется записывать все ресурсы и их источники в файл, чтобы легче автоматизировать их позже. Любые скрипты автоматизации также можно сохранить в Proton, Github или на собственном сервере с самостоятельно размещенными приложениями для прямой загрузки при необходимости.

Когда мы создаем автоматизированные скрипты, они зависят от операционной системы. Например, мы можем работать с Bash, Python и PowerShell. Создание скриптов автоматизации — хорошее упражнение для изучения и практики скриптинга, а также может помочь нам подготовиться и даже более эффективно переустановить систему. Мы найдем больше инструментов, практических объяснений и шпаргалок при изучении новых методов и технологий. Рекомендуется хранить их в записи и поддерживать записи в актуальном состоянии.

---

## Ведение заметок

Ведение заметок — еще одна важная часть нашего тестирования на проникновение, поскольку мы накапливаем много различной информации, результатов и идей, которые трудно запомнить все сразу. Существует пять различных основных типов информации, которую необходимо записать:

1. Вновь обнаруженная информация
2. Идеи для дальнейших тестов и обработки
3. Результаты сканирования
4. Ведение журнала
5. Скриншоты

#### 1. Обнаруженная информация

Под "обнаруженной информацией" мы понимаем общую информацию, такую как новые IP-адреса, имена пользователей, пароли, исходный код, которую мы идентифицировали и которая связана с процессом тестирования на проникновение. Это информация, которую мы можем использовать против нашей целевой компании. Мы часто получаем такую информацию через OSINT, активное сканирование и ручной анализ данных информационных ресурсов и сервисов.

#### 2. Обработка

В ходе тестирования на проникновение мы приобретем огромное количество информации различных типов. Это требует от нас способности адаптировать наш подход. Полученная информация может дать нам идеи для последующих шагов, в то время как другие уязвимости или неправильные конфигурации могут быть забыты или упущены из виду. Поэтому мы должны привыкнуть записывать все, что, по нашему мнению, должно быть исследовано в рамках оценки. Notion.so, Anytype, Obsidian и Xmind очень подходят для этого.

[Notion.so](https://notion.so/) — это элегантный онлайн-редактор Markdown, который предлагает множество различных функций и дает нам возможность формировать наши идеи и мысли в соответствии с нашими предпочтениями.

![](https://academy.hackthebox.com/storage/modules/87/notion.png)

[Xmind](https://www.xmind.net/) — отличный редактор интеллект-карт, который может очень хорошо визуализировать соответствующие информационные компоненты и процессы.

![](https://academy.hackthebox.com/storage/modules/87/xmind.png)

[Obsidian](https://obsidian.md/) — мощная база знаний, которая работает поверх локальной папки с текстовыми файлами Markdown.

![](https://academy.hackthebox.com/storage/modules/87/obsidian.png)

#### 3. Результаты

Результаты, которые мы получаем после наших сканирований и шагов тестирования на проникновение, имеют большое значение. При таком большом количестве информации за короткое время можно быстро почувствовать себя перегруженным. Поначалу нелегко отфильтровать наиболее важные части информации. Это придет с опытом и практикой. Только через практику наши глаза могут быть обучены распознавать существенные небольшие фрагменты информации. Тем не менее, мы должны хранить всю информацию и результаты, чтобы не пропустить что-то значимое, и потому что часть информации может оказаться полезной позже в процессе работы. Кроме того, эти результаты также часто используются для документации. Для этого мы можем использовать [GhostWriter](https://github.com/GhostManager/Ghostwriter) или [Pwndoc](https://github.com/pwndoc/pwndoc). Они позволяют нам создавать нашу документацию и иметь четкий обзор шагов, которые мы предприняли.

