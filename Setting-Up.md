
# 1.1 Введение

---

Перед началом любого пентест-задания крайне важно настроить надежную и эффективную рабочую среду. Это включает организацию инструментов, настройку систем и обеспечение готовности всех необходимых ресурсов к использованию. Создавая хорошо структурированную тестовую инфраструктуру с самого начала, мы можем сократить время простоя, минимизировать ошибки и оптимизировать процесс оценки. В этом модуле мы рассмотрим фундаментальные технологии и конфигурации, которые поддерживают эту цель, фокусируясь на виртуализации и настройке правильной среды для нашей тестовой деятельности.

Предположим, что наша компания получила заказ от нового клиента (Inlanefreight) на проведение внешнего и внутреннего пентеста. Как уже упоминалось, перед проведением любого пентеста требуется правильная подготовка операционной системы. Наш клиент предоставляет нам внутренние системы, которые мы должны подготовить перед началом работы, чтобы тестирование на проникновение началось без задержек. Для этого нам необходимо соответствующим образом и эффективно подготовить необходимые операционные системы.

---

## Этапы и ситуации пентеста

Каждый пентест отличается по объему, ожидаемым результатам и среде в зависимости от сервисной линии и инфраструктуры клиента. Помимо различных этапов пентеста, через которые мы обычно проходим, наша деятельность может варьироваться в зависимости от типа пентеста, что может либо расширить, либо ограничить нашу рабочую среду и возможности.

Например, если мы проводим внутренний пентест, в большинстве случаев нам предоставляется внутренний хост, с которого мы можем работать. Предположим, этот хост имеет доступ в интернет (что обычно бывает). В таком случае нам нужен соответствующий виртуальный частный сервер (VPS) с нашими инструментами для быстрого доступа и загрузки соответствующих ресурсов для пентеста.

Тестирование может проводиться удаленно или на месте, в зависимости от предпочтений клиента. Если удаленно, мы обычно отправляем им устройство с предустановленным дистрибутивом пентеста по нашему выбору или предоставляем им настроенную виртуальную машину, которая будет связываться с нашей инфраструктурой через OpenVPN. Клиент выберет либо размещение образа (в который мы должны войти и немного настроить в первый день) и предоставит нам SSH-доступ (через белый список IP-адресов), либо предоставит нам прямой VPN-доступ в их сеть. Некоторые клиенты предпочитают не размещать никаких образов и предоставляют VPN-доступ, и в этом случае мы свободны тестировать с наших собственных локальных виртуальных машин Linux и Windows.

При выезде к клиенту на месте важно иметь как настроенную и полностью обновленную виртуальную машину Linux, так и Windows. Определенные инструменты работают лучше (или только) на Linux, а наличие виртуальной машины Windows делает определенные задачи (например, перечисление Active Directory) намного проще и эффективнее. Независимо от выбранной установки, мы должны направлять наших клиентов по плюсам и минусам и помогать им выбрать лучшее возможное решение, основанное на их сети и требованиях.

Это еще одна область пентеста, в которой мы должны быть универсальными и адаптивными как предметные эксперты. Мы должны убедиться, что мы полностью готовы с первого дня с правильными инструментами, чтобы предоставить клиенту наилучшую возможную ценность и углубленную оценку. Каждая среда отличается, и мы никогда не знаем, с чем столкнемся, когда начнем перечислять сеть и выявлять проблемы. Нам придется компилировать/устанавливать инструменты или загружать определенные скрипты на нашу атакующую виртуальную машину практически при каждой оценке, которую мы проводим. Настройка наших инструментов наилучшим образом гарантирует, что мы не потратим время впустую в начальные дни оценки. В идеале, нам следует вносить изменения в наши виртуальные машины оценки только для конкретных сценариев, с которыми мы сталкиваемся в ходе оценки.

---

## Настройка и эффективность

Со временем мы все собираем различный опыт и коллекции инструментов, с которыми мы наиболее знакомы. Структурированность имеет первостепенное значение, поскольку она повышает нашу эффективность в пентесте.
Необходимость поиска отдельных ресурсов и их зависимостей до начала работы может быть полностью устранена, если иметь доступ к заранее подготовленной, организованной и структурированной среде. Это требует подготовки и знания различных операционных систем, которые будут развиваться со временем.

Эффективность — это то, чего хотят и ожидают многие люди. Однако многие сегодня полагаются на огромное количество инструментов, до такой степени, что система становится медленной и больше не работает должным образом. Это неудивительно, учитывая большое количество приложений и решений, предлагаемых сегодня. Особенно новички ошеломлены, когда каждый источник информации имеет 50 разных мнений. Все они актуальны и зависят от конкретного случая, что не является плохим.

Но начинающие или даже опытные люди часто ищут другие решения, когда их рабочий спектр или обязанности в рабочей среде меняются. Затем возникает еще один сложный аспект: миграция со старого на новое.

Это часто требует значительных усилий и времени и все же не гарантирует, что эти инвестиции отразят ценность. Поэтому с этим модулем мы хотим создать основную настройку, в которой мы создаем рабочую среду для себя, которую мы знаем изнутри, можем настраивать сами и адаптировать независимо.




# 1.2 Организация

---

Как мы уже видели в модуле `Learning Process`, организация играет важную роль в наших тестах на проникновение. Неважно, какой это тест на проникновение. Наличие рабочей среды, в которой мы можем ориентироваться практически вслепую, экономит огромное количество времени на поиск ресурсов, с которыми мы уже знакомы и на изучение которых мы потратили время. Эти ресурсы можно найти за несколько минут, но если у нас есть обширный список ресурсов, необходимых для каждой оценки, включая установку, это занимает несколько часов подготовки.

Корпоративные среды обычно состоят из разнородных сетей (хостов/серверов с разными операционными системами). Поэтому имеет смысл организовать хосты и серверы в соответствии с их операционными системами. Если мы организуем нашу структуру в соответствии со стадиями тестирования на проникновение и операционными системами целей, то пример структуры папок может выглядеть следующим образом.

#### Организация

```shell
Cry0l1t3@htb[/htb]$ tree ..

└── Penetration-Testing
	│
	├── Pre-Engagement
	│       └── ...
    ├── Linux
    │   ├── Information-Gathering
    │   │   └── ...
    │   ├── Vulnerability-Assessment
    │   │   └── ...
    │   ├── Exploitation
    │   │   └── ...
    │   ├── Post-Exploitation
    │   │   └── ...
    │   └── Lateral-Movement
    │       └── ...
    ├── Windows
    │   ├── Information-Gathering
    │   │   └── ...
    │   ├── Vulnerability-Assessment
    │   │   └── ...
    │   ├── Exploitation
    │   │   └── ...
    │   ├── Post-Exploitation
    │   │   └── ...
    │   └── Lateral-Movement
    │       └── ...
    ├── Reporting
    │   └── ...
	└── Results
	    └── ...
```

Если мы специализируемся в определённых областях тестирования на проникновение, мы, конечно, можем реорганизовать структуру в соответствии с этими областями. Мы все вольны разрабатывать систему, с которой знакомы, и на самом деле это рекомендуется делать. Все работают по-разному, у всех есть свои сильные и слабые стороны. Если мы работаем в команде, мы должны разработать структуру, с которой знаком каждый член команды. Возьмите этот пример за основу при создании своей системы.

```shell
Cry0l1t3@htb[/htb]$ tree ..

└── Penetration-Testing
	│
	├── Pre-Engagement
	│       └── ...
    ├── Network-Pentesting
	│       ├── Linux
	│       │   ├── Information-Gathering
	│       │   │   └── ...
	│       │   ├── Vulnerability-Assessment
    │       │   │	└── ...
    │       │	└── ...
    │       │    	└── ...
    │		├── Windows
    │ 		│   ├── Information-Gathering
    │		│   │   └── ...
    │		│   └── ...
    │       └── ...
    ├── WebApp-Pentesting
	│       └── ...
    ├── Social-Engineering
	│       └── ...
    ├── .......
	│       └── ...
    ├── Reporting
    │   └── ...
	└── Results
	    └── ...
```

Правильная организация помогает нам как отслеживать всё происходящее, так и находить ошибки в наших процессах. Во время нашего обучения здесь мы столкнемся со многими различными областями, которые мы можем использовать для расширения и улучшения нашего понимания в области кибербезопасности. Мы можем не только сохранять шпаргалки или скрипты, предоставленные в модулях Академии, но также вести заметки относительно всех этапов тестирования на проникновение, с которыми мы столкнемся в HTB Academy, чтобы гарантировать, что никакие критические шаги не будут пропущены в будущих проектах. Мы рекомендуем начинать с небольших структур, особенно при входе в область тестирования на проникновение. Организация на основе операционной системы, таким образом, более подходит для новичков.

При организации работы для себя или для целой команды, мы должны убедиться, что все работают в соответствии с определенной процедурой. Каждый должен знать свое место и место каждого члена команды на протяжении всего процесса тестирования на проникновение. Также должно быть общее понимание относительно деятельности каждого члена. В противном случае, материалы могут оказаться в неправильном подкаталоге, или доказательства, необходимые для отчетности, могут быть потеряны или повреждены.

---

## Закладки

Существует множество браузерных дополнений, которые могут значительно улучшить наши действия по тестированию на проникновение и эффективность. Необходимость переустанавливать их снова и снова отнимает время и ненужно замедляет нас. К счастью, Firefox предлагает синхронизацию дополнений и закладок после создания и использования учетной записи Firefox. Все дополнения, установленные с использованием этой учетной записи, автоматически устанавливаются и синхронизируются при повторном входе в систему. То же самое относится и к сохраненным закладкам. Таким образом, входа в учетную запись Firefox будет достаточно для переноса всего из готовой среды в новую.

Мы должны быть осторожны, чтобы не хранить ресурсы, содержащие потенциально конфиденциальную информацию или частные ресурсы. Мы всегда должны помнить, что третьи стороны могут просматривать эти сохраненные ресурсы. Поэтому закладки, относящиеся к клиентам, никогда не должны сохраняться. Список закладок всегда должен создаваться с единственным принципом:

* **`Этот список рано или поздно увидят третьи лица.`**

По этой причине нам следует создать учетную запись только для целей тестирования на проникновение. Если наш список закладок необходимо редактировать и расширять, то самый безопасный путь — хранить список локально и импортировать его в учетную запись для тестирования на проникновение. После того, как мы это сделали, мы должны изменить нашу личную учетную запись (не для тестирования на проникновение).

---

## Менеджер паролей

Еще одним важным компонентом для нас являются менеджеры паролей. Менеджеры паролей могут оказаться полезными не только для личных целей, но и для тестов на проникновение. Одной из наиболее распространенных уязвимостей или методов атаки в сети является "повторное использование пароля". Мы часто пытаемся использовать найденные или расшифрованные пароли и имена пользователей для входа в несколько систем и сервисов в корпоративной сети посредством этой атаки. До сих пор довольно часто встречаются учетные данные, которые можно использовать для доступа к нескольким службам или серверам, что облегчает нашу работу и предоставляет больше возможностей для атаки. Существуют три основные проблемы с паролями:

1. `Сложность`
2. `Повторное использование`
3. `Запоминание`

#### 1. Сложность

Первая проблема с паролями — это сложность и их запоминание. Для обычных пользователей уже является проблемой создание сложного пароля, так как они часто связаны с контентом, который пользователи знают и могут запомнить. NordPass создал список наиболее часто используемых паролей, которые мы можем посмотреть [здесь](https://nordpass.com/most-common-passwords-list/). Мы можем видеть, что эти пароли могут быть угаданы в течение нескольких секунд без каких-либо специальных приготовлений, таких как мутация паролей.

#### 2. Повторное использование

После того, как пользователь создал и запомнил сложный пароль, остаются только две проблемы. Запоминание сложного и трудно угадываемого пароля все еще находится в пределах возможностей обычного пользователя. Вторая проблема заключается в том, что этот пароль затем используется для всех сервисов, что позволяет нам работать с несколькими компонентами инфраструктуры компании. Чтобы предотвратить это, пользователю пришлось бы создавать и запоминать сложные пароли `для всех` используемых сервисов.

#### 3. Запоминание

Это приводит нас к третьей проблеме с паролями. Если обычный пользователь использует несколько десятков сервисов, человеческая природа заставляет их лениться. Очень немногие приложат усилия, чтобы действительно `запомнить` все пароли. Если пользователь создает несколько паролей, риск забыть их или перепутать с другими компонентами пароля высок, если не используется безопасное решение для хранения паролей.

`Менеджеры паролей` решают все вышеперечисленные проблемы не только для обычных пользователей, но и для тестировщиков на проникновение. Мы работаем с десятками, если не сотнями, различных сервисов и серверов, для которых нам нужен новый, надежный и сложный пароль каждый раз. Некоторые провайдеры включают следующие, но не ограничиваются ими:

| [**1Password**](https://1password.com/) | [**LastPass**](https://www.lastpass.com/) | [**Keeper**](https://www.keepersecurity.com/) | [**Bitwarden**](https://bitwarden.com/) | [Proton Pass](https://proton.me/pass) |
|---|---|---|---|---|

Еще одно преимущество в том, что нам нужно запомнить только один пароль для доступа ко всем нашим остальным паролям. Одним из наиболее рекомендуемых является `Proton Pass`, который предлагает бесплатный план и план Plus с интегрированной 2FA, безопасным хранилищем, мониторингом даркнета.

---

## Обновления и автоматизация

Мы должны постоянно обновлять компоненты, которые мы организовали перед началом нового теста на проникновение. Это относится к используемой нами операционной системе и всем коллекциям Github, которые мы будем собирать и использовать со временем. Настоятельно рекомендуется записывать все ресурсы и их источники в файл, чтобы легче автоматизировать их позже. Любые скрипты автоматизации также можно сохранить в Proton, Github или на собственном сервере с самостоятельно размещенными приложениями для прямой загрузки при необходимости.

Когда мы создаем автоматизированные скрипты, они зависят от операционной системы. Например, мы можем работать с Bash, Python и PowerShell. Создание скриптов автоматизации — хорошее упражнение для изучения и практики скриптинга, а также может помочь нам подготовиться и даже более эффективно переустановить систему. Мы найдем больше инструментов, практических объяснений и шпаргалок при изучении новых методов и технологий. Рекомендуется хранить их в записи и поддерживать записи в актуальном состоянии.

---

## Ведение заметок

Ведение заметок — еще одна важная часть нашего тестирования на проникновение, поскольку мы накапливаем много различной информации, результатов и идей, которые трудно запомнить все сразу. Существует пять различных основных типов информации, которую необходимо записать:

1. Вновь обнаруженная информация
2. Идеи для дальнейших тестов и обработки
3. Результаты сканирования
4. Ведение журнала
5. Скриншоты

#### 1. Обнаруженная информация

Под "обнаруженной информацией" мы понимаем общую информацию, такую как новые IP-адреса, имена пользователей, пароли, исходный код, которую мы идентифицировали и которая связана с процессом тестирования на проникновение. Это информация, которую мы можем использовать против нашей целевой компании. Мы часто получаем такую информацию через OSINT, активное сканирование и ручной анализ данных информационных ресурсов и сервисов.

#### 2. Обработка

В ходе тестирования на проникновение мы приобретем огромное количество информации различных типов. Это требует от нас способности адаптировать наш подход. Полученная информация может дать нам идеи для последующих шагов, в то время как другие уязвимости или неправильные конфигурации могут быть забыты или упущены из виду. Поэтому мы должны привыкнуть записывать все, что, по нашему мнению, должно быть исследовано в рамках оценки. Notion.so, Anytype, Obsidian и Xmind очень подходят для этого.

[Notion.so](https://notion.so/) — это элегантный онлайн-редактор Markdown, который предлагает множество различных функций и дает нам возможность формировать наши идеи и мысли в соответствии с нашими предпочтениями.

![](https://academy.hackthebox.com/storage/modules/87/notion.png)

[Xmind](https://www.xmind.net/) — отличный редактор интеллект-карт, который может очень хорошо визуализировать соответствующие информационные компоненты и процессы.

![](https://academy.hackthebox.com/storage/modules/87/xmind.png)

[Obsidian](https://obsidian.md/) — мощная база знаний, которая работает поверх локальной папки с текстовыми файлами Markdown.

![](https://academy.hackthebox.com/storage/modules/87/obsidian.png)

#### 3. Результаты

Результаты, которые мы получаем после наших сканирований и шагов тестирования на проникновение, имеют большое значение. При таком большом количестве информации за короткое время можно быстро почувствовать себя перегруженным. Поначалу нелегко отфильтровать наиболее важные части информации. Это придет с опытом и практикой. Только через практику наши глаза могут быть обучены распознавать существенные небольшие фрагменты информации. Тем не менее, мы должны хранить всю информацию и результаты, чтобы не пропустить что-то значимое, и потому что часть информации может оказаться полезной позже в процессе работы. Кроме того, эти результаты также часто используются для документации. Для этого мы можем использовать [GhostWriter](https://github.com/GhostManager/Ghostwriter) или [Pwndoc](https://github.com/pwndoc/pwndoc). Они позволяют нам создавать нашу документацию и иметь четкий обзор шагов, которые мы предприняли.




# 1.3 Виртуализация

---

`Виртуализация` — это абстракция физических вычислительных ресурсов. Могут быть абстрагированы как аппаратные, так и программные компоненты. Компьютерный компонент, созданный в рамках виртуализации, называется виртуальным или логическим компонентом и может использоваться точно так же, как его физический аналог. Основным преимуществом виртуализации является абстрактный слой между физическим ресурсом и виртуальным образом. Это основа различных облачных сервисов, которые становятся все более важными в повседневном бизнесе. Обратите внимание, что виртуализацию следует отличать от понятий симуляции и эмуляции.

Предоставляя возможность представления и доступа к физическим вычислительным ресурсам — аппаратному обеспечению, программному обеспечению, хранилищу и сетевым компонентам — в виртуальной форме, виртуализация позволяет распределять эти ресурсы между различными пользователями гибким и ориентированным на спрос способом. Этот подход направлен на улучшение общего использования вычислительных ресурсов. Одна из его ключевых целей — обеспечить выполнение приложений на системах, которые обычно их не поддерживают. В контексте виртуализации мы обычно различаем:

* Виртуализацию аппаратного обеспечения
* Виртуализацию приложений
* Виртуализацию хранилищ
* Виртуализацию данных
* Виртуализацию сети

Виртуализация аппаратного обеспечения относится к технологиям, которые позволяют получать доступ к аппаратным компонентам независимо от их физической формы с помощью программного обеспечения [гипервизора](https://ru.wikipedia.org/wiki/Гипервизор). Наиболее известным примером этого является `виртуальная машина (VM)`. VM — это виртуальный компьютер, который ведет себя как физический компьютер, от аппаратного обеспечения до операционной системы. Виртуальные машины работают как виртуальные гостевые системы на одной или нескольких физических системах, называемых `хостами`. VirtualBox также может быть улучшен с помощью` VirtualBox Guest Additions`, которые представляют собой набор драйверов и системных приложений, разработанных для улучшения производительности и удобства использования гостевых операционных систем с VirtualBox.

![](https://academy.hackthebox.com/storage/modules/87/techhoundscom.jpg)

---

## Виртуальные машины

`Виртуальная машина (VM)` — это виртуальная операционная система, которая работает на хост-системе (реальной физической компьютерной системе). Несколько изолированных друг от друга виртуальных машин могут работать параллельно. Физические аппаратные ресурсы хост-системы распределяются через `гипервизоры`. Это изолированная виртуализированная среда, в которой несколько гостевых систем могут работать параллельно, независимо от операционной системы, на одном физическом компьютере. Виртуальные машины работают независимо друг от друга и не влияют друг на друга. Гипервизор управляет аппаратными ресурсами, и с точки зрения виртуальной машины, выделенные вычислительные мощности, оперативная память, емкость жесткого диска и сетевые соединения доступны исключительно ей.

С точки зрения приложения, операционная система, установленная в виртуальной машине, ведет себя так, как если бы она была установлена непосредственно на аппаратном обеспечении. Приложениям и операционной системе не очевидно, что они работают в виртуальной среде. Виртуализация обычно связана с потерей производительности для виртуальной машины, поскольку промежуточный слой виртуализации сам требует ресурсов. Виртуальные машины предлагают множество преимуществ по сравнению с запуском операционной системы или приложения непосредственно на физической системе. Наиболее важные преимущества:

1. Приложения и службы виртуальной машины не мешают друг другу

2. Полная независимость гостевой системы от операционной системы хост-системы и базового физического оборудования

3. Виртуальные машины можно перемещать или клонировать на другие системы простым копированием

4. Аппаратные ресурсы можно динамически распределять через гипервизор

5. Лучшее и более эффективное использование существующих аппаратных ресурсов

6. Сокращение времени подготовки систем и приложений

7. Упрощенное управление виртуальными системами

8. Более высокая доступность виртуальных машин из-за независимости от физических ресурсов

---

## Введение в VirtualBox

Отличной и бесплатной альтернативой VMware Workstation Pro является [VirtualBox](https://www.virtualbox.org/). В VirtualBox жесткие диски эмулируются в файлах-контейнерах, называемых Virtual Disk Images (`VDI`). Помимо формата VDI, VirtualBox также может работать с файлами жестких дисков от продуктов виртуализации VMware (`.vmdk`), форматом `Virtual Hard Disk` (`.vhd`) и другими. Мы также можем конвертировать эти внешние форматы с помощью инструмента командной строки VBoxManage, который входит в состав VirtualBox. Мы можем установить VirtualBox из командной строки или загрузить установочный файл с [официального сайта](https://www.virtualbox.org/wiki/Downloads) и установить его вручную.

![](https://academy.hackthebox.com/storage/modules/87/virt1.png)

VirtualBox очень распространен в частном использовании. Установка проста и обычно не требует дополнительной настройки для запуска. Мы можем загрузить VirtualBox с их домашней страницы: https://www.virtualbox.org/

#### Загрузка VirtualBox

![](https://academy.hackthebox.com/storage/modules/87/virt2.png)

Также в Ubuntu Linux мы можем использовать следующие команды для одновременной установки VirtualBox и пакета расширений:

#### Установка VirtualBox

```
cry0l1t3@htb[/htb]$ sudo apt install virtualbox virtualbox-ext-pack -y
```

![](https://academy.hackthebox.com/storage/modules/87/virt3.png)

Пакет расширений VirtualBox улучшает общую функциональность VirtualBox следующими возможностями:

* Поддержка USB 2.0/3.0
* VirtualBox RDP
* Шифрование дисков
* PXE Boot
* Поддержка NVMe

---

## Proxmox

Proxmox — это платформа виртуализации и управления сервером с открытым исходным кодом корпоративного уровня, которая использует Kernel-based Virtual Machine (KVM) для полной виртуализации и Linux Containers (LXC) для контейнерной виртуализации. Это программное обеспечение используется в бизнесе и крупных центрах обработки данных.

![](https://academy.hackthebox.com/storage/modules/87/virt4.png)

Proxmox предоставляет три основных решения, которые можно загрузить [здесь](https://proxmox.com/en/downloads):

* Proxmox Virtual Environment
* Proxmox Backup Server
* Proxmox Mail Gateway

#### Загрузка ISO-образа Proxmox VE

![](https://academy.hackthebox.com/storage/modules/87/virt5.png)

Это программное обеспечение позволяет нам создавать и моделировать целые сети, включая сложные настройки с использованием любого типа виртуальных машин или контейнеров, какие только можно придумать. Мы можем загрузить ISO-файл Proxmox VE и установить его на VirtualBox для экспериментов без необходимости в дополнительных аппаратных ресурсах.

После завершения загрузки мы можем создать новую виртуальную машину и назначить ей ISO-образ. Обязательно выделите не менее 4 ГБ оперативной памяти и 2 процессора для виртуальной машины Proxmox.

### Установка Proxmox VE

![](https://academy.hackthebox.com/storage/modules/87/virt6.png)

После того, как всё настроено, мы должны дважды проверить все параметры. Если всё выглядит хорошо, теперь мы можем запустить виртуальную машину.

![](https://academy.hackthebox.com/storage/modules/87/virt7.png)

При загрузке виртуальной машины нас встречает экран Proxmox Virtual Environment. Теперь мы можем выбрать опцию установки Proxmox VE с использованием графического интерфейса.

![](https://academy.hackthebox.com/storage/modules/87/virt8.png)

Внимательно следите за всем процессом установки и обязательно прочитайте всё во время установки. После завершения установки вы увидите экран входа в систему вместе с URL-адресом веб-страницы управления.

![](https://academy.hackthebox.com/storage/modules/87/virt9.png)

Те же учетные данные, которые вы использовали во время установки, будут использоваться для входа в веб-панель управления. Ваши учетные данные будут `root:<ваш пароль>`.

![](https://academy.hackthebox.com/storage/modules/87/virt10.png)

На этом этапе вы должны увидеть все опции конфигурации для вашего виртуализированного "Центра данных". Здесь вы можете загружать виртуальные машины, контейнеры, создавать сети и многое другое. Эти виртуальные машины и контейнеры будут находиться внутри виртуализированной среды Proxmox и не нужно добавлять их отдельно в VirtualBox.

![](https://academy.hackthebox.com/storage/modules/87/virt11.png)




# 1.4 Linux

---

Linux является наиболее широко используемой операционной системой для пентестинга. Поэтому мы должны хорошо владеть ею (или, по крайней мере, быть с ней знакомы). При настройке операционной системы для этой цели лучше всего установить стандартную конфигурацию, которая последовательно создаёт среду, удобную для работы.

Предположим, нас попросили провести пентест для проверки как внутренней, так и внешней безопасности сети. Если у нас ещё нет подготовленной специализированной системы, сейчас самое время её создать. В противном случае мы рискуем потратить ценное время во время задания на настройку и конфигурацию, тогда как это время можно было бы использовать для тестирования различных компонентов сети. Однако прежде чем подготовить систему, нам нужно ознакомиться с доступными дистрибутивами для пентестинга.

---

## Дистрибутивы для пентестинга

Существует множество различных дистрибутивов, которые мы можем использовать, и у всех них есть свои преимущества и недостатки. Многие люди спрашивают себя, какая система лучше. Тем не менее, то, что многие не понимают, — это то, что это личное решение. Это означает, что лучший дистрибутив для нас зависит в первую очередь от наших собственных потребностей и желаний. Инструменты, доступные в этих операционных системах, можно установить практически в любом дистрибутиве, поэтому мы должны спросить себя, чего ожидаем от этого дистрибутива Linux. Лучшие дистрибутивы для пентестинга характеризуются большим/активным сообществом и подробной документацией. Среди наиболее популярных, но не ограничиваясь ими:

| [ParrotOS](https://www.parrotsec.org/) (`Pwnbox`) | [Kali Linux](https://www.kali.org/) | [BlackArch](https://blackarch.org/) | [BackBox](https://linux.backbox.org/) |
|---------------------------------------------------|-------------------------------------|------------------------------------|--------------------------------------|

В этом сценарии мы будем работать с [ParrotOS Security](https://www.parrotsec.org/download/) в качестве нашего дистрибутива для пентестинга. Давайте выберем категорию `Live`, чтобы получить полную версию операционной системы.

![](https://academy.hackthebox.com/storage/modules/87/lin1.png)

Далее, мы видим три различных редакции ParrotOS:

- Security - для пентестов
- Home - для общего использования
- HTB - ваш персонализированный Pwnbox

В данном случае мы выберем HTB редакцию. Смело следуйте инструкциям.

![](https://academy.hackthebox.com/storage/modules/87/lin2.png)

После этого вы увидите кнопку загрузки и учетные данные по умолчанию, если вы хотите использовать систему без установки.

![](https://academy.hackthebox.com/storage/modules/87/lin3.png)

---

## Настройка VM

Перед установкой нашей операционной системы ParrotOS Security, нам нужно `создать VM` (в VirtualBox в этом примере). Здесь мы также указываем, какой установочный файл будет использоваться для операционной системы (файл `.iso`).

#### ParrotOS ISO

![](https://academy.hackthebox.com/storage/modules/87/lin4.png)

Поскольку VirtualBox не распознает каждую операционную систему по умолчанию, он может неправильно определить ParrotOS. Поэтому нам нужно вручную указать, на каком дистрибутиве она основана — в данном случае, `Debian`.

Также нам нужно назначить `имя` для VM с нужной нам меткой, а затем установить `путь`, где она будет храниться.

После этого мы можем установить `максимальный размер` VM. Рекомендуется выделить более 20 ГБ, так как VM будет расти по мере установки пакетов и приложений во время настройки и использования.

#### Размер ОС

![](https://academy.hackthebox.com/storage/modules/87/lin5.png)

---

## Установка ParrotOS

После создания VM мы можем запустить её и перейти в меню GRUB для выбора опций. Поскольку мы хотим `установить ParrotOS`, мы должны выбрать этот вариант. Как только мы нажмем на окно VM, наша мышь будет захвачена, что означает, что мышь не сможет покинуть окно. Чтобы снова свободно перемещать мышь, мы должны нажать `[Right CTRL]` (комбинация горячих клавиш по умолчанию в большинстве случаев). Однако мы должны проверить эту комбинацию клавиш в окне VirtualBox в разделе `Preferences > Virtual Machine > Hot Key Combo`.

Примечание: Мы можем настроить все шаги в соответствии с нашими потребностями. Однако для достижения одинакового результата следует придерживаться предлагаемого выбора.

![](https://academy.hackthebox.com/storage/modules/87/lin6.png)

Когда вы нажмёте на `Try / Install`, вы войдёте в режим live-системы ParrotOS. Этот режим позволяет вам исследовать и тестировать систему без установки. При нажатии на `Install Debian` начинается процесс установки. Затем нам будет предложено выбрать язык, местоположение, раскладку клавиатуры и метод разбиения диска.

![](https://academy.hackthebox.com/storage/modules/87/lin7.png)

Поскольку мы хотим зашифровать наши данные и информацию на VM с помощью [Logical Volume Manager](https://en.wikipedia.org/wiki/Logical_volume_management) (`LVM`), мы должны выбрать опцию "`Encrypt system`". Также рекомендуется создать `Swap (no Hibernate)` для нашей системы.

`LVM` — это схема разбиения. В основном используется в среде Unix и Linux, обеспечивает уровень абстракции между дисками, разделами и файловыми системами. С помощью LVM можно формировать динамически изменяемые разделы, которые распространяются на несколько дисков. После выбора LVM нам будет предложено ввести имя пользователя, имя хоста и пароль.

![](https://academy.hackthebox.com/storage/modules/87/lin8.png)

После того, как мы сделали все необходимые записи, мы можем подтвердить их и начать настройку `LVM`.

---

## Шифрование LUKS

`LVM` действует как дополнительный слой между физическим хранилищем и логическим хранилищем операционной системы. LVM поддерживает организацию логических томов в массивы RAID для защиты от сбоя жесткого диска. Однако, в отличие от RAID, концепция LVM не обеспечивает избыточность. Хотя в основном используется в Linux и Unix, аналогичные функции существуют в Windows ([Storage Spaces](https://docs.microsoft.com/en-us/windows-server/storage/storage-spaces/overview)) и macOS ([CoreStorage](https://en.wikipedia.org/wiki/Core_Storage)).

Когда мы дойдем до этапа разбиения диска, нам будет предложено ввести `парольную фразу для шифрования`. Мы должны помнить, что эта парольная фраза должна быть `очень надежной` и должна храниться в безопасном месте, в идеале с помощью менеджера паролей. Затем нам придется повторно ввести парольную фразу, чтобы убедиться, что не было допущено ошибок.

#### Парольная фраза LVM

![](https://academy.hackthebox.com/storage/modules/87/lin9.png)

После установки парольной фразы мы получим обзор всех созданных и настроенных разделов. Нам также будут доступны другие опции, как показано выше. Если никаких дополнительных настроек не требуется, мы можем завершить разбиение и применить изменения.

Теперь начнется установка операционной системы, и по ее завершении виртуальная машина автоматически перезагрузится. При перезагрузке нам будет предложено ввести парольную фразу шифрования, которую мы создали ранее, чтобы разблокировать зашифрованную систему и продолжить загрузку.

#### Разблокировка раздела LVM

![](https://academy.hackthebox.com/storage/modules/87/lin10.png)

Если мы правильно ввели парольную фразу, то операционная система полностью загрузится, и мы сможем войти в систему. Здесь мы вводим пароль для созданного нами имени пользователя.

#### Первый вход

![](https://academy.hackthebox.com/storage/modules/87/lin11.png)

---

## Обновления и менеджер пакетов APT

Теперь, когда мы установили операционную систему, нам нужно обновить её. Для этого мы будем использовать инструмент управления пакетами `APT`. `Advanced packaging toolkit` (`APT`) — это система управления пакетами, возникшая в операционной системе Debian (которая использует `dpkg` для управления пакетами .deb под капотом). Менеджеры пакетов используются для поиска, обновления и установки программных пакетов и зависимостей. APT использует репозитории (источники пакетов), которые хранятся в каталоге `/etc/apt/sources.list` (в нашем случае для ParrotOS: `/etc/apt.sources.list.d/parrot.list`).

#### Список источников ParrotOS

```
┌─[cry0l1t3@parrot]─[~]
└──╼ $ cat /etc/apt/sources.list.d/parrot.list | grep -v "#"

deb https://deb.parrot.sh/parrot lory main contrib non-free non-free-firmware

deb https://deb.parrot.sh/direct/parrot lory-security main contrib non-free non-free-firmware

deb https://deb.parrot.sh/parrot lory-backports main contrib non-free non-free-firmware
```

Здесь менеджер пакетов может получить доступ к списку HTTP и FTP-серверов, которые он затем использует для получения пакетов для установки. Если выполняется поиск пакетов, они автоматически загружаются из списка доступных репозиториев. Поскольку версии программ можно быстро сравнивать и автоматически загружать из списка репозиториев, обновление существующих программных пакетов в APT относительно просто и удобно.

#### Обновление ParrotOS

```
┌─[cry0l1t3@parrotos]─[~]
└──╼ $ sudo apt update -y && sudo apt full-upgrade -y && sudo apt autoremove -y && sudo apt autoclean -y
[sudo] password for cry0l1t3: **********************

Hit:1 https://deb.parrot.sh/parrot rolling InRelease
Hit:2 https://deb.parrot.sh/parrot rolling-security InRelease
Reading package lists... Done
Building dependency tree
Reading state information... Done
2310 packages can be upgraded. Run 'apt list --upgradable' to see them.
Reading package lists... Done
Building dependency tree
Reading state information... Done
Calculating upgrade... Done
The following packages were automatically installed and are no longer required:
  cryptsetup-nuke-password dwarfdump
  <SNIP>
```

Ниже представлен список распространенных инструментов для пентестинга:

#### Список инструментов

```
┌─[cry0l1t3@parrotos]─[~]
└──╼ $ cat tools.list
netcat
ncat
nmap
wireshark
tcpdump
hashcat
ffuf
gobuster
hydra
zaproxy
proxychains
sqlmap
radare2
metasploit-framework
python2.7
python3
spiderfoot
theharvester
remmina
xfreerdp
rdesktop
crackmapexec
exiftool
curl
seclists
testssl.sh
git
vim
tmux
```

Большинство пакетов уже установлены в операционной системе. Если есть всего несколько пакетов, которые мы хотим установить, мы можем ввести их вручную с помощью следующей команды.

#### Установка дополнительных инструментов

```
┌─[cry0l1t3@parrotos]─[~]
└──╼ $ sudo apt install netcat ncat nmap wireshark tcpdump ...SNIP... git vim tmux -y
[sudo] password for cry0l1t3:

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages were automatically installed and are no longer required:
  libarmadillo9 libboost-locale1.71.0 libcfitsio8 libdap25 libgdal27 libgfapi0
  <SNIP>
```

Однако, если вы работаете с более длинным списком инструментов, эффективнее создать файл со списком инструментов и использовать его для автоматизации установки. Это обеспечивает согласованность и экономит время при будущих настройках:

#### Установка дополнительных инструментов из списка

```
┌─[cry0l1t3@parrotos]─[~]
└──╼ $ sudo apt install $(cat tools.list | tr "\n" " ") -y
[sudo] password for cry0l1t3:

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages were automatically installed and are no longer required:
  libarmadillo9 libboost-locale1.71.0 libcfitsio8 libdap25 libgdal27 libgfapi0
  <SNIP>
```

---

## Использование Github

Вероятно, мы столкнемся с инструментами, которые не найдены в стандартных репозиториях, и поэтому нам потребуется загрузить их вручную с Github. Например, предположим, что нам не хватает некоторых инструментов для повышения привилегий, и мы хотим загрузить [Privilege-Escalation-Awesome-Scripts-Suite](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite). Мы бы использовали команду:

#### Клонирование репозитория Github

```
┌─[cry0l1t3@parrotos]─[~]
└──╼ $ git clone https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite.git

Cloning into 'privilege-escalation-awesome-scripts-suite'...
remote: Enumerating objects: 29, done.
remote: Counting objects: 100% (29/29), done.
remote: Compressing objects: 100% (17/17), done.
remote: Total 5242 (delta 18), reused 22 (delta 11), pack-reused 5213
Receiving objects: 100% (5242/5242), 18.65 MiB | 5.11 MiB/s, done.
Resolving deltas: 100% (3129/3129), done.
```

#### Просмотр содержимого

```
┌─[cry0l1t3@parrotos]─[~]
└──╼ $ ls -l privilege-escalation-awesome-scripts-suite/
total 16

-rwxrwxr-x 1 cry0l1t3 cry0l1t3 1069 Mar 23 16:41 LICENSE
drwxrwxr-x 3 cry0l1t3 cry0l1t3 4096 Mar 23 16:41 linPEAS
-rwxrwxr-x 1 cry0l1t3 cry0l1t3 2506 Mar 23 16:41 README.md
drwxrwxr-x 4 cry0l1t3 cry0l1t3 4096 Mar 23 16:41 winPEAS
```

---

## Снапшот

После установки соответствующих пакетов и репозиториев настоятельно рекомендуется сделать `снапшот VM`. В следующих шагах мы будем вносить изменения в конкретные конфигурационные файлы. Если мы не будем осторожны, человеческая ошибка может сделать части системы (или даже всю систему) непригодными для использования. Мы определенно не хотим повторять все наши предыдущие шаги. Поэтому давайте создадим снапшот и назовем его "`Initial Setup`".

Тем не менее, `прежде чем` создать этот снапшот, мы должны сначала выключить виртуальную машину. Это не только ускоряет процесс создания снапшота, но и гарантирует, что снапшот будет сделан в чистом, выключенном состоянии, снижая вероятность повреждения системы или несоответствий.

Если при выполнении дальнейших настроек или тестировании будут допущены какие-либо ошибки, мы можем просто восстановить снапшот и продолжить с работоспособного состояния. Рекомендуется делать снапшот после каждого крупного изменения конфигурации и даже периодически во время пентеста, чтобы избежать потери ценного прогресса.

#### Создание снапшота

![](https://academy.hackthebox.com/storage/modules/87/lin12.png)

#### Завершенные задачи

![](https://academy.hackthebox.com/storage/modules/87/lin13.png)

---

## Шифрование диска VM

В дополнение к шифрованию LVM мы можем зашифровать всю VM с помощью другого надежного пароля. Это дает нам дополнительный уровень защиты, который защитит наши результаты и любые данные клиента, находящиеся в системе. Это означает, что никто не сможет запустить VM без пароля, который мы установили.

Теперь, когда мы выключили VM, мы переходим в раздел `Edit virtual machine settings` и выбираем вкладку `Options`.

#### Настройки шифрования диска VirtualBox

![](https://academy.hackthebox.com/storage/modules/87/lin14.png)

Там мы найдем больше дополнительных функций и настроек, которые мы можем использовать позже. Актуальными для нас сейчас являются настройки `Access Control`. После того, как мы зашифровали VM, мы не сможем создать клон без предварительной расшифровки. Более подробную информацию об этом можно найти в документации VirtualBox.






# 1.5 Резервное копирование и восстановление

---

Механизмы резервного копирования и восстановления являются одними из наиболее важных защитных мер против потери данных, компрометации системы и прерывания бизнеса.

Когда мы моделируем кибератаки, мы рассматриваем резервные копии и системы восстановления через двойную призму: как защитные меры, которые могут смягчить ущерб, и как приоритетные цели, которые злоумышленники могут использовать. Чтобы понять важность этих систем, нам необходимо изучить, как они работают в условиях стресса, какую роль они играют при реагировании на инциденты, и в каких реальных случаях они улучшили или ухудшили безопасность организации. Лучший способ понять это — разработать собственные стратегии резервного копирования и (аварийного) восстановления.

Например, во время атаки программы-вымогателя на [Colonial Pipeline в 2021 году](https://www.cisa.gov/news-events/news/attack-colonial-pipeline-what-weve-learned-what-weve-done-over-past-two-years), злоумышленники зашифровали ключевые системы и потребовали миллионы долларов выкупа. Способность компании быстро восстановить работу зависела от надежных резервных копий, изолированных от атакованной сети.

Процессы восстановления не менее важны, поскольку они определяют, насколько быстро компания может вернуться к нормальной работе после вторжения. Как пентестеры, мы можем моделировать сценарии, когда системы блокируются или данные похищаются, и оценивать скорость и точность восстановления, если события вообще обнаруживаются (да, к сожалению, это все еще случается). Плохой процесс восстановления может усугубить ущерб, как это видно на примере [Equifax в 2017 году](https://archive.epic.org/privacy/data-breach/equifax/), когда плохое реагирование на инцидент усугубило утечку данных 147 миллионов человек.

Давайте рассмотрим несколько решений, которые мы можем использовать для правильного резервного копирования вашей системы и восстановления её при необходимости.

---

## Pika Backup

[Pika Backup](https://apps.gnome.org/PikaBackup/) — это удобное решение для резервного копирования с графическим интерфейсом, которое позволяет создавать резервные копии локально и удаленно. Большим преимуществом является то, что оно не копирует файлы, которые уже были скопированы. Оно копирует только новые файлы или файлы, которые были изменены с момента последнего резервного копирования. Кроме того, оно поддерживает шифрование, что добавляет дополнительный уровень безопасности, и его легко настроить.

```
# Обновление
cry0l1t3@hbt[/htb]$ sudo apt update -y 

# Установка Pika Backup
cry0l1t3@hbt[/htb]$ sudo apt install flatpak -y
cry0l1t3@hbt[/htb]$ flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
cry0l1t3@hbt[/htb]$ flatpak install flathub org.gnome.World.PikaBackup

# Запуск Pika Backup
cry0l1t3@hbt[/htb]$ flatpak run org.gnome.World.PikaBackup
```

После запуска Pika Backup мы можем настроить процесс резервного копирования в соответствии с нашими потребностями.

![Экран Pika Backup, показывающий 'Резервное копирование не настроено' с кнопкой 'Настроить резервное копирование'](https://academy.hackthebox.com/storage/modules/87/bak1.png)

Pika Backup использует репозитории BorgBackup, которые представляют собой директории, содержащие (зашифрованные и) дедуплицированные архивы. Дедуплицированный архив — это тип архива данных, где избыточные копии можно идентифицировать и удалять для экономии места и повышения эффективности. Каждый фрагмент данных в архиве разделяется на меньшие части, и на основе его содержимого ему присваивается уникальный хеш. Если хеш фрагмента совпадает с уже существующим, он отбрасывается. В производственных средах, где хост может быть доступен через интернет (например, веб-сервер), рекомендуется следовать правилу 3-2-1:

* 3 копии ваших данных
* 2 на разных устройствах
* 1 вне офиса

![Экран настройки Pika Backup с опциями создания или использования существующего репозитория, показывающий 'Расположение на диске' и 'Удаленное расположение' для обоих](https://academy.hackthebox.com/storage/modules/87/bak2.png)

Мы можем указать местоположение, где будет создан локальный репозиторий. В этом примере мы будем использовать подключенный HDD с директорией под названием `backup`.

![Экран выбора местоположения Pika Backup, показывающий 'Базовую папку репозитория', установленную на 'backup', и 'Имя репозитория' как 'backup-ubuntu-cry0l1t3' с кнопкой 'Продолжить'](https://academy.hackthebox.com/storage/modules/87/bak3.png)

После определения директории для репозитория мы можем настроить фразу шифрования, которую Pika Backup использует для шифрования всех наших архивов. Как и BorgBackup, Pika Backup использует шифрование AES-256-CTR, которое обеспечивает высокий уровень безопасности.

![Экран настройки шифрования Pika Backup с включенным 'Использовать шифрование', показывающий поля для нового пароля и повтора пароля, и кнопку 'Создать'](https://academy.hackthebox.com/storage/modules/87/bak4.png)

После настройки шифрования мы можем приступить к первому резервному копированию или более глубоко погрузиться в конфигурацию — изучая такие вещи, как расписание, включаемые и исключаемые файлы и директории. В этом примере мы собираемся создать резервную копию только домашней директории, как видно в разделе `Файлы для резервного копирования`, и исключить все `Кэши`.

![Экран Pika Backup, показывающий 'Резервное копирование никогда не запускалось' с опциями резервного копирования папки 'Домашняя' и исключения 'Кэшей', и кнопкой 'Создать резервную копию сейчас'](https://academy.hackthebox.com/storage/modules/87/bak5.png)

Для архивов мы можем указать индекс архива по нашему выбору. Мы также можем запустить `Проверку целостности данных` вручную, которая проверяет последние архивы резервных копий с текущим состоянием и вносит обновления, если какие-либо файлы были изменены с момента последнего резервного копирования.

![Экран архивов Pika Backup, показывающий директорию 'домашняя' с 20.4 ГБ доступно из 52.5 ГБ всего, опции для 'Префикса архива' и 'Очистки архивов', и 'Проверка целостности не выполнена'. Архивы недоступны.](https://academy.hackthebox.com/storage/modules/87/bak6.png)

На вкладке `Расписание` мы можем указать, как часто нужно создавать резервную копию. Рекомендуемое расписание — делать резервную копию ежедневно на период в 2 недели.

![Экран расписания Pika Backup, показывающий 'Ожидание начала резервного копирования', с опциями регулярного создания резервных копий ежедневно в 21:00 и регулярной очистки архивов. Присутствует кнопка 'Сохранить конфигурацию'](https://academy.hackthebox.com/storage/modules/87/bak7.png)

Когда всё настроено, мы можем запустить процесс резервного копирования и подождать, пока он завершится.

![Экран Pika Backup, показывающий 'Резервное копирование выполняется' на 4.0% для директории 'домашняя', с опциями прервать, и списками файлов для резервного копирования и исключения](https://academy.hackthebox.com/storage/modules/87/bak8.png)

---

## Duplicati

[Duplicati](https://duplicati.com/download) — это кросс-платформенное решение для резервного копирования, также с мощными возможностями. Оно также поддерживает AES-256 для шифрования, с опциональным асимметричным шифрованием с использованием GPG (RSA или аналогичный для обмена ключами). Данные шифруются на стороне клиента и поддерживается сильное выведение ключей на основе пароля. Большим преимуществом для многих людей является количество удаленных мест назначения, которые поддерживает Duplicati:

* Google Drive
* OneDrive
* Amazon S3
* SFTP
* Dropbox
* и другие.

Процесс установки также очень прост, но вместо использования GUI, Duplicati использует веб-сервер для управления. Давайте [скачаем](https://duplicati.com/download) установочный пакет и установим его.

```
cry0l1t3@hbt[/htb]$ cd ~/Downloads
cry0l1t3@hbt[/htb]$ sudo apt install ./duplicati-2.1.0.5_stable_2025-03-04-linux-x64-gui.deb
cry0l1t3@hbt[/htb]$ duplicati
```

После установки мы можем перейти на http://localhost:8200 и увидим веб-страницу, похожую на эту:

![Интерфейс Duplicati, показывающий 'Добавить новую резервную копию' с опциями настройки новой резервной копии или импорта из файла, и кнопкой 'Далее'](https://academy.hackthebox.com/storage/modules/87/bak9.png)

Во вкладке `Добавить резервную копию` мы можем начать указывать наши общие настройки резервного копирования, дать ему имя, установить шифрование и фразу-пароль для него.

![Экран настроек резервного копирования Duplicati с полями для 'Имени', 'Описания', 'Шифрования', 'Фразы-пароля' и 'Повтора фразы-пароля', и кнопкой 'Далее'](https://academy.hackthebox.com/storage/modules/87/bak10.png)

В этом примере мы настроим Duplicati для создания резервных копий и отправки их на удаленный сервер. Одним из наиболее рекомендуемых и безопасных методов является передача файлов через SSH/SFTP с использованием SSH-ключей. Поэтому нам нужно сгенерировать отдельный SSH-ключ с помощью команды `ssh-keygen`.

```
cry0l1t3@hbt[/htb]$ ssh-keygen -t ed25519

Generating public/private ed25519 key pair.

Enter file in which to save the key (/home/cry0l1t3/.ssh/id_ed25519): duplicati
Enter passphrase (empty for no passphrase): ******************
Enter same passphrase again: ******************

Your identification has been saved in duplicati
Your public key has been saved in duplicati.pub
The key fingerprint is:
SHA256:2mKNI0ZOfVMuwkFenV4NtUv0hwiHTir0gGYfR/Lhm8Q cry0l1t3@ubuntu
The key's randomart image is:
+--[ED25519 256]--+
|     .o.+..oo+o  |
|    +o+*..=o.o.+ |
|   o oo=E=... + o|
|     oooo=o  . ..|
|    o +.S .   .  |
|   +   B o       |
|    + * o        |
|   . o o         |
|                 |
+----[SHA256]-----+
```

После создания SSH-ключа мы теперь можем указать тип хранилища, удаленный IP-адрес и порт, путь на сервере, имя пользователя, и в `Расширенных опциях` мы можем добавить метод аутентификации `ssh-key`.

![Настройка места назначения резервного копирования Duplicati с SFTP, IP-адресом сервера 10.129.12.122, порт 50022, путь '/home/duplicati', имя пользователя 'duplicati', и кнопкой 'Проверить соединение'](https://academy.hackthebox.com/storage/modules/87/bak11.png)

После этого мы можем выбрать исходные данные, которые необходимо скопировать. Огромным преимуществом, которое предоставляет Duplicati, является функциональность фильтрации с использованием регулярных выражений.

![Экран выбора исходных данных Duplicati с деревом папок для 'Пользовательских данных' и 'Компьютера', опцией показа скрытых папок и настройками фильтра](https://academy.hackthebox.com/storage/modules/87/bak12.png)

В качестве последнего шага мы можем настроить расписание для резервных копий.

![Экран расписания Duplicati с отмеченным 'Автоматически запускать резервные копии', следующий запуск в 13:00 27.04.2025, повторяющийся каждый день, со всеми выбранными днями](https://academy.hackthebox.com/storage/modules/87/bak13.png)

Настоятельно рекомендуется, чтобы ваши резервные копии (особенно когда они хранятся на удаленном сервере) были зашифрованы как в состоянии покоя, так и во время передачи. Это означает, что ваши данные должны быть зашифрованы в репозиториях и во время передачи. И Pika Backup, и Duplicati поддерживают эту функциональность и, следовательно, помогают организациям выполнять нормативные требования, такие как GDPR и HIPAA.

Мы также рекомендуем смоделировать ситуацию `Аварийного восстановления`, когда ваш сервер внезапно перестает работать должным образом или данные были потеряны, и вам нужно восстановить его последнее состояние с нуля. В процессе этого вы узнаете, какие вещи могут произойти во время восстановления и работает ли ваш процесс должным образом. Имейте в виду, что вы должны вести заметки и документировать процесс шаг за шагом, чтобы у вас был план обеспечения непрерывности, который вы можете использовать для восстановления своих данных. Мы также рекомендуем моделировать эту ситуацию дважды в год или раз в квартал, чтобы гарантировать, что настроенный вами процесс работает должным образом. Потому что когда что-то ломается, ваш план обеспечения непрерывности — это последнее средство для восстановления всего, что вы создали.




# 1.6 Провайдеры VPS

---

`Виртуальный частный сервер` (`VPS`) — это изолированная среда, созданная на физическом сервере с использованием технологии виртуализации. VPS по сути является частью решений `Инфраструктура как услуга` (`IaaS`). Это решение предлагает все преимущества обычного сервера со специально выделенными ресурсами и полной свободой управления. Мы можем свободно выбирать операционную систему и приложения, которые мы хотим использовать, без каких-либо ограничений конфигурации. Эта ВМ использует ресурсы физического сервера и предоставляет пользователям различные серверные функции, сопоставимые с функциями выделенного сервера. Поэтому его также называют `Виртуальным выделенным сервером` (`VDS`).

VPS позиционируется как компромисс между недорогим общим хостингом и обычно дорогой арендой технологии выделенных серверов. Идея этой модели хостинга заключается в том, чтобы предложить пользователям максимально полный спектр функций по доступным ценам. Виртуальное воспроизведение отдельных компьютерных систем на стандартной хост-системе требует значительно меньших усилий для веб-хостера, чем предоставление отдельных аппаратных компонентов для каждого клиента. Обширная независимость отдельных гостевых систем достигается за счет инкапсуляции. Каждый VPS на общей аппаратной базе действует изолированно от других параллельных операционных систем. В большинстве случаев VPS используется для следующих целей, но не ограничивается ими:

| | | | |
|---|---|---|---|
| Веб-сервер | LAMP/XAMPP стек | Почтовый сервер | DNS-сервер |
| Сервер разработки | Прокси-сервер | Тестовый сервер | Репозиторий кода |
| Пентестинг | VPN | Игровой сервер | C2 сервер |

Мы можем выбрать из ряда операционных систем Windows и Linux, чтобы обеспечить необходимую операционную среду для нашего желаемого приложения или программного обеспечения во время установки. Серверы Windows могут стоить вдвое дороже, чем серверы Linux у некоторых провайдеров. Вы должны учитывать это при выборе провайдера.

| **Провайдер** | **Цена** | **ОЗУ** | **CPU ядра** | **Хранилище** | **Трафик/Пропускная способность** |
|---|---|---|---|---|---|
| [Linode](https://www.linode.com/pricing/) | $12/мес | 2GB | 1 CPU | 50 GB | 2 TB |
| [DigitalOcean](https://www.digitalocean.com/pricing) | $10/мес | 2GB | 1 CPU | 50 GB | 2 TB |
| [OneHostCloud](https://onehostcloud.hosting/) | $14.99/мес | 2GB | 1 CPU | 50 GB | 2 TB |


# Настройка VPS

---

Независимо от того, находимся ли мы на внутреннем или внешнем тесте на проникновение, VPS, который мы можем использовать, имеет для нас большое значение во многих различных случаях. Мы можем хранить на нем все наши ресурсы и получать к ним доступ практически из любой точки с доступом в интернет. Помимо того, что мы должны сначала настроить VPS, мы также должны подготовить соответствующую структуру папок и его сервисы. В этом примере мы рассмотрим провайдера под названием [Linode](https://www.linode.com/) и настроим там наш VPS. Для других провайдеров параметры конфигурации выглядят почти идентично.

В первую очередь нам нужно выбрать ближайшее к нам местоположение. Это обеспечит отличное соединение с нашим сервером. Если нам нужно выполнить тест на проникновение на другом континенте, мы также можем настроить там VPS, используя наши сценарии автоматизации, и выполнить тест на проникновение оттуда. Тем не менее, мы всё равно должны внимательно читать индивидуальную информацию об их компонентах и понимать, с каким типом VPS мы будем работать в будущем. В Linode мы можем выбрать один из четырех разных серверов. Для наших целей на данный момент достаточно сервера с `Shared CPU`. Для Linux-дистрибутива мы выбираем, какая операционная система должна быть установлена на VPS. ParrotOS основана на `Debian`, как и Ubuntu. Здесь мы можем выбрать один из этих двух или перейти к расширенным опциям и загрузить наш ISO.

![Экран создания Linode, показывающий регион установленный на Франкфурт, ОС как Ubuntu 24.04 LTS, и планы с общим CPU с ценами для Nanode 1 GB и Linode 2 GB.](https://academy.hackthebox.com/storage/modules/87/vpss1.png)

Marketplace от Linode предлагает множество различных приложений, которые были предварительно настроены и могут быть установлены сразу.

![Экран Marketplace от Linode, показывающий варианты выбора новых приложений, таких как Apache Spark, Backstage, и популярные приложения, такие как WordPress и cPanel.](https://academy.hackthebox.com/storage/modules/87/vpss2.png)

Далее нам нужно выбрать уровень производительности для нашего VPS. Это один из пунктов, где стоимость может сильно измениться. Для наших целей, однако, мы можем выбрать один из первых двух вариантов сверху. Тем не менее, здесь нам нужно выбрать производительность, для которой мы хотим использовать VPS. Если VPS будет использоваться для продвинутых целей и обеспечивает множество запросов и сервисов, 1024MB памяти будет недостаточно. Поэтому всегда рекомендуется сначала настроить установку нашей ОС локально в VM, а затем проверить нагрузку сервисов.

![Экран планов Linode, показывающий опции с общим CPU с ценами и спецификациями для Nanode 1 GB и Linode 2 GB, включая RAM, хранилище и детали трафика.](https://academy.hackthebox.com/storage/modules/87/vpss3.png)

После этого в разделе `Security` нам нужно указать пароль для `root` и мы также можем добавить SSH-ключи, которые мы можем использовать для входа на VPS через SSH позже. Мы также можем сгенерировать эти ключи позже на нашем VPS, нашей VM или собственной хост-операционной системе. Давайте используем нашу VM для генерации пары ключей. Давайте сгенерируем новый SSH-ключ и добавим его на наш VPS.

#### Генерация SSH-ключей

```shell
┌─[cry0l1t3@parrot]─[~]
└──╼ $ ssh-keygen -t ed25519 -f vps-ssh

Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase): ******************
Enter same passphrase again: ******************
Your identification has been saved in vps-ssh
Your public key has been saved in vps-ssh.pub
The key fingerprint is:
SHA256:zXyVAWK00000000000000000000VS4a/f0000+ag cry0l1t3@parrot
The key's randomart image is:
<SNIP>
```

С помощью команды, показанной выше, мы генерируем два разных ключа. `vps-ssh` - это `приватный ключ`, и он не должен быть передан куда-либо или кому-либо. Второй `vps-ssh.pub` - это `публичный ключ`, который мы теперь можем вставить в панель управления Linode.

#### SSH-ключи

```shell
┌─[cry0l1t3@parrot]─[~]
└──╼ $ ls -l vps*-rw------- 1 cry0l1t3 cry0l1t3 3434 Mar 30 12:23 vps-ssh
-rw-r--r-- 1 cry0l1t3 cry0l1t3  741 Mar 30 12:23 vps-ssh.pub

┌─[cry0l1t3@parrot]─[~]
└──╼ $ cat vps-ssh.py
```

![Экран настройки SSH-ключа Linode с полями для 'Метка' и 'Публичный SSH-ключ', и опциями для добавления или отмены.](https://academy.hackthebox.com/storage/modules/87/vpss4.png)

После того как всё настроено, мы можем нажать на `Create Linode` и подождать, пока завершится установка. После того как VPS будет готов, мы можем получить к нему доступ через SSH.

#### SSH с использованием пароля

```shell
cry0l1t3@htb[/htb]$ ssh root@<vps-ip-address>

root@VPS's password:

[root@VPS ~]#
```

После этого мы должны добавить нового пользователя для VPS, чтобы не запускать наши сервисы с привилегиями root или администратора. Для этого мы можем затем сгенерировать еще один SSH-ключ и добавить его для этого пользователя.

#### Добавление нового пользователя с правами sudo

```shell
[root@VPS ~]# adduser cry0l1t3
[root@VPS ~]# usermod -aG sudo cry0l1t3
[root@VPS ~]# su - cry0l1t3
Password: ********

[cry0l1t3@VPS ~]$
```

#### Добавление публичного SSH-ключа на VPS

```shell
[cry0l1t3@VPS ~]$ mkdir ~/.ssh
[cry0l1t3@VPS ~]$ echo '<vps-ssh.pub>' > ~/.ssh/authorized_keys
[cry0l1t3@VPS ~]$ chmod 600 ~/.ssh/authorized_keys
```

После того как мы добавили это в файл `authorized_keys`, мы можем использовать `приватный ключ` для входа в систему через SSH.

#### Использование SSH-ключей

```shell
Cry0l1t3@htb[/htb]$ ssh cry0l1t3@<vps-ip-address> -i vps-ssh

[cry0l1t3@VPS ~]$
```


# Управление сервером

---

Когда речь идет об управлении сервером, одним из наиболее важных аспектов (помимо безопасности) является поддержание сервера быстрым, надежным и готовым к выполнению задач, для которых он был создан. Поэтому настоятельно рекомендуется поддерживать сервер в актуальном состоянии и настраивать его таким образом, чтобы у него было достаточно ресурсов для обработки всего необходимого. Еще одним важным аспектом является доступ к серверу. Вместо того, чтобы настраивать все службы, которые мы хотим использовать, а затем сосредотачиваться на ограничении способов доступа к серверу, мы сделаем это наоборот. В противном случае, определенные точки доступа к нашему собственному серверу могут быть упущены из виду, что сделает нас уязвимыми. Поэтому, когда мы начинаем создавать удаленный сервер, сначала необходимо убедиться, что сервер имеет только один способ доступа с использованием защищенного протокола для связи. Лучший подход — убедиться, что в начале доступ к серверу возможен только через SSH с использованием ключа аутентификации, а не пароля.

Усиление доступа через SSH — один важный аспект. Другой аспект, на котором мы также должны сосредоточиться, — это управление ключами. Когда нам нужно управлять всего несколькими серверами, это может быть довольно легко и понятно. Однако, когда ваша ответственность возрастает до управления несколькими сотнями серверов, возникает высокая потребность в их эффективном управлении. В таком случае организации и предприятия используют комбинацию [Teleport](https://goteleport.com/) и [Ansible](https://docs.ansible.com/ansible/latest/index.html#).

При настройке сервера рекомендуется придерживаться принципа `Zero Trust` — `Никто и ничто - как внутри, так и вне сети - не может быть автоматически доверенным`. Представьте это как здание с высоким уровнем безопасности. Даже если вы сотрудник, вам нужно показывать свое удостоверение личности и проходить контрольно-пропускной пункт каждый раз, когда вы входите, и у вас есть доступ только к тем комнатам, которые вам нужны.

---

## SSH Agent

SSH Agent — это программа, которая работает в фоновом режиме и обычно устанавливается по умолчанию в большинстве систем Linux. Мы используем инструмент `ssh` для безопасного подключения к нашим удаленным серверам, и SSH agent помогает, храня и управляя вашими ключами SSH, которые похожи на ваше удостоверение личности, используемое для подтверждения вашей личности на сервере. Давайте сначала убедимся, что мы усилим наш SSH-сервер и сделаем его немного более безопасным. В дистрибутивах Ubuntu и Debian конфигурационный файл SSH-сервера находится в `/etc/ssh/sshd_config`.

#### Сторона сервера

```bash
cry0l1t3@MyVPS:~$ vim /etc/ssh/sshd_config
```

Вы увидите множество различных настроек, которые можно включить, но первые, которые мы настоятельно рекомендуем изменить, следующие:

```bash
PermitRootLogin no
PubkeyAuthentication yes
PasswordAuthentication no
X11Forwarding no
Port 4444
AllowUsers cry0l1t3
```

В этом примере мы отключили доступ для пользователя `root` через SSH и разрешили соединения на TCP-порту 4444 для пользователя `cry0l1t3` только через метод аутентификации по ключу ssh. После внесения этих изменений нам нужно перезапустить SSH-сервер.

```bash
cry0l1t3@MyVPS:~$ sudo service ssh restart
```

Для использования SSH agent есть несколько вещей, которые нам нужно сделать. Во-первых, нам нужен высокозащищенный ключ SSH. Один из наиболее эффективных методов следующий:

#### Сторона клиента

```bash
cry0l1t3@htb:~$ ssh-keygen -t ed25519 -f ~/.ssh/cry0l1t3

Generating public/private ed25519 key pair.
Enter passphrase (empty for no passphrase): ****************************
Enter same passphrase again: ****************************

Your identification has been saved in /home/cry0l1t3/.ssh/cry0l1t3
Your public key has been saved in /home/cry0l1t3/.ssh/cry0l1t3.pub
The key fingerprint is:
SHA256:5TNgGHaqFsIhfqbsFPxa2PllgV2NZdHacaxNddlA0WI cry0l1t3@MyVPS
The key's randomart image is:
+--[ED25519 256]--+
|. .   o ..++o.=+*|
|oo . .o=.... oE=+|
| +oo..ooo . o.*. |
|. O..o ..+ . o . |
| = =o  oS +      |
|o o.. o    o     |
| o   .           |
|                 |
|                 |
+----[SHA256]-----+
```

Убедитесь, что на этом этапе вы добавили свой открытый ключ SSH (`<your_key>.pub`) на удаленный сервер в файл `~/.ssh/authorized_keys` и установили соответствующие разрешения для этого файла.

```bash
# Удаленный сервер
cry0l1t3@MyVPS:~$ sudo chmod 600 ~/.ssh/authorized_keys
```

Затем нам нужно добавить приватный ключ в SSH agent и создать конфигурационный файл для SSH agent в директории `.ssh`.

```bash
cry0l1t3@MyVPS:~$ ssh-add ~/.ssh/cry0l1t3
Enter passphrase for /home/cry0l1t3/.ssh/cry0l1t3:
Identity added: /home/cry0l1t3/.ssh/cry0l1t3 (cry0l1t3@MyVPS)

cry0l1t3@MyVPS:~$ vim ~/.ssh/config
```

В этом конфигурационном файле мы настроим имя, которое хотим использовать для сервера, его IP-адрес или доменное имя, идентификационный файл, порт, пользователя и укажем SSH использовать только указанный ключ, а не пробовать другие ключи. Это делает соединения немного быстрее и существенно более безопасными.

```bash
Host MyVPS
    HostName <IP Address/domain name>
    IdentityFile ~/.ssh/cry0l1t3
    Port 4444
    User cry0l1t3
    IdentitiesOnly yes
```

С помощью следующей команды мы запускаем SSH agent в нашей терминальной сессии. Если вы хотите запускать SSH agent автоматически, вы можете добавить эту команду в ваш файл `~/.bashrc` или `~/.zshrc`.

```bash
cry0l1t3@htb:~$ eval $(ssh-agent)
```

Теперь мы можем использовать SSH-клиент, просто набрав имя (`MyVPS`), которое мы установили для этого сервера, и подключиться к нему.

```bash
cry0l1t3@htb:~$ ssh MyVPS
```

---

## Управление паролями и секретами

Управление паролями — это практика создания, хранения и организации паролей и секретов для обеспечения безопасного доступа к учетным записям и системам, требуя при этом меньше усилий для использования. Поскольку большинство людей используют один пароль (который часто даже не является безопасным), настоятельно рекомендуется иметь менеджер паролей, который может генерировать и хранить сложные пароли. Есть много различных вариантов, из которых вы можете выбрать:

| [Proton](https://proton.me/pass) | [Bitwarden](https://bitwarden.com/) | [1Password](https://1password.com/) | [Passbolt](https://www.passbolt.com/) | [Psono](https://psono.com/) | [Passky](https://passky.org/) | [OpenBao](https://openbao.org/) |
|---------|-----------|-----------|----------|-------|--------|---------|

Вы можете использовать любой из этих менеджеров, так как все они предоставляют подходящие решения для безопасного хранения данных. За исключением Psono и Passbolt, все упомянутые менеджеры используют сквозное шифрование (E2EE), которое позволяет только пользователю расшифровывать его. E2EE — это модель безопасности, где данные шифруются на устройстве отправителя и могут быть расшифрованы только на устройстве получателя. Никто между ними (включая поставщиков услуг) не может получить доступ к нешифрованным (открытым) данным.

Psono использует шифрование на стороне клиента, а Passbolt использует GPG-шифрование. GPG-шифрование использует приватные и публичные ключи, подобно SSH. Публичный ключ (которым можно поделиться с другими) используется для шифрования, и только тот, кто владеет приватным ключом (который никогда не следует передавать другим), может расшифровать данные. Шифрование на стороне клиента означает, что данные шифруются на устройстве перед отправкой.

Кроме того, Linode имеет предварительно настроенные образы на своем маркетплейсе, которые можно использовать для быстрого развертывания таких менеджеров.

![Экран выбора приложений Linode Marketplace, показывающий варианты OpenBao, HashiCorp Vault, Passbolt Community Edition и Passky.](https://academy.hackthebox.com/storage/modules/87/servm1.png)

---

## Git Hosting

Git — это распределенная система контроля версий (DVCS), разработанная для помощи разработчикам в управлении изменениями файлов, особенно кода, с течением времени. Она позволяет сотрудничать над проектом с несколькими людьми, отслеживать историю изменений и эффективно поддерживать различные версии своей работы.

Например, если вы выпускаете новую версию вашего программного обеспечения или инструмента, и что-то ломается, вы всегда можете вернуться к предыдущей версии. Кроме того, вы можете работать над множеством функций одновременно, не нарушая оригинальную версию вашего программного обеспечения, а затем объединять их в исходную ветку, как только они будут протестированы. Этот процесс также известен как Непрерывная Интеграция и Непрерывная Поставка или Развертывание (CI/CD).

Помимо разработки инструментов и программного обеспечения, мы можем использовать частные репозитории для наших собственных предпочтений и нужд. Например, мы можем хранить наши dotfiles (конфигурационные файлы) для нашей среды или служб. Это делает настройку новых виртуальных машин более оптимизированной, поскольку мы можем легко клонировать репозиторий и заменить необходимые конфигурационные файлы.

Существует множество провайдеров, использующих эту технологию, и многие из них могут быть размещены самостоятельно, если это необходимо.

| [Github](https://github.com/) | [Gitlab](https://about.gitlab.com/) | [BitBucket](https://bitbucket.org/) | [Gitea](https://about.gitea.com/) | [OneDev](https://onedev.io/) |
|--------|---------|----------|-------|--------|

Linode также предоставляет предварительно настроенные образы, которые можно использовать сразу.

![Экран выбора приложений Linode Marketplace, показывающий варианты Gitea и GitLab в категории Разработка.](https://academy.hackthebox.com/storage/modules/87/servm2.png)





# 1.7 Сетевая безопасность

---

Сетевая безопасность является одним из наиболее критических аспектов кибербезопасности и требует максимального внимания. Поскольку в этой части мы устанавливаем правила доступа, крайне важно сделать это правильно. После настройки нам остаётся в основном мониторить и обеспечивать сохранение защищённости. Однако даже это представляет собой огромный объём работы.

Поскольку мы фокусируемся на безопасности (и одновременно на эффективности), нам нужно решение, позволяющее быстро и легко настроить доступ к удалённым серверам. Некоторые из таких решений предлагаются:

| [Netbird](https://netbird.io/) | [Tailscale](https://tailscale.com/) | [Twingate](https://www.twingate.com/) |
|-------------------------------|-----------------------------------|----------------------------------|

Zero Trust Network Access (`ZTNA`) — это то, на чём фокусируются эти провайдеры, и это относительно новая концепция. Переосмысливая безопасный доступ, ZTNA представляет собой значительный отход от традиционных периметрических моделей, таких как VPN. Основываясь на принципе `никогда не доверяй, всегда проверяй`, ZTNA аутентифицирует и авторизует каждого пользователя, каждое устройство и каждую попытку подключения на основе идентификации, контекста, устройства и статуса безопасности, обеспечивая детализированный доступ к ресурсам, настроенным администраторами, вместо широкого сетевого или группового доступа.

С одной стороны, это делает наши сетевые ресурсы гораздо более безопасными. С другой стороны, управление каждым отдельным устройством и ресурсом может стать очень сложным. Выбор решения зависит от конкретного случая.

[Netbird](https://netbird.io/) отлично подходит для случаев, требующих простой, автоматизированной настройки для безопасного доступа к облачным и локальным ресурсам, например, для подключения рабочих станций разработчиков к частным репозиториям.

[Tailscale](https://tailscale.com/) — это виртуальное приватное облако на базе WireGuard, требующее минимальной настройки, что делает его идеальным для обеспечения безопасных подключений удалённых сотрудников к внутренним сервисам (например, CI/CD-конвейерам, внутренним панелям мониторинга) или для организации сетевого взаимодействия между сайтами без сложных правил брандмауэра.

Архитектура Relay и Connector от [Twingate](https://www.twingate.com/) и API-ориентированный дизайн делают его идеальным для обеспечения безопасного доступа к базам данных, кластерам Kubernetes или устаревшим приложениям в мультиоблачных или локальных средах.

Настоятельно рекомендуется бесплатно попробовать каждое из них и выяснить, какое лучше всего соответствует вашим потребностям. Поскольку эти провайдеры предлагают схожие услуги, каждый из них имеет свою философию и фокус. Какое решение подходит именно вам — вопрос, на который можно ответить только после понимания, как будет выглядеть ваша сеть. В нашем случае мы будем использовать Netbird.

---

## Netbird

Открытый исходный код Netbird и одноранговая (P2P) сетевая структура на базе WireGuard делают его идеальным для команд с техническими навыками управления инфраструктурой, особенно для защиты гибридных сред с распределёнными устройствами, таких как удалённые рабочие места, серверы, внутренние ресурсы или даже небольшие филиалы. Огромным преимуществом Netbird является возможность самостоятельного хостинга.

Посетив страницу Netbird, вы можете зарегистрироваться бесплатно. Процесс регистрации довольно прост и не требует подробных объяснений. После подтверждения адреса электронной почты вы получите доступ к панели управления, которая будет выглядеть примерно так:

#### Панель управления

![Интерфейс Netbird, показывающий список из 5 узлов с такими деталями, как имя, адрес, группы, последнее соединение, ОС и версия. Доступны опции фильтрации и добавления узлов.](https://academy.hackthebox.com/storage/modules/87/net1.png)

Как видно на панели управления выше, в сети есть 5 узлов (peers). Вы увидите имя каждого узла, его внутренний IP-адрес, доменное имя, время последнего соединения, ОС и версию клиента Netbird, используемую системой.

Теперь, когда мы настроили VPS, мы можем добавить его в нашу внутреннюю сеть в Netbird. Для этого нам нужно настроить так называемые "Ключи настройки" (Setup Keys), которые сообщают Netbird, к какой сети принадлежит клиент.

Для этого можно нажать на `Create Setup Key` и указать имя для этого ключа настройки.

#### Ключи настройки

![Экран создания ключа настройки Netbird с полями для 'Имени', 'Сделать этот ключ многоразовым', 'Ограничение использования', 'Срок действия', и переключателями для 'Временных узлов' и 'Разрешить дополнительные DNS-метки'.](https://academy.hackthebox.com/storage/modules/87/net2.png)

Появится всплывающее окно, показывающее ключ настройки, который нужно скопировать. Этот ключ будет использоваться на VPS для подключения к сети.

![Подтверждение создания ключа настройки с отображением ключа и опциями 'Закрыть' или 'Установить NetBird'.](https://academy.hackthebox.com/storage/modules/87/net3.png)

После того, как вы скопировали ключ, вы увидите ещё одно всплывающее окно с инструкциями для каждой операционной системы, которые можно использовать для подключения узла с помощью ключа настройки.

![Экран установки NetBird для Linux с инструкциями командной строки для установки и запуска с использованием ключа настройки.](https://academy.hackthebox.com/storage/modules/87/net4.png)

В нашем примере для Ubuntu мы будем использовать команду `curl` с предоставленным URL, которая загружает и выполняет скрипт оболочки для автоматической установки. Вас попросят ввести пароль, и после установки вы увидите сообщение о том, что клиент netbird запущен и работает.

```shell-session
cry0l1t3@MyVPS:~$ curl -fsSL https://pkgs.netbird.io/install.sh | sh

The installation will be performed using apt package manager
[sudo] password for cry0l1t3: *****************

<SNIP>

NetBird service has already been loaded
Netbird service has been started
Installation has been finished. To connect, you need to run NetBird by executing the following command:

netbird up
```

Далее мы будем использовать сгенерированный ключ настройки и укажем его в клиенте Netbird с помощью следующей команды:

```shell-session
cry0l1t3@MyVPS:~$ netbird up --setup-key 826BC181-63D4-4875-84C3-9949FDEA48EE

Connected
```

Мы должны увидеть сообщение о том, что наш узел теперь подключен к сети. Когда Netbird запускается, он создаёт новый сетевой интерфейс, который обычно называется `wt0`. Мы можем использовать `ifconfig` или `ip addr` для проверки наличия нового сетевого интерфейса.

```shell-session
cry0l1t3@MyVPS:~$ ifconfig wt0

wt0: flags=209<UP,POINTOPOINT,RUNNING,NOARP>  mtu 1280
        inet 100.108.232.34  netmask 255.255.0.0  destination 100.108.232.34
        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 1000  (UNSPEC)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

После подтверждения нам нужно перейти в панель управления Netbird. Здесь вы увидите появившийся узел, запрашивающий одобрение. Имейте в виду, что даже если кто-то похитил ваш ключ настройки и попытался подключиться к вашей сети, этот узел всё равно потребует одобрения администратора.

![Запись MyVPS, показывающая статус "онлайн", адрес 'myvps.netbird.cloud', последнее соединение 'только что', версия 0.41.3, с кнопками 'Требуется одобрение' и 'Одобрить'.](https://academy.hackthebox.com/storage/modules/87/net5.png)

После одобрения мы можем проверить соединение, попытавшись подключиться к нему через SSH.

```shell-session
cry0l1t3@htb:~$ ssh cry0l1t3@myvps.netbird.cloud

The authenticity of host 'myvps.netbird.cloud (100.108.232.34)' can't be established.
ED25519 key fingerprint is SHA256:NuxuseOH6mjejxr7dGWmBEYb4dHCi24eSFm+9qnn4lI.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes

Warning: Permanently added 'myvps.netbird.cloud' (ED25519) to the list of known hosts.

cry0l1t3@myvps.netbird.cloud's password: *******************

Welcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.11.0-21-generic x86_64)

<SNIP>

cry0l1t3@MyVPS:~$
```

Далее, поскольку соединение работает, мы можем настроить брандмауэр, чтобы разрешить входящие соединения только на интерфейсе `wt0` и отклонять всё остальное, кроме исходящих соединений. Мы можем использовать инструмент `ufw` или `iptables`. Для простоты будем использовать `ufw`.

#### Настройка брандмауэра

```shell-session
# Разрешаем входящие соединения только с интерфейса netbird wt0
# Сбрасываем ufw до состояния по умолчанию
ufw --force reset

# Разрешаем весь входящий трафик на интерфейсе wt0
ufw allow in on wt0

# Устанавливаем политики по умолчанию
ufw default deny incoming
ufw default allow outgoing

# Включаем ufw
ufw --force enable

# Отображаем статус ufw
ufw status
```

Дополнительно мы можем ещё больше усилить безопасность нашего SSH-сервера, указав ему прослушивать только интерфейс `wt0` с помощью следующего скрипта.

#### Альтернативная конфигурация SSH

```bash
#!/bin/bash

# Получаем IP-адрес интерфейса wt0
WT0_IP=$(ip addr show wt0 | grep -oP 'inet \K[\d.]+')

# Создаём резервную копию текущей конфигурации SSH
SSHD_CONF="/etc/ssh/sshd_config"
BACKUP_CONF="/etc/ssh/sshd_config.bak_$(date +%F_%H-%M-%S)"
cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak

# Проверяем, настроен ли уже ListenAddress
if grep -q "^ListenAddress" "$SSHD_CONF"; then
    # Заменяем существующий ListenAddress
    sed -i "s/^ListenAddress.*/ListenAddress $WT0_IP/" "$SSHD_CONF"
else
    # Добавляем ListenAddress
    echo "ListenAddress $WT0_IP" >> "$SSHD_CONFIG"
fi

# Убеждаемся, что SSH не прослушивает 0.0.0.0 или ::
sed -i '/^ListenAddress 0.0.0.0/d' "$SSHD_CONFIG"
sed -i '/^ListenAddress ::/d' "$SSHD_CONFIG"

# Проверяем конфигурацию SSH
if sshd -t; then
    echo "SSH конфигурация действительна."
else
    echo "Ошибка: Недействительная конфигурация SSH. Восстанавливаем из резервной копии."
    cp "$BACKUP_CONFIG" "$SSHD_CONFIG"
    exit 1
fi

# Перезапускаем SSH сервис
systemctl restart sshd
if [ $? -eq 0 ]; then
    echo "SSH сервис успешно перезапущен."
else
    echo "Ошибка: Не удалось перезапустить SSH сервис."
    exit 1
fi
```




# Защита VPS

---

Еще одним необходимым шагом в настройке нашего VPS является укрепление системы и доступа. Мы должны ограничить доступ к VPS через SSH и отключить все остальные службы на VPS. В итоге мы сведем к минимуму возможные векторы атаки и обеспечим только один возможный доступ к нашему VPS, который мы максимально защитим. Следует помнить, что, по возможности, мы не должны хранить какие-либо конфиденциальные данные на VPS, или хранить их только в течение короткого периода времени, когда мы проводим внутренний тест на проникновение. При этом мы должны следовать принципу, что кто-то может получить доступ к системе рано или поздно.

Однако, поскольку в данном случае VPS используется только как источник для наших инструментов и ресурсов организации, к которым мы можем получить доступ через SSH, мы должны соответствующим образом защитить SSH-сервер, чтобы никто другой (или, по крайней мере, никто кроме членов команды) не мог получить к нему доступ. Существует множество способов его защиты, и это включает следующие меры предосторожности, но не ограничивается ими:

* Установка Fail2ban
* Работа только с SSH-ключами
* Сокращение интервала таймаута простоя
* Отключение паролей
* Отключение пересылки x11
* Использование другого порта
* Ограничение доступа пользователей к SSH
* Отключение входа в систему root
* Использование SSH протокола 2
* Включение 2FA-аутентификации для SSH

`Настоятельно рекомендуется сначала опробовать эти настройки и меры предосторожности в локальной VM, которую мы создали, прежде чем применять их на VPS.`

Один из первых шагов в укреплении нашей системы - обновление и приведение системы в состояние `актуальности`. Мы можем сделать это с помощью следующих команд:

#### Обновление системы

```bash
cry0l1t3@MyVPS:~$ sudo apt update -y && sudo apt full-upgrade -y && sudo apt autoremove -y && sudo apt autoclean -y
```

---

## Защита SSH

SSH всегда установлен на VPS, что дает нам гарантированный доступ к серверу заранее. Теперь мы можем изменить некоторые настройки в конфигурационном файле `/etc/ssh/sshd_config`, чтобы применить эти меры безопасности для нашего SSH-сервера. В этом файле мы закомментируем, изменим или добавим некоторые строки. Полный список возможных настроек для SSH-демона можно найти на [man-странице](https://man.openbsd.org/sshd_config).

#### Установка Fail2Ban

```bash
cry0l1t3@MyVPS:~$ sudo apt install fail2ban -y
```

После установки мы можем найти конфигурационный файл в `/etc/fail2ban/jail.conf`. Нам нужно сделать копию этого файла, чтобы наши изменения не были перезаписаны во время обновлений.

#### Резервное копирование конфигурации Fail2Ban

```bash
cry0l1t3@MyVPS:~$ sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
```

В этом файле мы найдем поле, закомментированное с помощью `# [sshd]`. В большинстве случаев первая строка там уже закомментирована. В противном случае мы добавляем это и еще две строки, как показано в следующем примере:

#### /etc/fail2ban/jail.local

```bash
...SNIP...

# [sshd]
enabled = true
bantime = 4w
maxretry = 3

```

С этим мы включаем мониторинг для SSH-сервера, устанавливаем `время блокировки` на четыре недели и разрешаем максимум 3 `попытки`. Преимущество этого заключается в том, что, как только мы настроим нашу функцию `2FA` для SSH, fail2ban также заблокирует IP-адрес, который трижды неправильно ввел `код верификации`. Мы должны внести следующие изменения в файл `/etc/ssh/sshd_config`:

#### Редактирование конфигурации OpenSSH

```bash
cry0l1t3@MyVPS:~$ sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak
cry0l1t3@MyVPS:~$ sudo vim /etc/ssh/sshd_config
```

| **Настройки** | **Описание** |
|---------------|--------------|
| LogLevel VERBOSE | Задает уровень детализации при логировании сообщений от SSH-демона. |
| PermitRootLogin no | Указывает, может ли root входить в систему с помощью SSH. |
| MaxAuthTries 3 | Указывает максимальное количество попыток аутентификации, разрешенных для одного соединения. |
| MaxSessions 5 | Указывает максимальное количество открытых оболочек, сеансов входа или подсистем (например, SFTP), разрешенных для одного сетевого соединения. |
| HostbasedAuthentication no | Указывает, разрешена ли аутентификация rhosts или /etc/hosts.equiv вместе с успешной аутентификацией хоста с открытым ключом клиента (аутентификация на основе хоста). |
| PermitEmptyPasswords no | Когда разрешена аутентификация по паролю, указывает, разрешает ли сервер вход в учетные записи с пустыми строками пароля. |
| ChallengeResponseAuthentication yes | Указывает, разрешена ли аутентификация типа "вызов-ответ". |
| UsePAM yes | Указывает, следует ли использовать модули PAM для аутентификации. |
| X11Forwarding no | Указывает, разрешена ли пересылка X11. |
| PrintMotd no | Указывает, должен ли SSH-демон печатать /etc/motd при интерактивном входе пользователя. |
| ClientAliveInterval 600 | Устанавливает интервал тайм-аута в секундах, после которого, если данные не получены от клиента, SSH-демон отправит сообщение через зашифрованный канал для запроса ответа от клиента. |
| ClientAliveCountMax 0 | Устанавливает количество сообщений client alive, которые могут быть отправлены без получения SSH-демоном каких-либо сообщений от клиента. |
| AllowUsers <username> | За этим ключевым словом может следовать список шаблонов имен пользователей, разделенных пробелами. Если указано, вход разрешен только для имен пользователей, которые соответствуют одному из шаблонов. |
| Protocol 2 | Указывает на использование более нового протокола, который является более безопасным. |
| AuthenticationMethods publickey,keyboard-interactive | Указывает методы аутентификации, которые должны быть успешно завершены для предоставления пользователю доступа. |
| PasswordAuthentication no | Указывает, разрешена ли аутентификация по паролю. |
| DebianBanner no | Отключает баннер с его версией. |

---

## 2FA-аутентификация

С помощью конфигурации, показанной выше, мы уже предприняли важные шаги для защиты нашего SSH. Поэтому теперь мы можем пойти еще дальше и настроить `двухфакторную аутентификацию` (`2FA`). С этим мы используем стороннее программное обеспечение под названием Google Authenticator, которое генерирует шестизначный код каждые 30 секунд, необходимый для подтверждения нашей личности. Эти шестизначные коды представляют собой так называемый `Одноразовый пароль` (OTP). `2FA` зарекомендовала себя как метод аутентификации, не в последнюю очередь из-за своего относительно высокого стандарта безопасности по сравнению с временем, необходимым для внедрения. Два разных и независимых фактора аутентификации проверяют личность человека, запрашивающего доступ. Дополнительную информацию о `2FA` можно найти [здесь](https://en.wikipedia.org/wiki/Multi-factor_authentication).

Мы будем использовать Google Authenticator как наше приложение для аутентификации на нашем смартфоне Android или iOS. Для этого нам нужно загрузить и установить приложение из Google/Apple Store. Руководство по настройке Google Authenticator на нашем смартфоне можно найти [здесь](https://support.google.com/accounts/answer/185839?co=GENIE.Platform%3DDesktop&hl=en). Для настройки 2FA с Google Authenticator на нашем VPS нам нужен [модуль Google-Authenticator PAM](https://github.com/google/google-authenticator-libpam). Мы можем установить его и запустить, чтобы начать его настройку следующим образом:

#### Установка модуля Google-Authenticator PAM

```bash
cry0l1t3@MyVPS:~$ sudo apt install libpam-google-authenticator -y
cry0l1t3@MyVPS:~$ google-authenticator
Do you want authentication tokens to be time-based (y/n) y

Warning: pasting the following URL into your browser exposes the OTP secret to Google:
  https://www.google.com/chart?chs=200x200&chld=M|0&cht=qr&chl=otpauth://totp/cry0l1t3@MyVPS%3Fsecret%...SNIP...%26issuer%3DMyVPS

   [ ---- QR Code ---- ]

Your new secret key is: ***************
Enter code from app (-1 to skip):
```

Если мы следуем этим шагам, то в нашем терминале появится `QR-код` и `секретный ключ`, который мы можем затем отсканировать с помощью приложения Google Authenticator или ввести секретный ключ туда. После того, как мы отсканировали QR-код или ввели секретный ключ, мы увидим первый `OTP` (шестизначное число) на нашем смартфоне. Мы вводим его в наш терминал для синхронизации и авторизации Google Authenticator на нашем смартфоне и нашем VPS с Google.

Модуль затем сгенерирует несколько `аварийных кодов` (`резервных кодов`), которые мы должны сохранить в безопасном месте. Они будут использоваться в случае потери нашего смартфона. В случае потери мы можем войти в систему с помощью `резервных кодов`.

#### Конфигурация Google-Authenticator

```bash
Enter code from app (-1 to skip): <Google-Auth Code>

Code confirmed
Your emergency scratch codes are:
  21323478
  43822347
  60232018
  73234726
  45456791

Do you want me to update your "/home/cry0l1t3/.google_authenticator" file? (y/n) y

Do you want to disallow multiple uses of the same authentication
token? This restricts you to one login about every 30s, but it increases
your chances to notice or even prevent man-in-the-middle attacks (y/n) y

By default, a new token is generated every 30 seconds by the mobile app.
In order to compensate for possible time-skew between the client and the server,
we allow an extra token before and after the current time. This allows for a
time skew of up to 30 seconds between authentication server and client. If you
experience problems with poor time synchronization, you can increase the window
from its default size of 3 permitted codes (one previous code, the current
code, the next code) to 17 permitted codes (the 8 previous codes, the current
code, and the 8 next codes). This will permit for a time skew of up to 4 minutes
between client and server.
Do you want to do so? (y/n) n

If the computer that you are logging into isn't hardened against brute-force
login attempts, you can enable rate-limiting for the authentication module.
By default, this limits attackers to no more than 3 login attempts every 30s.
Do you want to enable rate-limiting? (y/n) y

```

Затем нам нужно настроить модуль [PAM](https://en.wikipedia.org/wiki/Linux_PAM) для SSH-демона. Для этого сначала создадим резервную копию файла и откроем его с помощью текстового редактора, такого как Vim.

#### Конфигурация 2FA PAM

```bash
cry0l1t3@MyVPS:~$ sudo cp /etc/pam.d/sshd /etc/pam.d/sshd.bak
cry0l1t3@MyVPS:~$ sudo vim /etc/pam.d/sshd
```

Мы комментируем строку "`@include common-auth`", поставив перед ней "`#`". Кроме того, добавляем две новые строки в конец файла следующим образом:

#### /etc/pam.d/sshd

```bash
#@include common-auth...SNIP...

auth required pam_google_authenticator.so
auth required pam_permit.so

```

Затем нам нужно настроить параметры в демоне SSH, чтобы разрешить этот метод аутентификации. В этом конфигурационном файле (`/etc/ssh/sshd_config`) нам нужно добавить две новые строки в конец файла следующим образом:

#### /etc/ssh/sshd_config

```bash
...SNIP...

AuthenticationMethods publickey,keyboard-interactive
PasswordAuthentication no

```

Наконец, мы должны перезапустить SSH-сервер, чтобы применить новые конфигурации и настройки.

#### Перезапуск SSH-сервера

```bash
cry0l1t3@MyVPS:~$ sudo service ssh restart
```

Теперь мы можем проверить это и попробовать войти на SSH-сервер с нашим SSH-ключом и проверить, работает ли все так, как задумано.

#### Вход в SSH с 2FA

```bash
cry0l1t3@MyVPS:~$ ssh cry0l1t3@VPS -i ~/.ssh/vps-ssh

Enter passphrase for key 'cry0l1t3': *************
Verification code: <Google-Auth Code>

```

Наконец, мы можем передать все наши ресурсы, скрипты, заметки и другие компоненты на VPS с помощью [SCP](https://en.wikipedia.org/wiki/Secure_copy_protocol).

#### Синтаксис SCP

```bash
cry0l1t3@MyVPS:~$ scp -i <ssh-private-key> -r <directory to transfer> <username>@<IP/FQDN>:<path>

```

#### Передача ресурсов

```bash
cry0l1t3@MyVPS:~$ scp -i ~/.ssh/vps-ssh -r ~/HackTheBox cry0l1t3@VPS:~/
Enter passphrase for key 'cry0l1t3': *************
Verification code: <Google-Auth Code>

```

---

Теперь мы должны иметь представление об использовании распространенных платформ виртуализации, таких как VMWare Workstation/Player и VirtualBox, и быть уверенными в настройке виртуальных машин с нуля. После практики примеров в этом модуле мы также должны быть уверены в настройке и защите как Windows, так и Linux машин для наших целей пентестинга. Наконец, стоит повторить шаги по настройке VPS с помощью провайдера, такого как Vultr, и попрактиковаться в его защите на основе шагов в этом разделе. Для нас важно уметь настраивать, защищать и поддерживать системы, которые мы используем во время наших оценок.





# Эмулятор терминала

---

Для нас крайне важно работать в терминале. Выбор терминала также сильно влияет на нашу эффективность и продуктивность. Существует множество эмуляторов терминала, каждый из которых предоставляет различные функции, хорошо подходящие для разных целей. Есть много вариантов на выбор, каждый разработан со своими принципами и направленностью. Некоторые из них предоставляют решение всё-в-одном, в то время как другие сосредоточены на скорости или настройке.

| [Alacritty](https://alacritty.org/) | [Ghostty](https://ghostty.org/) | [Wave Terminal](https://www.waveterm.dev/) |
|-------------------------------------|--------------------------------|-------------------------------------------|

[Ghostty](https://ghostty.org/) фокусируется на скорости и производительности, при этом позволяя настраивать самые необходимые части и предоставляя множество функций.

[Alacritty](https://alacritty.org/) с другой стороны, фокусируется на минимализме и производительности, что делает его очень быстрым благодаря ускорению GPU, но предоставляет меньше возможностей для настройки.

[Wave Terminal](https://www.waveterm.dev/) — это визуально потрясающий новый AI-нативный эмулятор терминала, разработанный для рабочих процессов разработчиков, с упором на современный интерфейс, встроенную визуализацию и постоянные сессии, но требует гораздо больше ресурсов, что может сделать его медленнее.

Настоятельно рекомендуется экспериментировать с новыми настройками и инструментами сначала на локальной ВМ, имеющей снимок системы, к которому вы всегда можете вернуться, если что-то пойдет не так. Поэтому мы будем использовать другую ВМ в следующих примерах, а затем применим эти настройки позже.

---

## Wave Terminal

Wave Terminal — это инновационный эмулятор терминала, созданный для разработчиков, который призван улучшить рабочие процессы за счет интеграции современных функций, управляемых ИИ, с традиционными возможностями командной строки. Одно из главных преимуществ этого терминала в том, что у вас всё в одном месте (включая браузер на основе Chromium), что уменьшает необходимость переключения между различными окнами.

Давайте [загрузим](https://www.waveterm.dev/download) этот терминал, установим его и рассмотрим поближе.

![Кнопка загрузки для Linux .snap x64 с командой: sudo snap install --classic waveterm.](https://academy.hackthebox.com/storage/modules/87/term1.png)

Для установки Wave Terminal на Ubuntu мы можем использовать пакетный менеджер `snap`.

```shell-session
cry0l1t3@ubuntu:~$ sudo snap install --classic waveterm
[sudo] password for cry0l1t3:  *********************

waveterm 0.11.2 from Command Line Inc (commandlinedev✓) installed

cry0l1t3@ubuntu:~$ waveterm
```

Wave Terminal предоставляет множество различных сочетаний клавиш, которые повышают скорость и продуктивность после того, как вы с ними познакомитесь. Вас встретит всплывающее окно, показывающее некоторые из сочетаний клавиш, которые позже можно изменить.

![Иконки и сочетания клавиш для Wave Terminal: Подключение к серверу, увеличение блока, настройки блока, закрытие блока, новая вкладка, новый блок терминала, навигация и переключение между блоками и вкладками, команды wsh.](https://academy.hackthebox.com/storage/modules/87/term2.png)

Когда мы впервые запускаем Wave Terminal, мы увидим следующие компоненты:

* Командная строка
* Монитор производительности
* Браузер
* Файловый менеджер
* Страница советов
* Страница помощи
* Окно чата с ИИ

![Интерфейс Wave Terminal, показывающий терминал, график CPU, страницу GitHub, каталог файлов и комбинации клавиш.](https://academy.hackthebox.com/storage/modules/87/term3.png)

Если мы посмотрим на [документацию](https://docs.waveterm.dev/), там есть 6 основных разделов, которые обеспечивают лучшее понимание того, что можно делать с этим эмулятором терминала.

* Настройка
* Комбинации клавиш
* Макет
* Удаленные подключения
* Виджеты
* Команда Wsh

![Меню документации Wave Terminal с разделами: Настройка, Комбинации клавиш, Макет, Удаленные подключения, Виджеты, команда wsh.](https://academy.hackthebox.com/storage/modules/87/term4.png)

Поскольку Wave Terminal использует компоненты ReactJS, это делает его высоко настраиваемым с точки зрения дизайна. Вы можете изменить общую тему для терминала и для командной строки отдельно. В окне командной строки вы увидите кнопку настроек в правом верхнем углу, которая показывает множество опций.

![Терминал с меню выбора темы, показывающим опции: Default, Default Dark, One Dark Pro, Dracula, Monokai, Campbell, Warm Yellow, Rose Pine.](https://academy.hackthebox.com/storage/modules/87/term5.png)

Wave Terminal предоставляет рабочие пространства, которые содержат желаемую коллекцию окон и виджетов. Когда вы щелкаете правой кнопкой мыши на вкладке рабочего пространства, вы также можете настроить для него тему.

![Терминал с меню выбора фона, показывающим опции: Default, Blue, Green, Red, Rainbow, Ocean Depths, Aqua Horizon, Sunset, Enchanted Forest, Twilight Mist.](https://academy.hackthebox.com/storage/modules/87/term6.png)

Наличие браузера в терминале может показаться излишним для большинства людей, поскольку это негативно влияет на производительность терминала. Однако, иметь всё на одном экране — один из ключевых аспектов продуктивности и эффективности. Особенно, учитывая, что Wave Terminal использует тайловое управление окнами для эффективного размещения окон без их перекрытия.

Многие люди любят иметь 2, 3 или даже 4 монитора и ноутбук на своем столе, что может выглядеть здорово, но поворачивать голову на 360 градусов в поисках нужной информации — всё, кроме эффективности.

Эффективность происходит от простоты. Самый эффективный и простой способ решить задачу (теоретически) — использовать один клик. Когда мы смотрим фильмы о "хакерах", проникающих в сеть за несколько секунд, нас впечатляет не только их знания, но еще больше их эффективность и скорость.

Поэтому, когда мы хотим быть эффективными и продуктивными, нам нужно сохранять простоту. Простая точка ориентации для измерения вашей продуктивности и эффективности:

* `Если вам нужно больше 1 экрана для комфортной работы, вы недостаточно оптимизировали свою настройку/окружение.`

Теперь давайте посмотрим на встроенный браузер и загрузим пользовательское фоновое изображение.

![Wave Terminal с меню фона и поиском Google по запросу 'hackthebox background', показывающим результаты изображений.](https://academy.hackthebox.com/storage/modules/87/term7.png)

После загрузки мы можем использовать встроенную команду `wsh` для управления Wave Terminal. Важно помнить, что команда `wsh` доступна только через Wave Terminal.

Теперь давайте изменим фон Wave Terminal с помощью изображения, которое мы загрузили, используя следующую команду:

```shell-session
cry0l1t3@ubuntu:~$ wsh setbg ~/Downloads/krgw3Cr1X7OIXLzBSB3uTh1FtKIk8hyo.jpg 

background set
```

После выполнения мы должны увидеть изменение фона, которое будет выглядеть примерно так:

![Терминал с командой установки фона и страницей настройки Wave, показывающей темы вкладок.](https://academy.hackthebox.com/storage/modules/87/term8.png)

#### Рабочие пространства

Как уже упоминалось, Wave Terminal позволяет создавать несколько рабочих пространств, которые могут служить для конкретных потребностей и окружений. Например, у нас может быть одно рабочее пространство для работы, другое для личного проекта и третье для частных нужд.

![Wave Terminal с переключателем рабочих пространств, показывающим опции: Hack The Box, Another Workspace, Create new workspace.](https://academy.hackthebox.com/storage/modules/87/term9.png)

#### Изменение размера блоков

Кроме того, встроенный тайловый оконный менеджер позволяет изменять размер окон либо с помощью клавиатуры, либо с помощью мыши.

![Терминал с каталогом файлов и отображенным графиком CPU.](https://academy.hackthebox.com/storage/modules/87/term10.png)

Кроме того, мы также можем реорганизовать окна, перемещая их в нужное положение. Например, мы можем переместить монитор производительности над файловым менеджером.

![Терминал с наложением каталога файлов и графика CPU.](https://academy.hackthebox.com/storage/modules/87/term11.png)

Это приведет к новой компоновке окон, которая будет выглядеть примерно так:

![Терминал с отображенным графиком CPU и каталогом файлов.](https://academy.hackthebox.com/storage/modules/87/term12.png)

С помощью сочетания клавиш `CTRL + M` мы можем "увеличить"/максимизировать выбранное окно почти до полного размера. Это отличная функция, которая помогает нам сосредоточиться на одном окне, не отвлекаясь на другие.

![График использования CPU с осями времени и процентов.](https://academy.hackthebox.com/storage/modules/87/term13.png)

Теперь давайте рассмотрим некоторые команды, которые предоставляет `wsh`.

```shell-session
cry0l1t3@ubuntu:~$ wsh help
wsh is a small utility that lets you do cool things with Wave Terminal, right from the command line

Usage:
  wsh [command]

Available Commands:
  ai          Send a message to an AI block
  completion  Generate the autocompletion script for the specified shell
  conn        manage Wave Terminal connections
  deleteblock delete a block
  edit        edit a file
  editconfig  edit Wave configuration files
  editor      edit a file (blocks until editor is closed)
  file        manage files across different storage systems
  getmeta     get metadata for an entity
  getvar      get variable(s) from a block
  help        Help about any command
  launch      launch a widget by its ID
  notify      create a notification
  readfile    read a blockfile
  run         run a command in a new block
  setbg       set background image or color for a tab
  setconfig   set config
  setmeta     set metadata for an entity
  setvar      set variable(s) for a block
  ssh         connect this terminal to a remote host
  term        open a terminal in directory
  version     Print the version number of wsh
  view        preview/edit a file or directory
  wavepath    Get paths to various waveterm files and directories
  web         web commands
  workspace   Manage workspaces
  wsl         connect this terminal to a local wsl connection

Flags:
  -b, --block string   for commands which require a block id
  -h, --help           help for wsh
```

С помощью команды `wsh view .` мы можем открыть файловый менеджер для указанного каталога (`.` - текущий каталог). Это открывает новое окно рядом с командной строкой со всей необходимой информацией, для которой обычно мы бы использовали команду `ls`.

![Терминал с командой 'wsh view' и списком файлов каталога.](https://academy.hackthebox.com/storage/modules/87/term14.png)

Теперь мы можем выбрать файл `.bashrc` в файловом менеджере, и он откроется во встроенном текстовом редакторе, который позволяет нам сразу модифицировать файл.

![Терминал с командой 'wsh view' и отображенным содержимым файла .bashrc.](https://academy.hackthebox.com/storage/modules/87/term15.png)

Опять же, максимизация/увеличение окна делает работу легче и удобнее.

![Терминал, отображающий содержимое файла .bashrc с комментариями и настройками.](https://academy.hackthebox.com/storage/modules/87/term16.png)

Далее, давайте взглянем на [документацию по конфигурации](https://docs.waveterm.dev/config). Используя `wsh editconfig`, мы можем редактировать файл конфигурации без необходимости его искать. На странице документации мы увидим множество различных ключей, которые можно установить, например, `web:defaulturl` для встроенного браузера. Давайте установим его на https://academy.hackthebox.com.

![Терминал с командой 'wsh editconfig' и файлом settings.json, показывающим настройки autoupdate, telemetry и web URL.](https://academy.hackthebox.com/storage/modules/87/term17.png)

После сохранения нажмем на виджет `Web` на правой боковой панели и проверим, открывается ли правильная страница.

![Терминал с командой 'wsh editconfig', файлом settings.json, показывающим конфигурацию, и веб-страницей HTB Academy.](https://academy.hackthebox.com/storage/modules/87/term18.png)

Давайте адаптируем всю тему терминала к стилю Hack The Box.

![Терминал с командой 'wsh editconfig termthemes.json' и конфигурацией темы JSON для Hack The Box.](https://academy.hackthebox.com/storage/modules/87/term19.png)

```bash
{
  "hackthebox": {
    "display:name": "Hack The Box",
    "display:order": 1,
    "black": "#000000",
    "red": "#ff3e3e",
    "green": "#9fef00",
    "yellow": "#ffaf00",
    "blue": "#004cff",
    "magenta": "#9f00ff",
    "cyan": "#2ee7b6",
    "white": "#ffffff",
    "brightBlack": "#666666",
    "brightRed": "#ff8484",
    "brightGreen": "#c5f467",
    "brightYellow": "#ffcc5c",
    "brightBlue": "#5cb2ff",
    "brightMagenta": "#c16cfa",
    "brightCyan": "#5cecc6",
    "brightWhite": "#ffffff",
    "gray": "#a4b1cd",
    "cmdtext": "#a4b1cd",
    "foreground": "#a4b1cd",
    "selectionBackground": "#313f55",
    "background": "#1a2332",
    "cursorAccent": "#313f55"
  }
}
```

Теперь давайте загрузим еще один [обои HTB](https://github.com/ParrotSec/parrot-wallpapers/blob/master/backgrounds/hackthebox.jpg) и установим его в качестве нового фона для терминала.

```shell-session
cry0l1t3@ubuntu:~$ wsh setbg ~/Downloads/hackthebox.jpg 

background set
```

После сохранения всех настроек, терминал должен выглядеть следующим образом:

![Терминал с командой 'wsh setbg ~/Downloads/hackthebox.jpg' и сообщением об установке фона.](https://academy.hackthebox.com/storage/modules/87/term20.png)





# Оболочка

---

Оболочка - это основная среда, с которой мы работаем на нашей VM для тестирования на проникновение. Поэтому нам необходимо убедиться, что эта среда соответствует всем нашим потребностям и настроена именно так, как мы хотим. Еще лучше, мы можем использовать скрипт конфигурации для настройки ее на других машинах таким же образом. Таким образом, для запуска новой виртуальной машины потребуется всего несколько команд, чтобы настроить оболочку так, как нам нужно, и наша работа, продуктивность и эффективность не пострадают.

Одна из самых настраиваемых и богатых функциями оболочек - это `Z Shell (ZSH)`.

---

## ZSH

Zsh включает множество функций и расширений, которые можно использовать. К ним относятся расширенное автодополнение при нажатии клавиши tab, подсветка синтаксиса, автопредложения и несколько других. Однако некоторые из этих функций требуют начальной настройки, хотя процесс установки и интеграции относительно прост. Для начала давайте получим доступ к нашему Ubuntu VPS и установим Zsh.

```bash
cry0l1t3@ubuntu:~$ sudo apt install zsh -y
cry0l1t3@ubuntu:~$ zsh
```

После первого запуска `Zsh` появится страница конфигурации. В этом случае вы можете ввести `q`, чтобы выйти без внесения изменений, так как конфигурация будет выполнена вручную.

```
This is the Z Shell configuration function for new users,
zsh-newuser-install.
You are seeing this message because you have no zsh startup files
(the files .zshenv, .zprofile, .zshrc, .zlogin in the directory
~).  This function can help you with a few settings that should
make your use of the shell easier.

You can:

(q)  Quit and do nothing.  The function will be run again next time.

(0)  Exit, creating the file ~/.zshrc containing just a comment.
     That will prevent this function being run again.

(1)  Continue to the main menu.

(2)  Populate your ~/.zshrc with the configuration recommended
     by the system administrator and exit (you will need to edit
     the file by hand, if so desired).

--- Type one of the keys in parentheses --- 
```

Теперь вы должны увидеть приглашение оболочки следующего вида:

```
ubuntu%
```

Одно из наиболее используемых расширений (фреймворк) называется [ohmyzsh](https://github.com/ohmyzsh/ohmyzsh/wiki). OhMyZsh - это фреймворк, который управляет и расширяет конфигурацию и функциональность zsh. Он упрощает процесс настройки Zsh еще больше, предоставляя коллекцию плагинов, тем и инструментов.

Установка `OhMyZsh` также проста и требует всего одной команды.

#### Oh-my-zsh

```bash
ubuntu% sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

Cloning Oh My Zsh...
remote: Enumerating objects: 1439, done.
remote: Counting objects: 100% (1439/1439), done.
remote: Compressing objects: 100% (1374/1374), done.
remote: Total 1439 (delta 42), reused 1250 (delta 37), pack-reused 0 (from 0)
Receiving objects: 100% (1439/1439), 3.28 MiB | 20.34 MiB/s, done.
Resolving deltas: 100% (42/42), done.
From https://github.com/ohmyzsh/ohmyzsh
 * [new branch]      master     -> origin/master
branch 'master' set up to track 'origin/master'.
Already on 'master'
/home/cry0l1t3

Looking for an existing zsh config...
Found /home/cry0l1t3/.zshrc. Backing up to /home/cry0l1t3/.zshrc.pre-oh-my-zsh
Using the Oh My Zsh template file and adding it to /home/cry0l1t3/.zshrc.


Time to change your default shell to zsh:
Do you want to change your default shell to zsh? [Y/n] y

Changing your shell to /usr/bin/zsh...
[sudo] password for cry0l1t3: ********************

Shell successfully changed to '/usr/bin/zsh'.

         __                                     __   
  ____  / /_     ____ ___  __  __   ____  _____/ /_  
 / __ \/ __ \   / __ `__ \/ / / /  /_  / / ___/ __ \ 
/ /_/ / / / /  / / / / / / /_/ /    / /_(__  ) / / / 
\____/_/ /_/  /_/ /_/ /_/\__, /    /___/____/_/ /_/  
                        /____/                       ....is now installed!

Before you scream Oh My Zsh! look over the `.zshrc` file to select plugins, themes, and options.

• Follow us on X: https://x.com/ohmyzsh
• Join our Discord community: https://discord.gg/ohmyzsh
• Get stickers, t-shirts, coffee mugs and more: https://shop.planetargon.com/collections/oh-my-zsh


➜  ~ 
```

После установки вы увидите новое приглашение оболочки со стрелкой.

Далее, давайте загрузим плагины `autosuggestions` и `syntax-highlighting` и установим их. Эти плагины мы поместим в каталог `~/.oh-my-zsh/custom`, где хранятся пользовательские плагины.

Эти плагины будут размещены в каталоге `~/.oh-my-zsh/custom`, где хранятся пользовательские плагины.

```bash
➜  ~ git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
➜  ~ git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
```

После того, как мы загрузили плагины, нам нужно настроить Zsh для их использования. Мы можем сделать это, отредактировав файл `~/.zshrc` и найдя раздел `plugins`. Внутри `plugins` мы "активируем" установленные плагины, поместив имена плагинов в квадратные скобки.

![Файл конфигурации Zsh, показывающий настройку плагинов и пользовательские настройки.](https://academy.hackthebox.com/storage/modules/87/sh1.png)

Полный список доступных плагинов для Zsh вы можете найти [здесь](https://github.com/ohmyzsh/ohmyzsh/wiki/plugins-overview). Настоятельно рекомендуется просмотреть этот список и выбрать все необходимые вам плагины.

Еще одно очень полезное дополнение к Zsh - тема Powerlevel10k, которая делает оболочку красивой и удобной для глаз. Это одна из самых популярных тем для Zsh, известная своей скоростью, гибкостью и визуально привлекательными приглашениями, отображающими контекстную информацию, такую как статус Git, пути к каталогам и системные детали.

Для установки можно использовать следующие команды:

#### Powerlevel10k

```bash
➜  ~ git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ~/powerlevel10k
➜  ~ echo 'source ~/powerlevel10k/powerlevel10k.zsh-theme' >>~/.zshrc
➜  ~ exec zsh
```

Вам будет предложена страница конфигурации для powerlevel10k, которая задаст серию вопросов для создания желаемой темы. Не стесняйтесь оформить ее так, как вы хотите, и помните, что вы всегда можете настроить ее снова. После прохождения этого процесса вы увидите оболочку, подобную этой:

![Терминал с фоном Hack The Box и приглашением командной строки.](https://academy.hackthebox.com/storage/modules/87/sh2.png)

Мы настоятельно рекомендуем изучить документацию Powerlevel10k, чтобы узнать о различных плагинах и определить, какие из них подходят именно вам. Если вы установите слишком много плагинов, это может значительно замедлить работу оболочки, что, опять же, снижает скорость и эффективность вашей работы.





# Мультиплексор

---

Мультиплексор терминала — это инструмент, который позволяет управлять несколькими сессиями терминала в одном окне или сеансе. Мы можем создавать, переключаться и организовывать несколько экземпляров терминала одновременно, повышая нашу продуктивность в командной строке. Мультиплексор позволяет разделить терминал на несколько окон, создавать панели (вкладки) и быстро перемещаться между ними с помощью простых сочетаний клавиш.

Например, мы можем открыть SSH-соединение в одном окне командной строки, разделить его вертикально и открыть страницу руководства в другом. Кроме того, мы можем создать третье окно для написания скрипта, автоматизирующего текущий процесс. По сути, такая настройка позволяет нам поддерживать сеанс SSH, читать руководство при настройке службы и делать заметки — все в одном терминале.

---

## Wave Terminal

Как мы видели с Wave Terminal, возможность организовать все на одном экране позволяет работать в разных средах одновременно без необходимости использования нескольких мониторов. Кроме того, функция, позволяющая выбрать одно из окон и сосредоточиться на нем, повышает концентрацию для нашей работы без отвлечения на другие окна.

![HTB Academy веб-страница с «Ваше путешествие в кибербезопасность начинается здесь» и терминал, запускающий команду cowsay](https://academy.hackthebox.com/storage/modules/87/multi1.png)

---

## Ghostty

Ghostty — один из самых быстрых эмуляторов терминала. Помимо скорости, он легко настраивается и включает встроенный мультиплексор. Давайте установим его на наш VPS и протестируем. Самый простой способ установить Ghostty в системе Ubuntu — использовать менеджер пакетов Snap:

```bash
cry0l1t3@ubuntu:~$ snap install ghostty --classic

ghostty v1.1.3 from Ken VanDine✪ installed
```

После установки мы можем запустить Ghostty и увидеть терминал, который выглядит примерно так:

![Терминал с командной строкой на темном фоне](https://academy.hackthebox.com/storage/modules/87/multi2.png)

В домашнем каталоге есть скрытый подкаталог с именем `~/.config`. Внутри него папка `ghostty` содержит конфигурационный файл, который можно редактировать для настройки Ghostty. Более подробную информацию можно найти в [документации Ghostty](https://ghostty.org/docs/config).

![Конфигурационный файл в терминале, показывающий настройки цвета и привязки клавиш для новой среды, перемещения, переключения и перезагрузки конфигурации](https://academy.hackthebox.com/storage/modules/87/multi3.png)

Эта конфигурация позволяет нам использовать простые сочетания клавиш для навигации и управления окнами и панелями в терминале Ghostty.

![Терминал, показывающий список каталогов, настройки конфигурации для цветов и привязки клавиш, а также системный монитор с использованием ЦП и памяти](https://academy.hackthebox.com/storage/modules/87/multi4.png)

Вы можете использовать конфигурацию Ghostty от Zerebos для создания своей конфигурации Ghostty с помощью веб-приложения [здесь](https://ghostty.zerebos.com/).

Мы также можем настроить предпочтительную тему для Ghostty. Перейдите в `~/.config/ghostty` и создайте новый каталог с именем `themes` для хранения нужных тем. Например, чтобы создать тему `HackTheBox`, выполните следующие шаги:

```bash
cry0l1t3@ubuntu:~$ cd .config/ghostty
cry0l1t3@ubuntu:~/.config/ghostty$ mkdir themes
cry0l1t3@ubuntu:~/.config/ghostty$ vim HackTheBox
```

Добавьте в файл следующую цветовую палитру и сохраните ее. Это указывает терминалу Ghostty, какие цвета использовать для каждого компонента.

```bash
palette = 0=#41444d
palette = 1=#fc2f52
palette = 2=#25a45c
palette = 3=#ff936a
palette = 4=#3476ff
palette = 5=#7a82da
palette = 6=#4483aa
palette = 7=#cdd4e0
palette = 8=#8f9aae
palette = 9=#ff6480
palette = 10=#3fc56b
palette = 11=#f9c859
palette = 12=#10b1fe
palette = 13=#ff78f8
palette = 14=#5fb9bc
palette = 15=#ffffff
background = #282c34
foreground = #b9c0cb
cursor-color = #ffcc00
cursor-text = #282c34
selection-background = #b9c0ca
selection-foreground = #272b33
```

После сохранения файла выполните следующую команду для просмотра доступных тем. Вновь созданная тема `HackTheBox` теперь появится с вашей пользовательской цветовой палитрой.

```bash
cry0l1t3@ubuntu:~/.config/ghostty/themes$ ghostty +list-themes
```

![Меню выбора темы с предварительным просмотром темы HackTheBox, цветовой палитрой и фрагментом кода](https://academy.hackthebox.com/storage/modules/87/multi5.png)

Наличие чистого, хорошо сконструированного эмулятора терминала в нашем рабочем пространстве повышает удовлетворение и радость во время рабочего процесса. Если мы погружены в среду, которая нам приятна и одновременно интересна, это повысит нашу эффективность и продуктивность как побочный эффект.

Однако есть проблема, которую мы еще не решили. Ограничение Ghostty в том, что он не поддерживает повторное присоединение сеансов через SSH. Поскольку мультиплексирование локально для экземпляра, удаленные пользователи должны заново создавать свои сеансы при повторном подключении.

---

## Tmux

В отличие от этого, Terminal Multiplexer (Tmux) — это мультиплексор терминала, который позволяет пользователям создавать, управлять, отсоединять и повторно подключать сеансы терминала даже через SSH-соединения. Tmux структурирован в три основных компонента:

* Сессии
* Окна (вкладки)
* Панели

Сессии представляют собой независимый экземпляр Tmux с собственным набором окон и панелей, который может работать в фоновом режиме. Эти сессии можно отсоединять/переподключать и делиться ими с другими для совместной работы. Окно — это один экран в сеансе, подобный вкладке в браузере, который содержит одну или несколько панелей. Панель — это подразделение окна, которое может работать бок о бок, где мы можем иметь несколько командных строк, открытых в одном окне.

Давайте установим Tmux и протестируем его, используя следующие команды:

```bash
cry0l1t3@ubuntu:~$ sudo apt install tmux -y
cry0l1t3@ubuntu:~$ tmux
```

После запуска Tmux вы увидите новую зеленую строку состояния внизу. На этой панели отображается имя сеанса, индекс и имя окна, заголовок панели, время и дата.

![Терминал с фоном Hack The Box и командной строкой, показывающей информацию о сеансе и время внизу](https://academy.hackthebox.com/storage/modules/87/multi6.png)

Кривая обучения использованию Tmux немного больше и требует больше времени. Однако, если вы действительно освоитесь с Tmux, это изменит ваш способ работы и значительно повысит вашу продуктивность. Наличие одинаковой конфигурации Tmux на всех серверах, с которыми вы работаете, создает для вас среду, которая ощущается одинаково, независимо от того, к какому серверу вы подключены. Поскольку вы всегда работаете в одной и той же среде, навигация, создание, модификация и управление улучшатся за короткий период времени. Кроме того, настройка нового сервера будет ощущаться так, как будто вы работали с ним долгое время.

Вам больше не нужно будет переориентироваться с новой настройкой сервера. После настройки серверы будут ощущаться как каталоги, по которым вы просто перемещаетесь и управляете.

Теперь давайте создадим конфигурационный файл Tmux, который мы можем хранить в нашем домашнем каталоге как `.tmux.conf` со следующими настройками:

```bash
# Config Management
unbind r
bind r source-file ~/.tmux.conf \; display "Config reloaded."

# Control
set -g prefix C-space
set -g mouse on

# History
set-option -g history-limit 50000

# Numbering
set -g base-index 1
setw -g pane-base-index 1

# Panes
bind x split-window -v
bind y split-window -h

bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R
```

После сохранения конфигурационного файла перезагрузите сеанс Tmux, чтобы применить изменения:

```bash
cry0l1t3@ubuntu:~$ tmux source .tmux.conf
```

С настроенной конфигурацией мы теперь можем использовать определенные сочетания клавиш для разделения окон и создания панелей. Например, нажатие `Ctrl + Space` активирует префикс Tmux, после чего нажатие `x` разделит окно вертикально.

Tmux поддерживает широкий спектр плагинов. Наиболее важным является Tmux Plugin Manager (TPM), который упрощает установку и управление плагинами. Мы можем клонировать репозиторий TPM из Github, используя:

```bash
cry0l1t3@ubuntu:~$ git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
cry0l1t3@ubuntu:~$ vim .tmux.conf
```

В нижней части конфигурационного файла мы должны добавить следующие строки:

```bash
<SNIP>

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
```

После сохранения изменений нам нужно нажать клавишу префикса (`CTRL + Space`) и указать Tmux установить плагины, нажав `SHIFT + i`.

```bash
CTRL + Space
SHIFT + i
```

После установки Tmux попросит вас нажать `ESCAPE`, чтобы продолжить ваш сеанс.

```
Already installed "tpm"
Installing "tmux-sensible"
  "tmux-sensible" download success
  
TMUX environment reloaded.

Done, press ESCAPE to continue.  
```

Когда мы посмотрим на структуру каталога плагинов Tmux, она будет выглядеть примерно так:

```bash
cry0l1t3@ubuntu:~$ tree -d .tmux

.tmux
└── plugins
    ├── tmux-sensible
    └── tpm
        ├── bin
        ├── bindings
        ├── docs
        ├── lib
        │   └── tmux-test
        ├── scripts
        │   └── helpers
        └── tests
            └── helpers

13 directories
```

---

## Темы Tmux

Темы Tmux настраивают визуальный интерфейс терминала, включая строку состояния, сообщения и границы панелей. Темы определяются в файле `.tmux.conf` и хорошо интегрируются с Zsh, Oh-My-Zsh и Powerlevel10k. Некоторые из наиболее популярных плагинов тем:

```bash
'wfxr/tmux-power'
'jimeh/tmux-themepack'
'dracula/tmux'
'arcticicestudio/nord-tmux'
'catppuccin/tmux'
```

Давайте расширим нашу конфигурацию Tmux с темой `catppuccin` и пользовательскими переменными цвета, воспроизведя показанный ниже файл `Tmux.conf`:

#### Tmux.conf

```bash
# Config Management
unbind r
bind r source-file ~/.tmux.conf \; display "Config reloaded."

# Control
set -g prefix C-space
set -g mouse on

# History
set-option -g history-limit 50000

# Numbering & Naming
set -g base-index 1
setw -g pane-base-index 1
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'

# Windows
unbind W
bind-key W command-prompt -p "Window name:" "new-window -n '%%'" # New Window
bind-key t command-prompt -p "New name:" "rename-window '%%'"   # Rename Window

# Switch Windows
bind-key 0 select-window -t 0
bind-key 1 select-window -t 1
bind-key 2 select-window -t 2
bind-key 3 select-window -t 3
bind-key 4 select-window -t 4
bind-key 5 select-window -t 5
bind-key 6 select-window -t 6
bind-key 7 select-window -t 7
bind-key 8 select-window -t 8
bind-key 9 select-window -t 9

# Panes
bind-key P command-prompt -p "Rename pane:" "select-pane -T '%%'"

bind x split-window -v
bind y split-window -h

bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# List of plugins
set -g @plugin 'tmux-plugins/tpm'

# Theme
set -g @plugin 'catppuccin/tmux#v2.1.3'
run ~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux

# Options to make tmux more pleasant
set -g mouse on
set -g default-terminal "tmux-256color"

# Configure the catppuccin plugin
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "rounded"

#----------------------------- Custom Theme
# Define color variables inspired by Catppuccin Mocha, mapped to HackTheBox colors
set -g @rosewater "#ffffff"       # BrightWhite
set -g @flamingo "#ff8484"        # BrightRed
set -g @pink "#c16cfa"            # BrightPurple
set -g @mauve "#9f00ff"           # Purple
set -g @red "#ff3e3e"             # Red
set -g @maroon "#ff8484"          # BrightRed
set -g @peach "#ffcc5c"           # BrightYellow
set -g @yellow "#ffaf00"          # Yellow
set -g @green "#9fef00"           # Green
set -g @teal "#2ee7b6"            # Cyan
set -g @sky "#5cecc6"             # BrightCyan
set -g @sapphire "#5cb2ff"        # BrightBlue
set -g @blue "#004cff"            # Blue
set -g @lavender "#ffffff" #"#c16cfa"        # BrightPurple
set -g @text "#a4b1cd"            # Foreground
set -g @subtext1 "#666666"        # BrightBlack
set -g @subtext0 "#313f55"        # SelectionBackground
set -g @overlay2 "#666666"        # BrightBlack
set -g @overlay1 "#313f55"        # SelectionBackground
set -g @overlay0 "#313f55"        # CursorColor
set -g @surface2 "#666666"        # BrightBlack
set -g @surface1 "#313f55"        # SelectionBackground
set -g @surface0 "#313f55"        # CursorColor
set -g @base "#1a2332"            # Background
set -g @mantle "#000000"          # Black
set -g @crust "#000000"           # Black
set -g @thm_bg "#1a2332"

# Plugins
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @plugin 'tmux-plugins/tmux-battery'

# Configure Online
set -g @online_icon "ok"
set -g @offline_icon "nok"

# Status bar position and transparency
set -g status-position bottom
set -g status-style "bg=#{@thm_bg},fg=#{@text}"  # Transparent background

# Status left: Session name, pane command, and path
set -g status-left-length 100
set -g status-left ""
set -ga status-left "#{?client_prefix,#{#[bg=#{@red},fg=#{@base},bold]  #S },#{#[bg=default,fg=#{@mauve}]  #S }}"
set -ga status-left "#[bg=default,fg=#{@overlay0}] │ "
set -ga status-left "#[bg=default,fg=#{@blue}]  #{pane_current_command} "
set -ga status-left "#[bg=default,fg=#{@overlay0}] │ "
set -ga status-left "#[bg=default,fg=#{@teal}]  #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "
set -ga status-left "#[bg=default,fg=#{@overlay0}]#{?window_zoomed_flag, │ ,}"
set -ga status-left "#[bg=default,fg=#{@yellow}]#{?window_zoomed_flag,  zoom ,}"

# Status right: Battery, online status, VPN status, date/time
set -g status-right-length 100
set -g status-right ""
set -ga status-right "#{?#{e|>=:10,#{battery_percentage}},#{#[bg=#{@red},fg=#{@base}]},#{#[bg=default,fg=#{@peach}]}} #{battery_icon} #{battery_percentage} "
set -ga status-right "#[bg=default,fg=#{@overlay0}] │ "
set -ga status-right "#[bg=default]#{?#{==:#{online_status},ok},#[fg=#{@sapphire}] 󰖩 on ,#[fg=#{@red},bold] 󰖪 off }"
set -ga status-right "#[bg=default,fg=#{@overlay0}] │ "
set -ga status-right "#[bg=default,fg=#{@green}]  #(~/vpn_status.sh) "
set -ga status-right "#[bg=default,fg=#{@overlay0}] │ "
set -ga status-right "#[bg=default,fg=#{@sky}] 󰭦 %Y-%m-%d 󰅐 %H:%M "

# Window status with rounded tabs and extra padding
set -g window-status-format "#[fg=#{@overlay0}]#[fg=#{@text},bg=#{@overlay0}]  #I:#W  #[fg=#{@overlay0},bg=default]"
set -g window-status-current-format "#[fg=#{@green}]#[fg=#{@base},bg=#{@green}]  #I:#W  #[fg=#{@green},bg=default]"
set -g window-status-style "bg=default"
set -g window-status-last-style "bg=default,fg=#{@green}"
set -g window-status-activity-style "bg=#{@red},fg=#{@base}"
set -g window-status-bell-style "bg=#{@red},fg=#{@base},bold"
set -gF window-status-separator "  "  # Add space between window tabs

# Pane borders
setw -g pane-border-status off  # Hide pane border status
setw -g pane-active-border-style "bg=default,fg=#{@green}"
setw -g pane-border-style "bg=default,fg=#{@surface0}"
setw -g pane-border-lines single

# Automatic window renaming
set -wg automatic-rename on
set -g automatic-rename-format "Window"

# Justify window status
set -g status-justify "absolute-centre"

# Simulate bottom padding by adding a blank line
set -g status-format[1] ""

# Bootstrap tpm
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager
run '~/.tmux/plugins/tpm/tpm'
```

Теперь давайте сохраним его и инициируем установку плагинов.

```bash
Ctrl + Space
Shift + i
```

После установки и перезагрузки мы увидим строку состояния, которая выглядит следующим образом:

#### Wave Terminal

![Терминал с тремя разделенными панелями, каждая из которых показывает командную строку, и подробностями сеанса внизу](https://academy.hackthebox.com/storage/modules/87/multi7.png)

#### Ghostty

![Скриншот сеанса tmux с четырьмя панелями, каждая из которых показывает командную строку. В правом верхнем углу есть индикатор ошибки, а остальные показывают статус успеха. На фоне изображен стилизованный логотип лисы](https://academy.hackthebox.com/storage/modules/87/multi8.png)

Мы настоятельно рекомендуем вам ознакомиться с документацией [Tmux Getting Started](https://github.com/tmux/tmux/wiki/Getting-Started) и поработать с tmux. Помните, кривая обучения будет немного круче, но результат будет более чем стоить затраченных усилий и времени в конечном итоге.







# Редактор кода

---

Мы часто сталкиваемся с ситуациями, когда нам необходимо изменить и/или написать собственный код. Разработка кода, например, на Python, включает написание, тестирование и отладку для решения проблем или автоматизации сложных задач. Это требует нашего полного внимания, так как требует от нас сосредоточенного, логического мышления при сохранении глубокого технического понимания. Нам, безусловно, будет сложно, если наша рабочая среда не настроена должным образом.

У нас есть три различных варианта. Мы можем использовать графический редактор, или терминальный редактор, или оба. Поскольку мы в основном работаем в терминале, наличие функционально богатого терминального редактора кода более эффективно, чем любое другое решение. Однако графические редакторы более удобны для пользователя и требуют меньше времени для освоения. Улучшенная кривая обучения имеет свою цену в виде потребления большего количества ресурсов компьютера. Например, это может вызвать проблемы с памятью при запуске нескольких экземпляров на ПК с 16 ГБ оперативной памяти.

Давайте взглянем на один из наиболее широко используемых (и ценимых) графических редакторов на рынке.

---

## VSCode

[VSCode](https://code.visualstudio.com/) — это графическая интегрированная среда разработки (IDE), известная своей удобностью использования и обширным списком расширений. Она также предоставляет множество встроенных инструментов для отладки, Git и поддержки различных языков программирования. В то же время она высоко настраиваема и имеет встроенный терминал. Давайте загрузим VSCode и установим его.

![Интерфейс Visual Studio Code, показывающий проводник с файлами проекта и редактор кода с CSS-кодом, а также панель чата](https://academy.hackthebox.com/storage/modules/87/code1.png)

В нашем примере мы используем Ubuntu, и поэтому выбрали скачивание и установку пакета на основе Debian.

```bash
cry0l1t3@ubuntu:~$ sudo apt install ./code_1.99.3-1744761595_amd64.deb
cry0l1t3@ubuntu:~$ code
```

При первом запуске может пройти несколько секунд. После полного запуска вы увидите следующее окно, где вы можете начать настраивать и кастомизировать свою IDE VSCode.

![Экран настройки Visual Studio Code с опциями использования функций AI с Copilot, вместе с редактором кода, отображающим файл проекта](https://academy.hackthebox.com/storage/modules/87/code2.png)

Давайте установим цветовую схему IDE HackTheBox. Сначала выполните команды, показанные ниже:

```bash
Ctrl + p
ext install silofy.hackthebox
```

Это установит цветовую схему HackTheBox, которую вы можете установить в качестве предпочтительной темы для VSCode.

![Visual Studio Code, показывающий расширение темы HackTheBox с опциями установки цветовой темы, отключения или удаления](https://academy.hackthebox.com/storage/modules/87/code3.png)

После этого ваш VSCode будет выглядеть примерно так:

![Visual Studio Code, показывающий расширение темы HackTheBox с опциями установки цветовой темы, отключения или удаления, и деталями установки](https://academy.hackthebox.com/storage/modules/87/code4.png)

Когда мы вставляем фрагмент кода Python в новый файл, красивый набор цветов подчеркивает структуру кода, делая его гораздо более читаемым и удобным для редактирования.

![Visual Studio Code с Python-скриптом, демонстрирующим извлечение значений словаря и сортировку уникальных значений](https://academy.hackthebox.com/storage/modules/87/code5.png)

Специально для разработки на Python мы подготовили список полезных расширений, которые еще больше улучшат ваш опыт работы с VSCode.

## Установка расширений

| **Общие** | **Python** | **Docker** | **Git** | **AI** |
| --- | --- | --- | --- | --- |
| [Better Comments](https://marketplace.visualstudio.com/items/?itemName=aaron-bond.better-comments) | [Python](https://marketplace.visualstudio.com/items/?itemName=ms-python.python) | [Docker](https://marketplace.visualstudio.com/items/?itemName=ms-azuretools.vscode-docker) | [Gitlens](https://marketplace.visualstudio.com/items/?itemName=eamodio.gitlens) | [Continue](https://marketplace.visualstudio.com/items/?itemName=Continue.continue) |
| [Material Icon Theme](https://marketplace.visualstudio.com/items/?itemName=PKief.material-icon-theme) | [Python Auto VENV](https://marketplace.visualstudio.com/items/?itemName=WolfiesHorizon.python-auto-venv) | [Remote Containers](https://marketplace.visualstudio.com/items/?itemName=ms-vscode-remote.remote-containers) | | |
| [Postman for VSCode](https://marketplace.visualstudio.com/items/?itemName=Postman.postman-for-vscode) | [Python Indent](https://marketplace.visualstudio.com/items/?itemName=KevinRose.vsc-python-indent) | | | |
| [Remote SSH](https://marketplace.visualstudio.com/items/?itemName=ms-vscode-remote.remote-ssh) | [Indent Rainbow](https://marketplace.visualstudio.com/items/?itemName=oderwat.indent-rainbow) | | | |
| [Quicktype](https://marketplace.visualstudio.com/items/?itemName=quicktype.quicktype) | [Arepl](https://marketplace.visualstudio.com/items/?itemName=almenon.arepl) | | | |
| [Prettier](https://marketplace.visualstudio.com/items/?itemName=esbenp.prettier-vscode) | | | | |
| [Peacock](https://marketplace.visualstudio.com/items/?itemName=johnpapa.vscode-peacock) | | | | |

Настоятельно рекомендуется изучить их документацию и понять, как каждое из расширений можно настроить и адаптировать под ваши нужды.

---

## NeoVIM

Neovim — это терминальный текстовый редактор, который предлагает высокую степень настройки и широкий спектр расширений. Он значительно быстрее, чем VSCode, и ориентирован на рабочие процессы, управляемые клавиатурой, что идеально подходит для пользователей, предпочитающих управлять всем в одном экране. Neovim также очень легковесен, требует минимальных ресурсов ОЗУ и ЦП, что делает его хорошо подходящим для обработки нескольких сессий или работы с большими кодовыми базами. Однако Neovim зависит от дополнительных плагинов, таких как DAP для отладки, которые менее интуитивно понятны и требуют ручной настройки.

Теперь давайте загрузим и установим Neovim с помощью команд, показанных ниже:

```bash
cry0l1t3@ubuntu:~$ curl -LO https://github.com/neovim/neovim/releases/latest/download/nvim-linux-x86_64.tar.gz
cry0l1t3@ubuntu:~$ sudo rm -rf /opt/nvim
cry0l1t3@ubuntu:~$ sudo tar -C /opt -xzf nvim-linux-x86_64.tar.gz
cry0l1t3@ubuntu:~$ echo 'export PATH="$PATH:/opt/nvim-linux-x86_64/bin"' >> ~/.zshrc
```

Существует предварительно настроенный фреймворк Neovim под названием `NvChad`, который включает в себя улучшенный пользовательский интерфейс, время запуска и подобранные плагины, чтобы сделать его подобным IDE. Давайте загрузим его и заменим конфигурацию Neovim по умолчанию на новую.

```bash
cry0l1t3@ubuntu:~$ # NvChad
cry0l1t3@ubuntu:~$ git clone https://github.com/NvChad/starter ~/.config/nvim
```

Если вы не знакомы с Neovim/Vim и его функциональностью, мы рекомендуем вам пройти встроенный учебник, который научит основам Neovim/Vim. Чтобы запустить `vimtutor`, вы можете использовать следующую команду:

```bash
cry0l1t3@ubuntu:~$ vimtutor
```

Пропуск учебника может привести к неловкой ситуации, когда вы поймете, что не можете выйти из Neovim/Vim.

Смело продвигаясь дальше, когда мы запускаем Neovim, выполнив команду `nvim`, мы видим следующий экран.

![Интерфейс Neovim, показывающий управление плагинами с опциями, такими как Установка, Обновление и Синхронизация. Отображает новости NvChad и обновления статуса плагинов](https://academy.hackthebox.com/storage/modules/87/code6.png)

Еще раз, мы рекомендуем прочитать документацию, чтобы ознакомиться с использованием vim, так как Neovim/Vim позволит вам писать и редактировать код или файлы `очень быстро`, когда вы станете профессионалом. Кроме того, NvChad предоставляет выбор темы, который мы можем открыть с помощью клавиши `Space + t + h`. Здесь мы найдем множество предустановленных тем и сможем выбрать ту, которая соответствует нашим вкусам.

![Интерфейс Tmux, отображающий меню выбора цветовой схемы с различными темами, такими как 'jabuti' и 'material-deep-ocean'](https://academy.hackthebox.com/storage/modules/87/code7.png)






# Продуктивные утилиты

---

В этом разделе мы рассмотрим еще несколько инструментов для повышения вашей продуктивности и эффективности. В частности, мы сосредоточимся на инструментах, которые помогают в:

* поиске конкретной информации, файлов или каталогов
* просмотре содержимого каталогов
* выводе содержимого файлов более эффективным способом
* быстром взгляде на производительность нашей системы

---

# FZF

Сначала начнем с [FZF](https://github.com/junegunn/fzf). FZF — это терминальный инструмент нечеткого поиска, разработанный для интерактивной фильтрации и поиска в списках с нечетким сопоставлением. Он позволяет искать строки для сопоставления элементов, разбросанных по другой строке, с мгновенной обратной связью. Кроме того, он позволяет интегрировать другие инструменты, такие как `batcat` или `eza` (о которых мы поговорим позже в этом разделе), чтобы видеть содержимое наших совпадений без необходимости выходить из окна FZF.

По сути, он заменяет команду find, которая часто выдает много данных, которые нам приходится просматривать, не имея возможности отфильтровать определенные строки. Для установки FZF мы можем использовать следующие команды:

```bash
cry0l1t3@ubuntu:~$ git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf

Cloning into '/home/cry0l1t3/.fzf'...
remote: Enumerating objects: 145, done.
remote: Counting objects: 100% (145/145), done.
remote: Compressing objects: 100% (136/136), done.
remote: Total 145 (delta 5), reused 58 (delta 2), pack-reused 0 (from 0)
Receiving objects: 100% (145/145), 347.52 KiB | 1.96 MiB/s, done.
Resolving deltas: 100% (5/5), done.
Downloading bin/fzf ...
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
100 1571k  100 1571k    0     0  1728k      0 --:--:-- --:--:-- --:--:-- 9685k
  - Checking fzf executable ... 0.61.3


cry0l1t3@ubuntu:~$ ~/.fzf/install

Do you want to enable fuzzy auto-completion? ([y]/n) y
Do you want to enable key bindings? ([y]/n) y

Generate /home/cry0l1t3/.fzf.bash ... OK
Generate /home/cry0l1t3/.fzf.zsh ... OK

Do you want to update your shell configuration files? ([y]/n) y

Update /home/cry0l1t3/.bashrc:
  - [ -f ~/.fzf.bash ] && source ~/.fzf.bash
    + Added

Update /home/cry0l1t3/.zshrc:
  - [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
    + Added

Finished. Restart your shell or reload config file.
   source ~/.bashrc  # bash
   source ~/.zshrc   # zsh

Use uninstall script to remove fzf.

For more information, see: https://github.com/junegunn/fzf
```

После установки мы можем отредактировать файл `.zshrc` и назначить псевдоним для команды `fzf`.

```bash
cry0l1t3@ubuntu:~$ vim .zshrc
```

```bash
<SNIP>

# Aliases
alias ff="fzf --style full --preview 'fzf-preview.sh {}' --bind 'focus:transform-header:file --brief {}'"

<SNIP>
```

Теперь нам нужно перезагрузить файл `.zshrc` для Zsh.

```bash
cry0l1t3@ubuntu:~$ source ~/.zshrc
```

После этого, если вы наберете `ff`, он откроет интерактивный интерфейс, где вы сможете увидеть содержимое текущего каталога с содержимым файла `mycode.py`.

![Интерфейс Tmux с разделенным просмотром, показывающим скрипт Python для извлечения уникальных значений словаря справа и список файлов слева](https://academy.hackthebox.com/storage/modules/87/prod1.png)

---

## EZA

Eza — это современная альтернатива команде `ls`. Она предоставляет цветные, детальные списки файлов со статусом Git, иконками и дополнительными функциями, такими как гиперссылки. Кроме того, она различает типы файлов с помощью цветов и опциональных иконок, если вы используете [Nerd Font](https://www.nerdfonts.com/). Мы даже можем редактировать тему и цвета, которые использует Eza.

Поскольку `ls` — одна из самых распространенных команд, которые мы используем в системах Linux, наличие лучшего и более эффективного инструмента значительно облегчает нам жизнь в долгосрочной перспективе. Для его установки мы можем выполнить следующие команды:

```bash
cry0l1t3@ubuntu:~$ sudo apt install eza -y
cry0l1t3@ubuntu:~$ vim ~/.zshrc
```

Теперь мы можем назначить различные псевдонимы для команды `eza`, чтобы получать различные представления списков.

```bash
<SNIP>

# Aliases
alias ff="fzf --style full --preview 'fzf-preview.sh {}' --bind 'focus:transform-header:file --brief {}'"
alias ls='eza $eza_params'
alias l='eza --git-ignore $eza_params'
alias ll='eza --all --header --long $eza_params'
alias llm='eza --all --header --long --sort=modified $eza_params'
alias la='eza -lbhHigUmuSa'
alias lx='eza -lbhHigUmuSa@'
alias lt='eza --tree $eza_params'
alias tree='eza --tree $eza_params'

<SNIP>
```

Снова, после редактирования файла `.zshrc` нам нужно его перезагрузить.

```bash
cry0l1t3@ubuntu:~$ source ~/.zshrc
```

Теперь мы можем протестировать различные команды и проверить результаты.

![Интерфейс Tmux, показывающий листинги каталогов с разрешениями файлов, размерами и датами изменения для плагинов '.oh-my-zsh'](https://academy.hackthebox.com/storage/modules/87/prod2.png)

---

## Bat

[Bat](https://github.com/sharkdp/bat) — это cat с крыльями. Он обеспечивает подсветку синтаксиса для большого количества языков и поставляется со встроенной интеграцией с git, что позволяет нам видеть изменения в файлах.

```bash
cry0l1t3@ubuntu:~$ sudo apt install bat
```

Здесь вы можете увидеть разницу между стандартным инструментом `cat` и `batcat`. Не стесняйтесь добавить псевдоним для `cat`, который заменяется на `batcat` с необходимыми опциями, которые вы можете найти в их репозитории.

![Интерфейс Tmux с разделенным просмотром, показывающий Python-скрипт для извлечения уникальных значений словаря в двух панелях](https://academy.hackthebox.com/storage/modules/87/prod3.png)

---

## Btop

Btop — это инструмент мониторинга системы для терминала, который заменяет инструменты `htop` и `top`. Он также красочный и может быть настроен в зависимости от ваших потребностей и предпочтений. Он может отслеживать CPU, память, диск, сеть и процессы, что делает его отличным инструментом для отладки проблем с производительностью. Вы можете установить инструмент с помощью следующей команды:

```bash
cry0l1t3@ubuntu:~$ sudo apt install btop -y
```

![Интерфейс Tmux, отображающий системный мониторинг с процессором, памятью, использованием диска, сетевой активностью и списком процессов](https://academy.hackthebox.com/storage/modules/87/prod4.png)







# Удаленный рабочий стол

---

Подключения к удаленному рабочему столу позволяют пользователям получать доступ и управлять компьютером, сервером или его рабочей средой удаленно через сеть. Это используется в случаях, когда физический доступ непрактичен и неудобен. Например, если сотруднику нужна помощь с определенными настройками на его компьютере с Windows, мы можем оказать помощь, не выезжая в офис. Всё, что нам нужно сделать – это подключиться к его компьютеру удаленно, используя протокол удаленного рабочего стола (Remote Desktop Protocol).

Для этого нам необходим RDP-клиент, который сможет справиться с задачей. Существует множество различных инструментов для этого, но мы рассмотрим только три из них:

| `XfreeRDP` | `RDesktop` | `Rustdesk` |
|------------|------------|------------|

---

## XFREERDP

Xfreerdp – это клиент командной строки, позволяющий подключаться к RDP-серверам, которые поддерживают аутентификацию на сетевом уровне, TLS-шифрование и передачу учетных данных. Он оптимизирован для соединений с низкой задержкой с поддержкой сжатия H.264, что гарантирует, что даже если соединение не в лучшем состоянии, мы, скорее всего, сможем выполнить необходимую работу.

Pwnbox уже имеет предустановленный `xfreerdp`, который можно использовать из терминала. Если вы хотите установить его на другой дистрибутив на базе Debian, вы можете использовать следующую команду:

```shell-session
cry0l1t3@ubuntu:~$ sudo apt install xfreerdp -y
```

После установки мы можем указать имя пользователя (`/u:`), пароль (`/p:`) и удаленный RDP-хост (`/v:`), к которому мы хотим подключиться. Это инициализирует RDP-соединение, при котором вас спросят, хотите ли вы доверять этому устройству. После подтверждения появится новое окно, отображающее рабочий стол удаленного хоста.

![Разделенный экран, показывающий рабочий стол Windows через FreeRDP слева и терминал с выводом команды xfreerdp справа, включая детали проверки сертификата и ошибку входа.](https://academy.hackthebox.com/storage/modules/87/rdp1.png)

---

## RDESKTOP

Rdesktop – это старый клиент RDP с открытым исходным кодом, который легковесен, но также менее активно поддерживается по сравнению с FreeRDP. Это приводит к ограниченной поддержке современных функций RDP, таких как аутентификация на сетевом уровне и современное TLS-шифрование. Его можно установить с помощью следующей команды:

```shell-session
cry0l1t3@ubuntu:~$ sudo apt install rdesktop -y
```

Для установления RDP-соединения, как и в случае с `xfreerdp`, мы можем указать имя пользователя (`-u`), пароль (`-p`) и целевой домен (`-d`), если это необходимо. IP-адрес удаленного хоста не требует флага, но будет добавлен в конце команды.

![Разделенный экран с рабочим столом Windows через rdesktop слева и выводом терминала справа, показывающим предупреждения о сертификате и сведения о подключении.](https://academy.hackthebox.com/storage/modules/87/rdp2.png)

---

## Rustdesk

[Rustdesk](https://rustdesk.com/) – это альтернатива с открытым исходным кодом для TeamViewer и AnyDesk, но служит другой цели. По умолчанию вы не можете сразу подключиться к серверу RDP, поскольку требуется идентификатор сеанса и пароль, которые генерируются на каждом хосте. Это требует взаимодействия пользователя как со стороны администратора, так и со стороны пользователя. С одной стороны, администратор не может управлять хостом без предоставления ему доступа пользователем. Но с другой стороны, если RDP деактивирован, удаленный сеанс на хосте Windows или Linux будет гораздо сложнее получить с точки зрения атакующего.

Мы можем посетить их домашнюю страницу и загрузить необходимый пакет. Вы можете использовать только клиент или самостоятельно размещать службу.

![Домашняя страница RustDesk, рекламирующая программное обеспечение для удаленного доступа с открытым исходным кодом с возможностями загрузки и самостоятельного хостинга.](https://academy.hackthebox.com/storage/modules/87/rdp3.png)

После загрузки клиента мы можем установить его, используя следующую команду:

```shell-session
cry0l1t3@ubuntu:~$ cd ~/Downloads
cry0l1t3@ubuntu:~$ sudo apt install ./rustdesk-1.3.9-x86_64.deb -y
```

После установки мы можем запустить его и увидим следующий экран с идентификатором сеанса и одноразовым паролем.

![Интерфейс удаленного рабочего стола, показывающий ID 161 824 388, пароль wq3jzr и предупреждение о поддержке Wayland. Нет доступных недавних сеансов.](https://academy.hackthebox.com/storage/modules/87/rdp4.png)

В этом примере мы также загрузили тот же клиент на компьютер с Windows и запустили его. Теперь мы возьмем идентификатор сеанса и одноразовый пароль с хоста Windows и используем его на нашем хосте Linux для подключения.

![Интерфейс удаленного рабочего стола с ID 153 069 124, паролем 575twm и предупреждением UAC для установки RustDesk. Нет доступных недавних сеансов.](https://academy.hackthebox.com/storage/modules/87/rdp5.png)

После ввода идентификатора сеанса нам будет предложено ввести одноразовый пароль хоста Windows.

![Запрос пароля для проверки RustDesk с возможностью ввода пароля, запоминания пароля и кнопками для отмены или подтверждения.](https://academy.hackthebox.com/storage/modules/87/rdp6.png)

Когда учетные данные введены правильно, появится новое окно, показывающее подключение к удаленному рабочему столу.

![Интерфейс удаленного рабочего стола с ID 161 824 388, паролем wq3jzr, предупреждением о поддержке Wayland и подключением к ID 153 069 124.](https://academy.hackthebox.com/storage/modules/87/rdp7.png)

Это особенно полезно, когда нам нужно помочь кому-то удаленно. Rustdesk является одним из лучших решений для таких задач, поскольку все соединения по умолчанию используют сквозное шифрование (E2EE) на основе NaCl, обеспечивая конфиденциальность и безопасность данных во время всех удаленных сеансов. Кроме того, он поддерживает передачу файлов, обмен через буфер обмена, настройку нескольких мониторов, запись сеансов, живой чат и TCP-туннелирование. Этот набор функций делает этот инструмент как безопасным, так и эффективным, что идеально подходит для наших целей.





# Контейнеры

---

`Контейнер` нельзя определить как виртуальную машину, скорее это изолированная группа `процессов`, работающих на одном хосте, которая соответствует полному приложению, включая его конфигурацию и зависимости. Это приложение упаковано в точно определенный, многократно используемый формат. В отличие от типичной виртуальной машины на VMware Workstation, контейнер не включает собственную операционную систему или ядро. Поэтому он не является виртуализированной операционной системой. По этой причине контейнеры значительно легче, чем обычные виртуальные машины. Поскольку они фактически не являются виртуальными машинами, их называют виртуализацией приложений в этом контексте.

![Диаграмма, сравнивающая виртуальные машины и контейнеры. Виртуальные машины имеют отдельную гостевую ОС для каждого приложения, работающего на гипервизоре. Контейнеры используют общую ОС, используя контейнерный движок для изоляции приложений.](https://wiki.geant.org/download/attachments/184549510/containers-vs-virtual-machines.jpg?version=1&modificationDate=1607437321973&api=v2)

Источник: [https://wiki.geant.org](https://wiki.geant.org/download/attachments/184549510/containers-vs-virtual-machines.jpg?version=1&modificationDate=1607437321973&api=v2)

Существенной проблемой при развертывании новых приложений или новых версий является то, что каждое приложение зависит от определенных аспектов своей среды. К ним относятся, например, локальные настройки или функциональные библиотеки. Часто настройки в среде разработки отличаются от настроек в тестовой среде и производственной среде. В таком случае может быстро произойти так, что, вопреки ожиданиям, приложение работает иначе или вообще не работает в производственной среде.

| **Виртуальная машина** | `Контейнер` |
|------------------------|-------------|
| Содержит приложения и полную операционную систему | `Содержит приложения и только необходимые компоненты операционной системы, такие как библиотеки и бинарные файлы` |
| Гипервизор, такой как VMware ESXi, обеспечивает виртуализацию | `Операционная система с контейнерным движком обеспечивает собственную виртуализацию` |
| Несколько виртуальных машин работают изолированно друг от друга на физическом сервере | `Несколько контейнеров работают изолированно друг от друга на одной операционной системе` |

Контейнеры приложений технически основаны на функциях, которые уже давно доступны в операционной системе Linux. Ядро использует эти функции для `изоляции` приложений. Таким образом, приложения работают изолированно друг от друга как процессы в разных учетных записях пользователей. Однако они одновременно принадлежат к знакомой среде Linux. Возможно также взаимодействие различных приложений, и если контейнеры работают на одной системе, используется демон контейнера — например, `Linux Container Daemon` (`LXD`). LXD — это технология, аналогичная `Linux Containers` (`LXC`). LXC — это контейнерная технология виртуализации на уровне операционной системы. Технически LXC объединяет изолированные пространства имен и «cgroups» ядра Linux для создания изолированных сред для выполнения кода. Исторически LXC также был основой для широко используемой технологии виртуализации Docker. Используя LXD, контейнеры операционной системы Linux можно настраивать и контролировать с помощью определенного набора команд. Поэтому он подходит для автоматизации массового управления контейнерами и используется в облачных вычислениях и центрах обработки данных.

Основой каждого контейнера является образ файловой системы. Мы можем выбрать, использовать уже созданный образ или создать его самостоятельно. Контейнеры также характеризуются выдающейся масштабируемостью. Улучшенная масштабируемость идеально подходит для требований сейчас высокодинамичной ИТ-инфраструктуры в компаниях. Действительно, высокая масштабируемость контейнеров позволяет идеально адаптировать возможности для обеспечения пользователей приложениями. Между тем, даже большие настройки контейнеров можно управлять без каких-либо проблем благодаря системам оркестрации, таким как `Apache Mesos` или `Google Kubernetes`. Эти системы распределяют контейнеры по существующему оборудованию на основе предопределенных правил и контролируют их.

---

## Введение в Docker

[Docker](https://www.docker.com/get-started) — это программное обеспечение с открытым исходным кодом, которое может изолировать приложения в контейнерах, подобно виртуализации операционной системы. Этот подход значительно упрощает развертывание приложений. Данные приложений, хранящиеся в контейнерах, можно легко транспортировать и устанавливать. Использование контейнеров гарантирует, что компьютерные ресурсы строго разделены друг от друга. Docker хранит программы вместе с их зависимостями в образах. Они составляют основу для виртуализированных контейнеров, которые могут работать практически на любой операционной системе. Это делает приложения переносимыми и несложными, будь то во время разработки или при масштабировании кластеров [SaaS](https://en.wikipedia.org/wiki/Software_as_a_service).

[Docker Engine](https://docs.docker.com/engine/) является основным компонентом контейнерной виртуализации. Программное обеспечение предоставляет интерфейс между ресурсами хоста и работающими контейнерами. Любая система, в которой установлен Docker Engine, может использовать контейнеры Docker. Изначально Docker был разработан для использования в системах Linux. Однако с виртуализацией через VMware или Hyper-V движок также работает на устройствах Windows или Mac OS. Таким образом, Docker можно использовать практически во всех распространенных сценариях.

#### Установка Docker

```bash
cry0l1t3@htb:~$ sudo apt update -y 
cry0l1t3@htb:~$ sudo apt install docker.io -y
```

```powershell
C:\> IEX((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1'))
C:\> choco upgrade chocolatey
C:\> choco install docker-desktop
```

---

## Введение в Vagrant

[Vagrant](https://www.vagrantup.com/) — это инструмент, который может создавать, настраивать и управлять виртуальными машинами или средами виртуальных машин. Виртуальные машины не создаются и не настраиваются вручную, а описываются как код в файле `Vagrantfile`. Для лучшей структуризации программного кода файл Vagrant может включать дополнительные файлы кода. Затем код можно обрабатывать с помощью Vagrant CLI. Таким образом, мы можем создавать, подготавливать и запускать собственные виртуальные машины. Более того, если виртуальные машины больше не нужны, их можно уничтожить так же быстро и легко. Из коробки Vagrant предлагает провайдеры для VMware и Docker.

![Диаграмма настройки Docker Swarm с Vagrant и VirtualBox на хосте, регистре и трех узлах Windows (sw-win-01, sw-win-02, sw-win-03).](https://stefanscherer.github.io/content/images/2016/03/windows_swarm_demo.png)
Источник: https://stefanscherer.github.io/content/images/2016/03/windows_swarm_demo.png

#### Установка Vagrant

```bash
# Linux
cry0l1t3@htb:~$ sudo apt update -y 
cry0l1t3@htb:~$ sudo apt install virtualbox virtualbox-dkms vagrant
```

```powershell
# Windows
C:\> IEX((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1'))
C:\> choco upgrade chocolatey
C:\> cinst virtualbox cyg-get vagrant
```

---

Настоятельно рекомендуется поэкспериментировать с различными контейнерами, чтобы почувствовать их. Мы должны изучить документацию и прочитать ее, чтобы понять, как работают контейнеры и от чего они зависят. Это также поможет нам понять, какие преимущества и недостатки они приносят.




# Изоляция и песочницы

---

Песочницы и изоляция — это методы обеспечения безопасности, которые используются для ограничения и контроля среды выполнения приложений, таких как браузеры, предотвращая несанкционированный доступ к системным ресурсам, данным или другим процессам. Например, если мы получаем подозрительную ссылку, мы можем запустить браузер в песочнице, которая не имеет доступа к файлам в нашей системе, и открыть ссылку в этом изолированном браузере.

Изоляция — это концепция безопасности, которая включает в себя разделение процессов, приложений или целых окружений, чтобы предотвратить их взаимодействие друг с другом или доступ к несанкционированным ресурсам.

Песочница является частью изоляции и представляет собой механизм безопасности, который запускает процессы и приложения в ограниченной среде.

---

## Firejail

Firejail — это инструмент для создания песочниц, который создает и ограничивает среду выполнения недоверенных приложений и процессов. Он легковесный и использует функции безопасности ядра для изоляции процессов. Он поставляется со многими предварительно настроенными профилями для тысяч приложений и очень прост в использовании.

Чтобы установить его, нам нужно добавить новый репозиторий и загрузить его с помощью менеджера пакетов APT. После установки мы можем запустить его, используя команду `firejail`.

```shell
cry0l1t3@ubuntu:~$ sudo add-apt-repository ppa:deki/firejail
cry0l1t3@ubuntu:~$ sudo apt-get update
cry0l1t3@ubuntu:~$ sudo apt-get install firejail firejail-profiles

firejail
```

Далее, мы можем установить `firetools`, который представляет собой простой графический интерфейс для управления песочницами. Давайте установим его:

```shell
cry0l1t3@ubuntu:~$ sudo apt install firetools -y
cry0l1t3@ubuntu:~$ firetools
```

Вы увидите новую боковую панель, показывающую несколько приложений с соответствующими профилями. Когда вы нажимаете на одно из приложений, оно запускается в песочнице с предварительно настроенным профилем.

В верхнем левом углу вы увидите значок для запуска конфигурационной панели для firejail.

![Рабочий стол, показывающий приложение Firejail, запущенное в терминале, и окно конфигурации Firetools для выбора приложений для размещения в песочнице](https://academy.hackthebox.com/storage/modules/87/iso1.png)

На этом этапе мы можем выбрать приложение, которое хотим запустить в песочнице, и запустить его.

![Окно конфигурации Firejail с меню выбора приложений и просмотром файловой системы, показывающим RustDesk в /usr/bin](https://academy.hackthebox.com/storage/modules/87/iso2.png)

Это создаст новую песочницу и выполнит приложение внутри этой песочницы.

![Рабочий стол, показывающий вывод терминала Firejail, интерфейс RustDesk с ID 161 824 388, паролем 8gd7ky и предупреждением о поддержке Wayland](https://academy.hackthebox.com/storage/modules/87/iso3.png)

Однако, как и любое другое приложение, firejail не является на 100% защищенным. Зависимость Firejail от `namespaces` и `seccomp` имеет известные уязвимости — особенно если системные вызовы не фильтруются должным образом — и существует эксплойт ядра, который может обойти ограничения firejail.

---

## KASM

[Kasm Workspaces](https://kasmweb.com/), с другой стороны, представляет собой контейнеризированную платформу для стриминга виртуальных рабочих столов и приложений, которая предоставляет безопасные, изолированные рабочие пространства через браузер. Она ориентирована на принципы нулевого доверия и удаленную изоляцию браузера (RBI). В отличие от Firejail, который работает локально на Linux, Kasm — это серверное решение, использующее контейнеры Docker для изоляции приложений и рабочих столов, которое также может быть размещено на собственном сервере.

![Главная страница Kasm Workspaces с текстом 'The Workspace Streaming Platform' и опциями для Linux Desktop, Windows Desktop и Cloud Browser](https://academy.hackthebox.com/storage/modules/87/iso4.png)

Чтобы установить его, нам нужно загрузить архив `.tar.gz` и выполнить скрипт с помощью следующих команд:

```shell
cry0l1t3@ubuntu:~$ cd /tmp
cry0l1t3@ubuntu:~$ curl -O https://kasm-static-content.s3.amazonaws.com/kasm_release_1.17.0.bbc15c.tar.gz
cry0l1t3@ubuntu:~$ tar -xf kasm_release_1.17.0.bbc15c.tar.gz
cry0l1t3@ubuntu:~$ sudo bash kasm_release/install.sh
```

После завершения установки вы увидите набор различных учетных данных для разных пользователей, базы данных и токенов.

![Терминал, показывающий завершение установки Kasm с данными для входа, учетными данными для базы данных, Redis, токеном менеджера и токеном регистрации службы](https://academy.hackthebox.com/storage/modules/87/iso5.png)

Когда мы посещаем страницу https://localhost, чтобы получить доступ к странице входа в KASM, мы будем использовать учетные данные администратора, созданные скриптом установки, для входа в систему.

![Страница входа для Kasm Workspaces с полями для электронной почты и пароля, и логотипом с текстом 'The Container Streaming Platform'](https://academy.hackthebox.com/storage/modules/87/iso6.png)

На главной панели управления мы увидим всю статистику о пользователях, успешных входах, неудачных входах, рабочих пространствах и многое другое.

![Интерфейс панели управления, показывающий статистику использования, текущую статистику и использование образов с навигационным меню слева](https://academy.hackthebox.com/storage/modules/87/iso7.png)

Когда мы перейдем в `Workspaces (sidebar) > Registry`, мы найдем набор предварительно настроенных образов, доступных для загрузки. Эти образы используются для запуска изолированной среды внутри контейнера Docker всякий раз, когда мы инициируем его.

KASM Workspaces также предоставляет образ Parrot OS.

![Интерфейс реестра рабочих пространств, показывающий доступные рабочие пространства с отфильтрованной Parrot OS, навигационное меню слева](https://academy.hackthebox.com/storage/modules/87/iso8.png)

Для демонстрационных целей мы загрузим образ браузера Brave.

![Интерфейс реестра рабочих пространств, показывающий установленные рабочие пространства с браузером Brave, навигационное меню слева](https://academy.hackthebox.com/storage/modules/87/iso9.png)

После установки мы можем переключиться на `Workspaces (вверху)` и увидеть доступный образ браузера Brave, который мы только что загрузили. Когда мы нажимаем на него, он создает новый изолированный контейнер.

![Горный пейзаж с иконкой браузера Brave, варианты навигации для Workspaces и Admin вверху](https://academy.hackthebox.com/storage/modules/87/iso10.png)

После загрузки контейнера мы можем использовать его как обычный браузер.

![Домашняя страница HTB Academy с текстом 'Your cybersecurity journey starts here' и вариантами для начала бесплатно или для бизнеса](https://academy.hackthebox.com/storage/modules/87/iso11.png)

Эти одноразовые рабочие пространства представляют собой эфемерные среды, которые уничтожаются после каждой сессии, что гарантирует отсутствие постоянных данных или отслеживания. Больше о бесшовной интеграции KASM можно найти [здесь](https://kasmweb.com/docs/latest/guide/browser_isolation.html).

## Вопросы

**Вопрос:** Как называется механизм для изоляции приложений в ограниченной среде?






# HTTP-утилиты

---

Поскольку практически каждый современный бизнес так или иначе полагается на интернет — будь то веб-серверы, API или HTTP(S)-запросы — необходимо иметь в нашей среде инструменты, которые делают взаимодействие с этими технологиями эффективным, быстрым и простым в управлении.

Эти инструменты должны справляться со следующими задачами:

* Тестирование и исследование API с различными HTTP-методами и полезными нагрузками
* Отладка HTTP-запросов путем проверки заголовков и ответов
* Автоматизация взаимодействия с API в скриптах или конвейерах
* Обработка сложных запросов с аутентификацией, загрузкой файлов или пользовательскими заголовками
* Загрузка файлов или передача данных по HTTP/HTTPS

---

## Curlie

[Curlie](https://github.com/rs/curlie) — один из лучших инструментов, которые мы можем использовать для таких целей. Он построен на основе `curl` и `httpie`, что расширяет общую функциональность. Мы можем загрузить инструмент с помощью следующей команды:

```shell
cry0l1t3@ubuntu:~$ curl -sS https://webinstall.dev/curlie | bash
```

Теперь давайте сравним `curlie` с `curl`, запросив один и тот же API-эндпоинт.

![Терминал, показывающий API-запрос к thecatapi.com с JSON-ответом, содержащим URL изображения и его размеры](https://academy.hackthebox.com/storage/modules/87/http1.png)

Как видите, он предоставляет красочный и структурированный вывод в удобном для пользователя виде с гораздо большим количеством информации, чем `curl`. Кроме того, он упрощает анализ запросов и отладку.

---

## Postman

[Postman](https://www.postman.com/downloads/) — широко используемая платформа и инструмент для разработки, тестирования и взаимодействия с API. Он предлагает как графический пользовательский интерфейс (GUI), так и интерфейс командной строки для упрощения рабочих процессов. Postman разработан для упрощения процесса проектирования, тестирования, документирования и мониторинга API, что делает его основным инструментом для многих разработчиков и тестировщиков, работающих с REST, GraphQL, gRPC и другими типами API. Хотя Postman хорошо подходит для совместной работы, в нашем случае — когда мы в основном выполняем одноразовые API-запросы — он несколько избыточен. По сравнению с `curlie` он работает медленнее и включает множество функций, которые не нужны для простого тестирования конечных точек API.

Однако, если ваш случай использования предполагает больше, чем просто базовое тестирование, Postman — отличный инструмент для рассмотрения. Установочный пакет можно скачать с официального сайта.

![Страница загрузки Postman с опциями для Linux (x64) и Linux (arm64), а также предварительным просмотром интерфейса Postman](https://academy.hackthebox.com/storage/modules/87/http2.png)

После загрузки пакета мы можем извлечь содержимое и запустить исполняемый файл.

```shell
cry0l1t3@ubuntu:~$ cd ~/Downloads
cry0l1t3@ubuntu:~$ tar -xzvf ./postman-linux-x64.tar.gz
cry0l1t3@ubuntu:~$ cd Postman
cry0l1t3@ubuntu:~$ ./Postman
```

В новом окне появится страница регистрации/входа. Однако регистрация изначально не требуется, и мы можем пропустить процесс регистрации/входа.

![Страница входа в Postman API Platform с полями для электронной почты, опциями создания бесплатной учетной записи, входа через Google или использования единого входа](https://academy.hackthebox.com/storage/modules/87/http3.png)

Теперь мы должны увидеть панель инструментов с историей запросов, полем ввода URL для конечной точки API, таблицей для параметров запроса и полем ответа, где отображаются результаты наших запросов.

![Интерфейс Postman с опциями создания запроса, отображающий разделы для параметров, авторизации, заголовков и тела запроса](https://academy.hackthebox.com/storage/modules/87/http4.png)

Давайте предоставим URL, добавим заголовки и отправим запрос.

![Интерфейс Postman, показывающий GET-запрос к urlscan.io с заголовками и параметрами запроса](https://academy.hackthebox.com/storage/modules/87/http5.png)

В окне ответа ниже мы увидим весь ответ, полученный от API (который мы можем анализировать шаг за шагом).

![Интерфейс Postman, показывающий GET-запрос к API urlscan.io с подробностями JSON-ответа, включая информацию о сервере и данные домена](https://academy.hackthebox.com/storage/modules/87/http6.png)

---

## Posting.sh

Терминальной альтернативой Postman является [Posting.sh](https://posting.sh/). Этот легковесный инструмент предоставляет интерфейс в терминале с интуитивно понятным рабочим процессом, ориентированным на клавиатуру. Это означает, что мы можем быстро выполнять все наши HTTP-действия и запросы с помощью клавиатуры, не касаясь мыши.

![Интерфейс терминального API-клиента, показывающий POST-запрос к jsonplaceholder.typicode.com с JSON-ответом, заголовками и деталями запроса](https://academy.hackthebox.com/storage/modules/87/http7.png)

Давайте установим его, затем создадим новый каталог, где будут храниться все наши запросы:

```shell
cry0l1t3@ubuntu:~$ sudo apt install pipx -y
cry0l1t3@ubuntu:~$ pipx install posting
cry0l1t3@ubuntu:~$ mkdir myrequests && cd myrequests
cry0l1t3@ubuntu:~$ posting
```

Внизу вы увидите новую панель, показывающую сочетания клавиш, которые можно использовать для управления пользовательским интерфейсом, который похож на Postman. После отправки запроса в окне ответа будет отображаться содержимое данных, которые мы получаем от API.

![Интерфейс терминала, показывающий GET-запрос к v1.cveapi.com с подробностями JSON-ответа для CVE-2019-9956](https://academy.hackthebox.com/storage/modules/87/http8.png)





# Локальный хостинг ИИ

---

Использование ИИ/LLM локально предоставляет множество преимуществ. Одна из основных причин, почему люди используют локальный ИИ — это конфиденциальность, так как все данные, обрабатываемые моделью ИИ/LLM, не требуют подключения к интернету. Локальная настройка также обеспечивает офлайн-доступность, что является критически важной функцией для тех, кто находится в регионах с нестабильным интернет-соединением.

Еще один важный аспект заключается в том, что модель можно настраивать и оптимизировать, что повышает эффективность и соответствие нашим потребностям. Но это также имеет недостаток, поскольку требует локальных ресурсов CPU/GPU, и старые видеокарты едва ли смогут справиться с огромным объемом вычислений, чтобы служить стабильным ресурсом для локального ИИ/LLM. Однако, с другой стороны, у вас не будет никаких дополнительных затрат, кроме тех, которые идут на производство электроэнергии.

---

## LM Studio

Одно из наиболее эффективных и простых приложений, которое можно использовать для локального хостинга ИИ/LLM — это [LM Studio](https://lmstudio.ai/). Оно позволяет нам находить разнообразные модели из различных источников, таких как [Hugging Face](https://huggingface.co/), загружать их и использовать для решения наших задач. Еще одно преимущество заключается в том, что оно устраняет необходимость и зависимость от внешнего сервера, что одновременно позволяет использовать локально размещенный сервер с ИИ/LLM для приложений на основе терминала. Оно также предлагает три различных режима:

* Пользовательский
* Продвинутый пользователь
* Разработчик

Режим разработчика — это тот, в котором доступно больше всего настроек и конфигураций. Давайте посетим их домашнюю страницу и загрузим LM Studio.

![Домашняя страница LM Studio с вариантами загрузки для ИИ-инструментов, таких как Llama и DeepSeek.](https://academy.hackthebox.com/storage/modules/87/self1.png)

После загрузки перейдем в директорию Downloads и запустим приложение с помощью следующих команд:

```
cry0l1t3@ubuntu:~$ cd ~/Downloads
cry0l1t3@ubuntu:~$ ./LM-Studio
```

Появится новое окно, которое попросит вас загрузить вашу первую LLM и загрузить её.

![Загрузка модели Llama, прогресс 17%, оптимизированной для многоязычного диалога.](https://academy.hackthebox.com/storage/modules/87/self2.png)

После загрузки LLM нам нужно указать LM Studio, какую модель следует использовать. В середине вверху вы увидите поле выбора, которое можно нажать, и оно покажет вам модели, которые вы загрузили. В нижней части вы увидите режимы. Рекомендуется переключиться на режим `разработчика`, так как он включает наибольшее количество функций. Затем в правом верхнем углу вы увидите кнопку, которая разворачивает боковую панель с еще большим количеством параметров конфигурации.

![Интерфейс LM Studio с чатом о Hack The Box Academy, использующий модель Llama.](https://academy.hackthebox.com/storage/modules/87/self3.png)

На левой боковой панели вы увидите кнопку поиска, которая откроет новое окно со списком доступных LLM. Не стесняйтесь осмотреться и проверить, какая модель подходит вашему оборудованию. LM Studio сообщит, соответствует ли ваше оборудование требованиям для конкретной LLM или нет.

![Интерфейс LM Studio, показывающий поиск модели Gemma 3 4B QAT с возможностью загрузки.](https://academy.hackthebox.com/storage/modules/87/self4.png)

Когда мы нажимаем на кнопку shell в левой боковой панели, мы увидим опцию с настройками для запуска локального API-сервера. Это позволяет нам делать API-запросы через терминал или код, чтобы просить локально размещенную LLM обрабатывать определенную информацию.

![Интерфейс настроек LM Studio с остановленным статусом сервера и отображаемой информацией о модели.](https://academy.hackthebox.com/storage/modules/87/self5.png)

Давайте запустим сервер и используем `curlie` для выполнения простого запроса.

![Терминал и интерфейс LM Studio, показывающие команду curl для завершения чата с ответом JSON, указывающим, что сегодня четверг.](https://academy.hackthebox.com/storage/modules/87/self6.png)
