
# 1.1 Введение

---

[Веб-приложения](https://en.wikipedia.org/wiki/Web_application) — это интерактивные приложения, работающие в веб-браузерах. Веб-приложения обычно используют [клиент-серверную архитектуру](https://cio-wiki.org/wiki/Client_Server_Architecture) для работы и обработки взаимодействий. Обычно они имеют интерфейсные компоненты (т.е. интерфейс веб-сайта или то, что "видит пользователь"), которые работают на стороне клиента (браузер), и другие серверные компоненты (исходный код веб-приложения), которые работают на стороне сервера (внутренний сервер/базы данных).

Это позволяет организациям размещать мощные приложения с почти полным контролем в реальном времени над их дизайном и функциональностью, которые доступны по всему миру. Некоторые примеры типичных веб-приложений включают онлайн-почтовые службы, такие как `Gmail`, онлайн-магазины, такие как `Amazon`, и онлайн-текстовые редакторы, такие как `Google Docs`.

![Панель управления, показывающая 932 онлайн-игроков, 1032 захваченных машин, 622 решенных задачи и последние активности с целями Lame, Emdee five for life и Delivery.](https://academy.hackthebox.com/storage/modules/75/client-server-model.jpg)

Веб-приложения не являются прерогативой только крупных провайдеров, таких как Google или Microsoft, но могут быть разработаны любым веб-разработчиком и размещены в Интернете в любом из общих хостинговых сервисов, чтобы ими мог пользоваться любой пользователь в Интернете. Именно поэтому сегодня в Интернете существуют миллионы веб-приложений, с которыми ежедневно взаимодействуют миллиарды пользователей.

---

## Веб-приложения и веб-сайты

Раньше мы взаимодействовали с веб-сайтами, которые были статичными и не могли изменяться в реальном времени. Это означает, что традиционные веб-сайты были статически созданы для представления определенной информации, и эта информация не менялась при нашем взаимодействии. Чтобы изменить содержимое веб-сайта, соответствующую страницу должны были вручную отредактировать разработчики. Такие типы статических страниц не содержат функций и, следовательно, не производят изменений в реальном времени. Такой тип веб-сайта также известен как [Web 1.0](https://en.wikipedia.org/wiki/Web_2.0#Web_1.0).

![Сравнение веб-сайта и веб-приложения: Веб-сайт имеет статические страницы, одинаковые для всех; Веб-приложение имеет динамические, интерактивные страницы, разные для каждого пользователя.](https://academy.hackthebox.com/storage/modules/75/one-server-arch.jpg)

С другой стороны, большинство веб-сайтов работают как веб-приложения, или [Web 2.0](https://en.wikipedia.org/wiki/Web_2.0), представляя динамический контент на основе взаимодействия с пользователем. Еще одно существенное отличие заключается в том, что веб-приложения полностью функциональны и могут выполнять различные функции для конечного пользователя, тогда как веб-сайты лишены такого функционала. Другие ключевые различия между традиционными веб-сайтами и веб-приложениями включают:

* Модульность
* Работа на любом размере дисплея
* Работа на любой платформе без оптимизации

---

## Веб-приложения и нативные приложения операционных систем

В отличие от нативных приложений операционных систем, веб-приложения независимы от платформы и могут работать в браузере на любой операционной системе. Эти веб-приложения не требуют установки на системе пользователя, поскольку они и их функциональность выполняются удаленно на удаленном сервере и, следовательно, не занимают места на жестком диске конечного пользователя.

Еще одно преимущество веб-приложений над нативными приложениями ОС — единство версий. Все пользователи, получающие доступ к веб-приложению, используют одну и ту же версию и одно и то же веб-приложение, которое может постоянно обновляться и модифицироваться без необходимости отправки обновлений каждому пользователю. Веб-приложения могут обновляться в одном месте (веб-сервер) без разработки различных сборок для каждой платформы, что значительно снижает затраты на обслуживание и поддержку, устраняя необходимость сообщать об изменениях каждому пользователю в отдельности.

С другой стороны, нативные приложения ОС имеют определенные преимущества перед веб-приложениями, в основном в скорости работы и возможности использовать нативные библиотеки операционной системы и локальное аппаратное обеспечение. Поскольку нативные приложения созданы для использования нативных библиотек ОС, они загружаются и взаимодействуют гораздо быстрее. Кроме того, нативные приложения обычно имеют больше возможностей, чем веб-приложения, так как они имеют более глубокую интеграцию с операционной системой и не ограничены только возможностями браузера.

В последнее время, однако, гибридные и прогрессивные веб-приложения становятся все более распространенными. Они используют современные фреймворки для запуска веб-приложений с использованием возможностей и ресурсов нативной ОС, делая их быстрее обычных веб-приложений и более функциональными.

---

## Распространение веб-приложений

Существует множество веб-приложений с открытым исходным кодом, используемых организациями по всему миру, которые можно настроить в соответствии с потребностями каждой организации. Некоторые распространенные веб-приложения с открытым исходным кодом включают:

* [WordPress](https://wordpress.com/)
* [OpenCart](https://www.opencart.com/)
* [Joomla](https://www.joomla.org/)

Существуют также проприетарные веб-приложения с "закрытым исходным кодом", которые обычно разрабатываются определенной организацией, а затем продаются другой организации или используются организациями по модели подписки. Некоторые распространенные веб-приложения с закрытым исходным кодом включают:

* [Wix](https://www.wix.com/)
* [Shopify](https://www.shopify.com/)
* [DotNetNuke](https://www.dnnsoftware.com/)

---

## Риски безопасности веб-приложений

Атаки на веб-приложения распространены и представляют проблему для большинства организаций, имеющих присутствие в Интернете, независимо от их размера. В конце концов, они обычно доступны из любой страны для каждого, у кого есть подключение к Интернету и веб-браузер, и обычно предлагают обширную поверхность для атак. Существует множество автоматизированных инструментов для сканирования и атаки веб-приложений, которые в неправильных руках могут нанести значительный ущерб. По мере того, как веб-приложения становятся более сложными и продвинутыми, увеличивается возможность включения критических уязвимостей в их дизайн.

Успешная атака на веб-приложение может привести к значительным потерям и серьезным перебоям в работе бизнеса. Поскольку веб-приложения работают на серверах, которые могут содержать другую конфиденциальную информацию и часто связаны с базами данных, содержащими конфиденциальные пользовательские или корпоративные данные, все эти данные могут быть скомпрометированы в случае успешной атаки на веб-сайт. Поэтому для любого бизнеса, использующего веб-приложения, критически важно должным образом тестировать эти приложения на наличие уязвимостей и оперативно исправлять их, одновременно проверяя, что исправление устраняет дефект и не приводит к случайным новым дефектам.

Тестирование на проникновение в веб-приложения — это все более важный навык для изучения. Любая организация, желающая защитить свои веб-приложения, доступные из Интернета (и внутренние), должна проводить частые тесты веб-приложений и внедрять безопасные практики кодирования на каждом этапе жизненного цикла разработки. Чтобы правильно тестировать веб-приложения на проникновение, нам необходимо понять, как они работают, как они разрабатываются и какие риски таятся на каждом уровне и компоненте приложения в зависимости от используемых технологий.

Мы всегда будем сталкиваться с различными веб-приложениями, которые спроектированы и настроены по-разному. Один из наиболее актуальных и широко используемых методов тестирования веб-приложений — [Руководство по тестированию безопасности веб-приложений OWASP](https://github.com/OWASP/wstg/tree/master/document/4-Web_Application_Security_Testing).

Одна из наиболее распространенных процедур — начать с анализа компонентов интерфейса веб-приложения, таких как `HTML`, `CSS` и `JavaScript` (также известных как "frontend trinity"), и попытаться найти уязвимости, такие как [Разглашение конфиденциальных данных](https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure) и [Межсайтовый скриптинг (XSS)](https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)). После тщательного тестирования всех компонентов интерфейса мы обычно рассматриваем основную функциональность веб-приложения и взаимодействие между браузером и веб-сервером, чтобы перечислить технологии, используемые веб-сервером, и искать эксплуатируемые недостатки. Обычно мы оцениваем веб-приложения как с неаутентифицированной, так и с аутентифицированной точки зрения (если приложение имеет функциональность входа в систему), чтобы максимизировать охват и рассмотреть каждый возможный сценарий атаки.

---

## Атака на веб-приложения

В наше время почти каждая компания, независимо от размера, имеет одно или несколько веб-приложений в своем внешнем периметре. Эти приложения могут быть чем угодно: от простых статических веб-сайтов до блогов, работающих на системах управления контентом (CMS), таких как `WordPress`, до сложных приложений с функциональностью регистрации/входа, поддерживающих различные роли пользователей от базовых пользователей до суперадминов. В наши дни не очень распространено найти внешне подключенный хост, непосредственно уязвимый для известного публичного эксплойта (такого как уязвимая служба или уязвимость Windows для удаленного выполнения кода (RCE)), хотя такое случается. Веб-приложения предоставляют обширную поверхность для атак, и их динамический характер означает, что они постоянно меняются (и часто упускаются из виду!). Относительно простое изменение кода может привести к катастрофической уязвимости или серии уязвимостей, которые могут быть объединены для получения доступа к конфиденциальным данным или удаленного выполнения кода на веб-сервере или других хостах в среде, таких как серверы баз данных.

Нередко можно найти дефекты, которые могут привести непосредственно к выполнению кода, например, форма загрузки файлов, позволяющая загружать вредоносный код, или уязвимость включения файлов, которую можно использовать для получения удаленного выполнения кода. Хорошо известная уязвимость, которая все еще весьма распространена в различных типах веб-приложений — это SQL-инъекция. Этот тип уязвимости возникает из-за небезопасной обработки ввода, предоставляемого пользователем. Он может привести к доступу к конфиденциальным данным, чтению/записи файлов на сервере базы данных и даже к удаленному выполнению кода.

Мы часто находим уязвимости SQL-инъекции в веб-приложениях, использующих Active Directory для аутентификации. Хотя обычно мы не можем использовать это для извлечения паролей (поскольку ими управляет Active Directory), мы часто можем извлечь большинство или все адреса электронной почты пользователей Active Directory, которые часто совпадают с их именами пользователей. Эти данные затем могут быть использованы для выполнения [атаки распыления паролей](https://us-cert.cisa.gov/ncas/current-activity/2019/08/08/acsc-releases-advisory-password-spraying-attacks) против веб-порталов, использующих Active Directory для аутентификации, таких как VPN или Microsoft Outlook Web Access/Microsoft O365. Успешное распыление паролей часто может привести к доступу к конфиденциальным данным, таким как электронная почта, или даже к непосредственному доступу в корпоративную сетевую среду.

Этот пример показывает ущерб, который может возникнуть из-за одной уязвимости веб-приложения, особенно при "цепочке" для извлечения данных из одного приложения, которые можно использовать для атаки на другие части внешней инфраструктуры компании. Профессионал в области информационной безопасности с широким кругозором должен иметь глубокое понимание веб-приложений и чувствовать себя так же комфортно при атаке на веб-приложения, как при проведении тестирования на проникновение в сеть и атаках на Active Directory. Тестер на проникновение с прочной основой в веб-приложениях часто может выделиться среди своих коллег и найти недостатки, которые другие могут упустить. Еще несколько примеров атак на веб-приложения в реальном мире и их влияние следующие:

| Недостаток | Сценарий реального мира |
| --- | --- |
| [SQL-инъекция](https://owasp.org/www-community/attacks/SQL_Injection) | Получение имен пользователей Active Directory и выполнение атаки распыления паролей против VPN или почтового портала. |
| [Включение файлов](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.1-Testing_for_Local_File_Inclusion) | Чтение исходного кода для поиска скрытой страницы или каталога, который предоставляет дополнительную функциональность, которую можно использовать для получения удаленного выполнения кода. |
| [Неограниченная загрузка файлов](https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload) | Веб-приложение, которое позволяет пользователю загружать изображение профиля, разрешает загрузку файлов любого типа (не только изображений). Это можно использовать для получения полного контроля над сервером веб-приложения путем загрузки вредоносного кода. |
| [Небезопасное прямое указание объектов (IDOR)](https://cheatsheetseries.owasp.org/cheatsheets/Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html) | При сочетании с такой уязвимостью, как нарушение контроля доступа, это часто можно использовать для доступа к файлам или функциональности другого пользователя. Примером может быть редактирование вашего профиля пользователя на странице такой как /user/701/edit-profile. Если мы сможем изменить `701` на `702`, мы сможем редактировать профиль другого пользователя! |
| [Нарушение контроля доступа](https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control) | Другим примером является приложение, которое позволяет пользователю зарегистрировать новую учетную запись. Если функциональность регистрации учетной записи спроектирована плохо, пользователь может выполнить повышение привилегий при регистрации. Рассмотрим запрос `POST` при регистрации нового пользователя, который отправляет данные `username=bjones&password=Welcome1&email=bjones@inlanefreight.local&roleid=3`. Что если мы сможем манипулировать параметром `roleid` и изменить его на `0` или `1`. Мы видели реальные приложения, где это было возможно, и было легко быстро зарегистрировать пользователя с правами администратора и получить доступ ко многим непреднамеренным функциям веб-приложения. |

Начните знакомиться с распространенными атаками на веб-приложения и их последствиями. Не беспокойтесь, если какие-либо из этих терминов кажутся вам незнакомыми на данный момент; они станут яснее по мере вашего продвижения и применения итеративного подхода к обучению.

Важно глубоко изучать веб-приложения и ознакомиться с тем, как они работают, и с множеством различных стеков приложений. Мы будем видеть атаки на веб-приложения неоднократно во время нашего пути в Академии, на основной платформе HTB и в оценках реальной жизни. Давайте погрузимся и изучим структуру/функции веб-приложений, чтобы стать более информированными атакующими, выделиться среди своих коллег и найти недостатки, которые другие могут упустить.







# 1.2 Структура веб-приложений

---

Ни одно веб-приложение не идентично другому. Предприятия создают веб-приложения для множества различных целей и аудиторий. Веб-приложения разрабатываются и программируются по-разному, а их внутренняя инфраструктура может быть настроена многими способами. Важно понимать различные способы, которыми веб-приложения могут работать за кулисами, структуру веб-приложения, его компоненты и как они могут быть настроены в инфраструктуре компании.

Структуры веб-приложений состоят из множества различных слоев, которые можно обобщить в следующие три основные категории:

| **Категория** | **Описание** |
|---------------|--------------|
| `Инфраструктура веб-приложения` | Описывает структуру необходимых компонентов, таких как база данных, необходимых для функционирования веб-приложения по назначению. Поскольку веб-приложение может быть настроено для работы на отдельном сервере, важно знать, к какому серверу базы данных оно должно получать доступ. |
| `Компоненты веб-приложения` | Компоненты, составляющие веб-приложение, представляют все компоненты, с которыми взаимодействует веб-приложение. Они разделены на следующие три области: `UI/UX`, `Клиент` и `Сервер`. |
| `Архитектура веб-приложения` | Архитектура включает все взаимосвязи между различными компонентами веб-приложения. |

---

## Инфраструктура веб-приложения

Веб-приложения могут использовать множество различных инфраструктурных настроек. Они также называются `моделями`. Наиболее распространенные из них можно сгруппировать в следующие четыре типа:

* `Клиент-сервер`
* `Один сервер`
* `Много серверов - одна база данных`
* `Много серверов - много баз данных`

---

#### Клиент-сервер

Веб-приложения часто используют модель `клиент-сервер`. Сервер размещает веб-приложение в модели клиент-сервер и распространяет его всем клиентам, пытающимся получить к нему доступ.

![Диаграмма, показывающая сервер, подключенный к четырем клиентам: настольному компьютеру, ноутбуку, смартфону и монитору.](https://academy.hackthebox.com/storage/modules/75/client-server-model.jpg)

В этой модели веб-приложения имеют два типа компонентов: те, которые находятся во фронтенде и обычно интерпретируются и выполняются на стороне клиента (браузер), и компоненты в бэкенде, обычно компилируемые, интерпретируемые и выполняемые хостинг-сервером.

Когда клиент посещает URL веб-приложения (веб-адрес, например, https://www.acme.local), сервер использует основной интерфейс веб-приложения (`UI`). Когда пользователь нажимает на кнопку или запрашивает определенную функцию, браузер отправляет HTTP-запрос на сервер, который интерпретирует этот запрос и выполняет необходимые задачи для его выполнения (например, вход пользователя, добавление товара в корзину, переход на другую страницу и т.д.). Как только сервер получит необходимые данные, он отправляет результат обратно в браузер клиента, отображая результат в читаемом для человека виде.

`Этот веб-сайт, с которым мы в настоящее время взаимодействуем, также является веб-приложением, разработанным и размещенным Hack The Box (веб-сервер), и мы получаем доступ к нему и взаимодействуем с ним, используя наш веб-браузер (клиент).`

Однако, несмотря на то, что большинство веб-приложений используют архитектуру клиент-сервер с фронтендом и бэкендом, существует множество вариантов реализации.

---

#### Один сервер

В этой архитектуре все веб-приложение или даже несколько веб-приложений и их компоненты, включая базу данных, размещены на одном сервере. Хотя такой дизайн прост и легко реализуется, он также является наиболее рискованным.

![Диаграмма, показывающая сервер, подключенный к трем клиентам: смартфону, ноутбуку и монитору.](https://academy.hackthebox.com/storage/modules/75/one-server-arch.jpg)

Если какое-либо веб-приложение, размещенное на этом сервере, будет скомпрометировано в этой архитектуре, то данные всех веб-приложений будут скомпрометированы. Этот дизайн представляет собой подход "`все яйца в одной корзине`", поскольку если любое из размещенных веб-приложений уязвимо, весь веб-сервер становится уязвимым.

Более того, если веб-сервер по какой-либо причине выйдет из строя, все размещенные на нем веб-приложения станут полностью недоступными до решения проблемы.

---

#### Много серверов - одна база данных

Эта модель отделяет базу данных на собственный сервер базы данных и позволяет серверу размещения веб-приложений получать доступ к серверу базы данных для хранения и извлечения данных. Ее можно рассматривать как "много серверов к одной базе данных" и "один сервер к одной базе данных", если база данных отделена на собственный сервер базы данных.

![Диаграмма, показывающая базу данных, подключенную к трем серверам, каждый из которых связан с клиентом смартфоном, ноутбуком и монитором.](hhttps://academy.hackthebox.com/storage/modules/75/many-server-one-db-arch.jpg)

Эта модель позволяет нескольким веб-приложениям получать доступ к одной базе данных, чтобы иметь доступ к одним и тем же данным без синхронизации данных между ними. Веб-приложения могут быть репликациями одного основного приложения (т.е. основное/резервное) или они могут быть отдельными веб-приложениями, которые используют общие данные.

Главное преимущество этой модели (`с точки зрения безопасности`) — сегментация, где каждый из основных компонентов веб-приложения расположен и размещен отдельно. В случае компрометации одного веб-сервера другие веб-серверы напрямую не затрагиваются. Аналогично, если база данных скомпрометирована (например, через уязвимость SQL-инъекции), само веб-приложение напрямую не затрагивается. После сегментации активов все еще необходимо внедрить меры контроля доступа, такие как ограничение доступа веб-приложения только к данным, необходимым для функционирования по назначению.

---

#### Много серверов - много баз данных

Эта модель основывается на модели `Много серверов, одна база данных`. Однако внутри сервера базы данных данные каждого веб-приложения размещаются в отдельной базе данных. Веб-приложение может получать доступ только к частным данным и только к общим данным, которые используются всеми веб-приложениями. Также возможно разместить базу данных каждого веб-приложения на отдельном сервере базы данных.

![Диаграмма, показывающая три базы данных, подключенные к трем серверам, каждый из которых связан с клиентом смартфоном, ноутбуком и монитором.](https://academy.hackthebox.com/storage/modules/75/many-server-one-db-arch.jpg)

Этот дизайн также широко используется для резервирования, так что если какой-либо веб-сервер или база данных выйдет из строя, резервная копия будет работать для максимального снижения времени простоя. Хотя это может быть сложнее реализовать и может потребовать таких инструментов, как [балансировщики нагрузки](https://en.wikipedia.org/wiki/Load_balancing_(computing)), для правильного функционирования, эта архитектура является одним из лучших вариантов с точки зрения безопасности благодаря правильным мерам контроля доступа и правильной сегментации активов.

Помимо этих моделей, существуют и другие модели веб-приложений, такие как [бессерверные](https://aws.amazon.com/lambda/serverless-architectures-learn-more) веб-приложения или веб-приложения, использующие [микросервисы](https://aws.amazon.com/microservices).

---

## Компоненты веб-приложения

Каждое веб-приложение может иметь разное количество компонентов. Тем не менее, все компоненты вышеупомянутых моделей можно разбить на:

1. `Клиент`
2. `Сервер`
   * Веб-сервер
   * Логика веб-приложения
   * База данных
3. `Сервисы` (Микросервисы)
   * Интеграции с третьими сторонами
   * Интеграции веб-приложений
4. `Функции` (Бессерверные)

---

## Архитектура веб-приложения

Компоненты веб-приложения разделены на три различных слоя (также известных как трехуровневая архитектура).

| **Слой** | **Описание** |
|----------|--------------|
| `Уровень представления` | Состоит из компонентов процесса пользовательского интерфейса, которые обеспечивают коммуникацию с приложением и системой. Доступ к ним клиент получает через веб-браузер, и они возвращаются в виде HTML, JavaScript и CSS. |
| `Уровень приложения` | Этот слой обеспечивает правильную обработку всех запросов клиента (веб-запросов). Проверяются различные критерии, такие как авторизация, привилегии и данные, передаваемые клиенту. |
| `Уровень данных` | Уровень данных тесно работает с уровнем приложения, чтобы определить, где именно хранятся необходимые данные и как к ним можно получить доступ. |

Пример архитектуры веб-приложения может выглядеть примерно так:

![Диаграмма архитектуры ASP.NET Core, показывающая клиента, обратный прокси IIS, веб-приложение ASP.NET Core с фильтрами и сервисами, подключенные к источникам данных, провайдерам идентификации и сторонним сервисам.](https://docs.microsoft.com/en-us/dotnet/architecture/modern-web-apps-azure/media/image5-12.png)
Источник: [Microsoft Docs](https://docs.microsoft.com/en-us/dotnet/architecture/modern-web-apps-azure/common-web-application-architectures)

Более того, некоторые веб-серверы могут выполнять вызовы операционной системы и программы, такие как [IIS ISAPI](https://learn.microsoft.com/en-us/previous-versions/iis/6.0-sdk/ms525172(v=vs.90)) или [PHP-CGI](https://www.php.net/manual/en/install.unix.commandline.php).

---

#### Микросервисы

Мы можем представить микросервисы как независимые компоненты веб-приложения, которые в большинстве случаев запрограммированы только для одной задачи. Например, для интернет-магазина мы можем разложить основные задачи на следующие компоненты:

* Регистрация
* Поиск
* Платежи
* Рейтинги
* Отзывы

Эти компоненты общаются с клиентом и друг с другом. Коммуникация между этими микросервисами `не сохраняет состояние`, что означает, что запрос и ответ независимы. Это потому, что сохраненные данные `хранятся отдельно` от соответствующих микросервисов. Использование микросервисов считается [сервис-ориентированной архитектурой (SOA)](https://en.wikipedia.org/wiki/Service-oriented_architecture), построенной как коллекция различных автоматизированных функций, ориентированных на одну бизнес-цель. Тем не менее, эти микросервисы зависят друг от друга.

Еще одним важным и эффективным компонентом микросервисов является то, что они могут быть написаны на разных языках программирования и всё равно взаимодействовать. Микросервисы получают преимущества от более легкого масштабирования и более быстрой разработки приложений, что способствует инновациям и ускоряет доставку новых функций на рынок. Некоторые преимущества микросервисов включают:

* Гибкость
* Гибкое масштабирование
* Легкость развертывания
* Повторное использование кода
* Устойчивость

Эта [белая книга AWS](https://d1.awsstatic.com/whitepapers/microservices-on-aws.pdf) предоставляет отличный обзор реализации микросервисов.

---

#### Бессерверная архитектура

Облачные провайдеры, такие как AWS, GCP, Azure и другие, предлагают бессерверные архитектуры. Эти платформы предоставляют фреймворки приложений для создания таких веб-приложений без необходимости беспокоиться о самих серверах. Эти веб-приложения затем работают в бессостоянии вычислительных контейнерах (например, Docker). Этот тип архитектуры дает компании гибкость для создания и развертывания приложений и сервисов без необходимости управлять инфраструктурой; все управление сервером осуществляется облачным провайдером, что избавляет от необходимости выделять, масштабировать и поддерживать серверы, необходимые для работы приложений и баз данных.

Вы можете узнать больше о бессерверных вычислениях и различных случаях их использования [здесь](https://aws.amazon.com/serverless).

---

## Безопасность архитектуры

Понимание общей архитектуры веб-приложений и конкретного дизайна каждого веб-приложения важно при проведении тестов на проникновение для любого веб-приложения. Во многих случаях уязвимость отдельного веб-приложения может быть вызвана не программной ошибкой, а ошибкой дизайна в его архитектуре.

Например, отдельное веб-приложение может иметь все свои основные функциональные возможности безопасно реализованными. Однако из-за отсутствия надлежащих мер контроля доступа в его дизайне, например, использования [Контроля доступа на основе ролей (RBAC)](https://en.wikipedia.org/wiki/Role-based_access_control), пользователи могут получить доступ к некоторым функциям администратора, которые не предназначены для прямого доступа к ним, или даже получить доступ к личной информации других пользователей без наличия привилегий для этого. Для устранения такого типа проблемы потребовалось бы значительное изменение дизайна, что, вероятно, было бы дорогостоящим и трудоемким.

Другой пример: если мы не можем найти базу данных после эксплуатации уязвимости и получения контроля над серверной частью, это может означать, что база данных размещена на отдельном сервере. Мы можем найти только часть данных базы данных, что может означать, что используется несколько баз данных. Именно поэтому безопасность должна учитываться на каждом этапе разработки веб-приложения, а тесты на проникновение должны проводиться на протяжении всего жизненного цикла разработки веб-приложения.









# 1.3 Frontend против Backend

---

Мы могли слышать [термины](https://en.wikipedia.org/wiki/Front_end_and_back_end) `frontend` и `backend` веб-разработка, или термин [Full Stack](https://www.w3schools.com/whatis/whatis_fullstack.asp) веб-разработка, который относится как к `frontend`, так и к `backend` веб-разработке. Эти термины становятся синонимами разработки веб-приложений, поскольку они составляют большую часть цикла веб-разработки. Однако эти термины очень отличаются друг от друга, поскольку каждый относится к одной стороне веб-приложения, и каждый функционирует и общается в разных областях.

---

## Frontend

Frontend веб-приложения содержит компоненты пользователя напрямую через их веб-браузер (клиентская сторона). Эти компоненты составляют исходный код веб-страницы, которую мы видим при посещении веб-приложения, и обычно включают `HTML`, `CSS` и `JavaScript`, которые затем интерпретируются в реальном времени нашими браузерами.

![Окно браузера, отображающее фрагменты кода HTML, CSS и JS для макета веб-страницы.](https://academy.hackthebox.com/storage/modules/75/frontend-components.jpg)

Это включает в себя все, что пользователь видит и с чем взаимодействует, например, основные элементы страницы, такие как заголовок и текст [HTML](https://www.w3schools.com/html/html_intro.asp), дизайн и анимация всех элементов [CSS](https://www.w3schools.com/css/css_intro.asp), и какую функцию выполняет каждая часть страницы [JavaScript](https://www.w3schools.com/js/js_intro.asp).

В современных веб-приложениях frontend-компоненты должны адаптироваться к любому размеру экрана и работать в любом браузере на любом устройстве. Это контрастирует с backend-компонентами, которые обычно написаны для конкретной платформы или операционной системы. Если frontend веб-приложения не оптимизирован должным образом, это может сделать все веб-приложение медленным и неотзывчивым. В этом случае некоторые пользователи могут подумать, что хостинговый сервер или их интернет медленный, в то время как проблема полностью лежит на клиентской стороне в браузере пользователя. Вот почему frontend веб-приложения должен быть оптимизирован для большинства платформ, устройств (включая мобильные!) и размеров экрана.

Помимо разработки frontend-кода, следующие задачи также связаны с разработкой frontend веб-приложений:

- Визуальная концепция веб-дизайна
- Дизайн пользовательского интерфейса (UI)
- Дизайн пользовательского опыта (UX)

Есть много сайтов, доступных нам для практики frontend-кодирования. Один пример - [этот](https://html-css-js.com/). Здесь мы можем поиграть с [редактором](https://htmlg.com/html-editor/), набирая и форматируя текст и видя результирующие `HTML`, `CSS` и `JavaScript`, которые генерируются для нас. Скопируйте/вставьте этот ОЧЕНЬ простой пример в правую часть редактора:

```html
<p><strong>Добро пожаловать в Hack The Box Academy</strong><strong></strong></p>
<p></p>
<p><em>Это курсивный текст.</em></p>
<p></p>
<p><span style="color: #0000ff;">Это синий текст.</span></p>
<p></p>
<p></p>
```

Посмотрите, как простой HTML-код отображается слева. Поиграйте с форматированием, заголовками, цветами и т.д., и наблюдайте, как изменяется код.

---

## Backend

Backend веб-приложения управляет всеми основными функциональностями веб-приложения, все из которых выполняется на backend-сервере, который обрабатывает все необходимое для правильной работы веб-приложения. Это та часть, которую мы можем никогда не увидеть или напрямую не взаимодействовать с ней, но веб-сайт - это просто коллекция статических веб-страниц без backend.

Есть четыре основных backend-компонента для веб-приложений:

| **Компонент** | **Описание** |
|---|---|
| `Backend Серверы` | Аппаратное обеспечение и операционная система, которая размещает все другие компоненты и обычно работает на операционных системах, таких как `Linux`, `Windows`, или используя `Контейнеры`. |
| `Веб-серверы` | Веб-серверы обрабатывают HTTP-запросы и соединения. Некоторые примеры - `Apache`, `NGINX` и `IIS`. |
| `Базы данных` | Базы данных (`БД`) хранят и извлекают данные веб-приложения. Некоторые примеры реляционных баз данных - `MySQL`, `MSSQL`, `Oracle`, `PostgreSQL`, в то время как примеры нереляционных баз данных включают `NoSQL` и `MongoDB`. |
| `Фреймворки разработки` | Фреймворки разработки используются для разработки основного веб-приложения. Некоторые известные фреймворки включают `Laravel` (`PHP`), `ASP.NET` (`C#`), `Spring` (`Java`), `Django` (`Python`) и `Express` (`NodeJS JavaScript`). |

![Диаграмма, показывающая backend-сервер под управлением Linux и Windows, подключенный к веб-серверу (Apache, NGINX, IIS), веб-приложению (PHP, C#, Java) и базе данных (MySQL, MS SQL, Oracle).](https://academy.hackthebox.com/storage/modules/75/backend-server.jpg)

Также возможно разместить каждый компонент backend на его собственном изолированном сервере или в изолированных контейнерах, используя такие сервисы, как [Docker](https://www.docker.com/). Для поддержания логического разделения и смягчения воздействия уязвимостей различные компоненты веб-приложения, такие как база данных, могут быть установлены в одном Docker-контейнере, в то время как основное веб-приложение установлено в другом, тем самым изолируя каждую часть от потенциальных уязвимостей, которые могут повлиять на другой контейнер(ы). Также возможно разделить каждый на его выделенный сервер, что может быть более ресурсоемким и времязатратным для поддержания. Тем не менее, это зависит от бизнес-случая и дизайна/функциональности рассматриваемого веб-приложения.

Некоторые из основных задач, выполняемых backend-компонентами, включают:

- Разработка основной логики и сервисов backend веб-приложения
- Разработка основного кода и функциональностей веб-приложения
- Разработка и поддержание backend базы данных
- Разработка и реализация библиотек для использования веб-приложением
- Реализация технических/бизнес-потребностей для веб-приложения
- Реализация основных [API](https://en.wikipedia.org/wiki/API) для коммуникации frontend-компонентов
- Интеграция удаленных серверов и облачных сервисов в веб-приложение

---

## Защита Frontend/Backend

Даже несмотря на то, что в большинстве случаев мы не будем иметь доступ к backend-коду для анализа отдельных функций и структуры кода, это не делает приложение неуязвимым. Оно все еще может быть эксплуатировано различными инъекционными атаками, например.

Предположим, у нас есть функция поиска в веб-приложении, которая по ошибке не обрабатывает наши поисковые запросы правильно. В этом случае мы могли бы использовать специфические техники для манипулирования запросами таким образом, чтобы получить несанкционированный доступ к определенным данным базы данных [SQL-инъекции](https://www.w3schools.com/sql/sql_injection.asp) или даже выполнить команды операционной системы через веб-приложение, также известные как [Command Injections](https://owasp.org/www-community/attacks/Command_Injection).

Мы позже обсудим, как защитить каждый компонент, используемый на frontend и backend. Когда у нас есть полный доступ к исходному коду frontend-компонентов, мы можем выполнить обзор кода для поиска уязвимостей, что является частью того, что называется [Whitebox Pentesting](https://en.wikipedia.org/wiki/White-box_testing).

С другой стороны, исходный код backend-компонентов хранится на backend-сервере, поэтому у нас нет доступа к нему по умолчанию, что заставляет нас выполнять только то, что известно как [Blackbox Pentesting](https://en.wikipedia.org/wiki/Black-box_testing). Однако, как мы увидим, некоторые веб-приложения имеют открытый исходный код, что означает, что у нас, вероятно, есть доступ к их исходному коду. Кроме того, некоторые уязвимости, такие как [Local File Inclusion](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.1-Testing_for_Local_File_Inclusion), могут позволить нам получить исходный код с backend-сервера. С этим исходным кодом в руках мы можем затем выполнить обзор кода на backend-компонентах, чтобы дополнительно понять, как работает приложение, потенциально найти чувствительные данные в исходном коде (такие как пароли) и даже найти уязвимости, которые было бы трудно или невозможно найти без доступа к исходному коду.

`Топ 20` наиболее распространенных ошибок, которые делают веб-разработчики, важных для нас как тестировщиков на проникновение:

| **№** | **Ошибка** |
|---|---|
| `1.` | Разрешение недействительных данных поступать в базу данных |
| `2.` | Фокусирование на системе в целом |
| `3.` | Установление лично разработанных методов безопасности |
| `4.` | Рассмотрение безопасности как последнего шага |
| `5.` | Разработка хранения паролей в открытом тексте |
| `6.` | Создание слабых паролей |
| `7.` | Хранение незашифрованных данных в базе данных |
| `8.` | Чрезмерное полагание на клиентскую сторону |
| `9.` | Быть слишком оптимистичным |
| `10.` | Разрешение переменных через путь URL |
| `11.` | Доверие стороннему коду |
| `12.` | Жестко закодированные бэкдор-аккаунты |
| `13.` | Непроверенные SQL-инъекции |
| `14.` | Удаленные файловые включения |
| `15.` | Небезопасная обработка данных |
| `16.` | Неправильное шифрование данных |
| `17.` | Неиспользование безопасной криптографической системы |
| `18.` | Игнорирование 8-го уровня |
| `19.` | Обзор действий пользователя |
| `20.` | Неправильные конфигурации Web Application Firewall |

Эти ошибки приводят к [OWASP Top 10](https://owasp.org/www-project-top-ten/) уязвимостям для веб-приложений, которые мы обсудим в других модулях:

| **№** | **Уязвимость** |
|---|---|
| `1.` | Нарушенный контроль доступа |
| `2.` | Криптографические сбои |
| `3.` | Инъекция |
| `4.` | Небезопасный дизайн |
| `5.` | Неправильная конфигурация безопасности |
| `6.` | Уязвимые и устаревшие компоненты |
| `7.` | Сбои идентификации и аутентификации |
| `8.` | Сбои целостности программного обеспечения и данных |
| `9.` | Сбои логирования и мониторинга безопасности |
| `10.` | Подделка запросов на стороне сервера (SSRF) |

Важно начать знакомиться с этими недостатками и уязвимостями, поскольку они формируют основу для многих проблем, которые мы рассматриваем в будущих веб- и даже не веб-связанных модулях. Как тестировщики на проникновение, мы должны иметь способность компетентно идентифицировать, эксплуатировать и объяснять эти уязвимости для наших клиентов.






# 1.4 HTML

---

Первый и наиболее доминирующий компонент фронтенда веб-приложений — это [HTML (HyperText Markup Language)](https://en.wikipedia.org/wiki/HTML). HTML находится в самом ядре любой веб-страницы, которую мы видим в интернете. Он содержит основные элементы каждой страницы, включая заголовки, формы, изображения и многие другие элементы. Веб-браузер, в свою очередь, интерпретирует эти элементы и отображает их конечному пользователю.

Ниже приведен очень простой пример HTML-страницы:

#### Пример

```html
<!DOCTYPE html>
<html>
    <head>
        <title>Page Title</title>
    </head>
    <body>
        <h1>A Heading</h1>
        <p>A Paragraph</p>
    </body>
</html>
```

Это будет отображаться следующим образом:

![Browser window with page title 'Page Title', URL 'www.example.coml', heading 'A Heading', and paragraph 'A Paragraph'.](https://academy.hackthebox.com/storage/modules/75/web_apps_html_2.jpg)

Как мы можем видеть, HTML-элементы отображаются в древовидной форме, аналогично `XML` и другим языкам:

#### Структура HTML

```
document
 - html
   -- head
      --- title
   -- body
      --- h1
      --- p
```

Каждый элемент может содержать другие HTML-элементы, в то время как основной тег `HTML` должен содержать все остальные элементы на странице, которые находятся под `document`, различая между `HTML` и документами, написанными для других языков, таких как `XML` документы.

HTML-элементы приведенного выше кода можно рассматривать следующим образом:

**&lt;html&gt;**
- **&lt;head&gt;**
  - **&lt;title&gt;Page Title&lt;/title&gt;**
- **&lt;/head&gt;**
- **&lt;body&gt;**
  - **&lt;h1&gt;A Heading&lt;/h1&gt;**
  - **&lt;p&gt;A Paragraph&lt;/p&gt;**
- **&lt;/body&gt;**

**&lt;/html&gt;**

Каждый HTML-элемент открывается и закрывается тегом, который указывает тип элемента (например, `<p>` для абзацев), где содержимое будет размещено между этими тегами. Теги также могут содержать id или класс элемента (например, `<p id='para1'>` или `<p id='red-paragraphs'>`), который необходим для CSS для правильного форматирования элемента. И теги, и содержимое составляют весь элемент.

---

## URL-кодирование

Важной концепцией для изучения в HTML является [URL-кодирование](https://en.wikipedia.org/wiki/Percent-encoding) или процентное кодирование. Для правильного отображения содержимого страницы браузер должен знать используемую кодировку. В URL-адресах, например, браузеры могут использовать только [ASCII](https://en.wikipedia.org/wiki/ASCII) кодировку, которая позволяет только буквенно-цифровые символы и определенные специальные символы. Поэтому все остальные символы вне набора символов ASCII должны быть закодированы в URL. URL-кодирование заменяет небезопасные ASCII-символы символом `%`, за которым следуют две шестнадцатеричные цифры.

Например, символ одинарной кавычки '`'`' кодируется как '`%27`', что может быть понято браузерами как одинарная кавычка. URL-адреса не могут содержать пробелы и заменят пробел либо знаком `+` (плюс), либо `%20`. Некоторые распространенные кодировки символов:

| Символ | Кодировка |
|---------|----------|
| пробел  | %20      |
| !       | %21      |
| "       | %22      |
| #       | %23      |
| $       | %24      |
| %       | %25      |
| &       | %26      |
| '       | %27      |
| (       | %28      |
| )       | %29      |

Полную таблицу кодировки символов можно посмотреть [здесь](https://www.w3schools.com/tags/ref_urlencode.ASP).

Множество онлайн-инструментов можно использовать для выполнения URL-кодирования/декодирования. Кроме того, популярный веб-прокси [Burp Suite](https://portswigger.net/burp) имеет декодер/кодер, который можно использовать для преобразования между различными типами кодировок. Попробуйте кодировать/декодировать некоторые символы и строки, используя этот [онлайн-инструмент](https://www.url-encode-decode.com/).

#### Использование

Элемент `<head>` обычно содержит элементы, которые не печатаются непосредственно на странице, такие как заголовок страницы, в то время как все основные элементы страницы расположены под `<body>`. Другие важные элементы включают `<style>`, который содержит CSS-код страницы, и `<script>`, который содержит JS-код страницы, как мы увидим в следующем разделе.

Каждый из этих элементов называется [DOM (Document Object Model)](https://en.wikipedia.org/wiki/Document_Object_Model). [Консорциум World Wide Web (W3C)](https://www.w3.org/) определяет `DOM` как:

`"W3C Document Object Model (DOM) — это платформо- и языково-нейтральный интерфейс, который позволяет программам и скриптам динамически получать доступ и обновлять содержимое, структуру и стиль документа."`

Стандарт DOM разделен на 3 части:

- `Core DOM` — стандартная модель для всех типов документов
- `XML DOM` — стандартная модель для XML-документов
- `HTML DOM` — стандартная модель для HTML-документов

Например, из приведенного выше древовидного представления мы можем ссылаться на DOM как `document.head` или `document.h1` и так далее.

Понимание структуры HTML DOM может помочь нам понять, где расположен каждый элемент, который мы видим на странице, что позволяет нам просматривать исходный код конкретного элемента на странице и искать потенциальные проблемы. Мы можем находить HTML-элементы по их id, имени тега или имени класса.

Это также полезно, когда мы хотим использовать уязвимости фронтенда (такие как `XSS`) для манипулирования существующими элементами или создания новых элементов для удовлетворения наших потребностей.

---

## Вопросы

**Какой HTML-тег используется для отображения изображения?**

*Подсказка: Google — ваш друг. Укажите только открывающий тег (т.е. <...>)*

